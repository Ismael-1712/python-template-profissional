{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"meu_projeto_placeholder","text":"<p>\ud83d\ude80 Template Python Profissional com Pipeline de Qualidade Integrado</p> <p> </p>"},{"location":"#bem-vindo-a-documentacao","title":"\ud83d\udcda Bem-vindo \u00e0 Documenta\u00e7\u00e3o","text":"<p>Este \u00e9 um template Python profissional que fornece uma base s\u00f3lida para desenvolvimento de projetos com:</p> <ul> <li>\u2705 Pipeline de Qualidade Integrado - CI/CD automatizado com GitHub Actions</li> <li>\u2705 Ferramentas Modernas - Ruff (linting + formata\u00e7\u00e3o), pytest, semantic-release</li> <li>\u2705 Documenta\u00e7\u00e3o Automatizada - MkDocs Material + mkdocstrings</li> <li>\u2705 Seguran\u00e7a e Auditoria - Sistema de code audit integrado</li> <li>\u2705 Git Sync Inteligente - Sincroniza\u00e7\u00e3o automatizada com valida\u00e7\u00e3o</li> </ul>"},{"location":"#quick-start","title":"\u26a1 Quick Start","text":"<pre><code># 1. Clone o reposit\u00f3rio\ngit clone https://github.com/usuario/meu_projeto_placeholder.git\ncd meu_projeto_placeholder\n\n# 2. Configure o ambiente (cria venv + instala depend\u00eancias)\nmake setup\n\n# 3. Ative o ambiente virtual\nsource .venv/bin/activate\n\n# 4. Valide a instala\u00e7\u00e3o\nmake test\n</code></pre> <p>Pronto! Voc\u00ea est\u00e1 preparado para desenvolver. \ud83c\udf89</p>"},{"location":"#comandos-de-engenharia","title":"\ud83d\udee0\ufe0f Comandos de Engenharia","text":"<p>Todos os comandos do projeto s\u00e3o gerenciados via Makefile para consist\u00eancia e automa\u00e7\u00e3o:</p> Comando Descri\u00e7\u00e3o <code>make setup</code> Configura ambiente completo (alias para <code>install-dev</code>) <code>make test</code> Executa suite completa de testes com pytest <code>make test-coverage</code> Testes com relat\u00f3rio de cobertura <code>make lint</code> Verifica c\u00f3digo com ruff (an\u00e1lise est\u00e1tica) <code>make format</code> Formata c\u00f3digo automaticamente com ruff <code>make audit</code> Auditoria completa de seguran\u00e7a e qualidade <code>make check</code> Valida\u00e7\u00e3o r\u00e1pida (lint + test) - use antes do push! <code>make docs-serve</code> Servidor de documenta\u00e7\u00e3o local <code>make docs-build</code> Build de documenta\u00e7\u00e3o para produ\u00e7\u00e3o <code>make release</code> (CI Only) Publica vers\u00e3o e gera changelog <code>make clean</code> Remove artefatos de build e cache <code>make help</code> Exibe todos os comandos dispon\u00edveis"},{"location":"#comandos-mais-usados","title":"\ud83c\udfaf Comandos Mais Usados","text":"<pre><code># Desenvolvimento do dia a dia\nmake format        # Formatar c\u00f3digo\nmake test          # Rodar testes\nmake check         # Valida\u00e7\u00e3o completa antes do commit\n\n# Pipeline de Qualidade Completo\nmake audit         # An\u00e1lise profunda de seguran\u00e7a\nmake test-coverage # Verificar cobertura de testes\n\n# Documenta\u00e7\u00e3o\nmake docs-serve    # Visualizar docs localmente\nmake docs-build    # Gerar site est\u00e1tico\n</code></pre>"},{"location":"#fluxo-de-trabalho-branches","title":"\ud83e\udd1d Fluxo de Trabalho &amp; Branches","text":""},{"location":"#politica-de-qualidade","title":"Pol\u00edtica de Qualidade","text":"<p>Regra de Ouro</p> <p>Nenhum c\u00f3digo \u00e9 aceito sem passar pelo <code>make audit</code> com sucesso.</p>"},{"location":"#estrategia-de-branches-automated-flow","title":"\ud83d\udd04 Estrat\u00e9gia de Branches (Automated Flow)","text":"<p>Este projeto utiliza um sistema de Auto-Propaga\u00e7\u00e3o para manter as variantes sincronizadas.</p> <ol> <li><code>main</code>: A fonte da verdade (Branch Protegida).</li> <li><code>api</code> / <code>cli</code>: Variantes geradas automaticamente.</li> </ol>"},{"location":"#navegacao-da-documentacao","title":"\ud83d\udcd6 Navega\u00e7\u00e3o da Documenta\u00e7\u00e3o","text":""},{"location":"#documentacao-tecnica","title":"Documenta\u00e7\u00e3o T\u00e9cnica","text":"<ul> <li>Refer\u00eancia da API - Documenta\u00e7\u00e3o autom\u00e1tica do c\u00f3digo</li> <li>Guias e Tutoriais - Documenta\u00e7\u00e3o t\u00e9cnica detalhada</li> <li>Code Audit - Sistema de auditoria de c\u00f3digo</li> <li>Contributing - Como contribuir para o projeto</li> </ul>"},{"location":"#sprint-1-refatoracao-de-logging-e-ambiente","title":"\ud83d\udcca Sprint 1 - Refatora\u00e7\u00e3o de Logging e Ambiente","text":"<p>Nova Documenta\u00e7\u00e3o - Sprint 1</p> <p>Documenta\u00e7\u00e3o completa da auditoria e refatora\u00e7\u00e3o do sistema de logs e detec\u00e7\u00e3o de ambiente.</p> <ul> <li>Sprint 1 - Relat\u00f3rio de Auditoria Completo - An\u00e1lise detalhada de logging, drift e hardcoding</li> <li>Sprint 1 - Sum\u00e1rio Executivo - Vis\u00e3o r\u00e1pida dos achados principais</li> <li>Sprint 1 - Guia de Migra\u00e7\u00e3o - Exemplos pr\u00e1ticos de migra\u00e7\u00e3o para novo sistema</li> </ul>"},{"location":"#sobre-este-template","title":"\ud83d\ude80 Sobre este Template","text":"<p>Este template foi desenvolvido com foco em:</p> <ul> <li>Qualidade de C\u00f3digo: An\u00e1lise est\u00e1tica rigorosa com Ruff</li> <li>Testes Automatizados: Cobertura de testes com pytest</li> <li>CI/CD Robusto: Pipeline completo com GitHub Actions</li> <li>Documenta\u00e7\u00e3o Viva: Docs as Code com MkDocs Material</li> <li>Seguran\u00e7a: Auditoria preventiva antes de commits</li> <li>Developer Experience: Comandos simples e consistentes via Makefile</li> </ul> <p>Documenta\u00e7\u00e3o gerada com \u2764\ufe0f por MkDocs Material</p>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/","title":"Audit Dashboard Integration Guide","text":""},{"location":"AUDIT_DASHBOARD_INTEGRATION/#overview","title":"Overview","text":"<p>O <code>audit_dashboard.py</code> \u00e9 um sistema de m\u00e9tricas empresarial para rastreamento de auditorias DevOps, integrado com o <code>code_audit.py</code> para fornecer visibilidade completa sobre a efetividade das auditorias de CI/CD.</p>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#integration-points","title":"Integration Points","text":""},{"location":"AUDIT_DASHBOARD_INTEGRATION/#1-with-code_auditpy","title":"1. With <code>code_audit.py</code>","text":"<p>O dashboard pode ser integrado ao sistema de auditoria principal adicionando estas linhas ao final do <code>code_audit.py</code>:</p> <pre><code># Add to code_audit.py imports\nfrom scripts.audit_dashboard import AuditDashboard\n\n# Add to the end of your audit process\ndef integrate_dashboard_recording(audit_results: dict, workspace_root: Path):\n    \"\"\"Record audit results in dashboard metrics.\"\"\"\n    try:\n        dashboard = AuditDashboard(workspace_root)\n        dashboard.record_audit(audit_results)\n        logger.info(\"Audit metrics recorded successfully\")\n    except Exception as e:\n        logger.warning(f\"Failed to record audit metrics: {e}\")\n        # Don't fail the audit if dashboard recording fails\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#2-cicd-pipeline-integration","title":"2. CI/CD Pipeline Integration","text":"<p>Add to your CI/CD pipeline (e.g., <code>.github/workflows/audit.yml</code>):</p> <pre><code>steps:\n  - name: Run Code Audit\n    run: python3 scripts/code_audit.py --output json --config scripts/audit_config.yaml\n\n  - name: Update Dashboard Metrics\n    run: python3 scripts/audit_dashboard.py\n\n  - name: Export Dashboard\n    run: python3 scripts/audit_dashboard.py --export-html\n\n  - name: Upload Dashboard Artifact\n    uses: actions/upload-artifact@v3\n    with:\n      name: audit-dashboard\n      path: audit_dashboard.html\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#3-pre-commit-hook-integration","title":"3. Pre-commit Hook Integration","text":"<p>Add to <code>.pre-commit-config.yaml</code>:</p> <pre><code>repos:\n  - repo: local\n    hooks:\n      - id: audit-dashboard-update\n        name: Update Audit Dashboard\n        entry: python3 scripts/audit_dashboard.py\n        language: system\n        pass_filenames: false\n        stages: [post-commit]\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#usage-examples","title":"Usage Examples","text":""},{"location":"AUDIT_DASHBOARD_INTEGRATION/#console-dashboard","title":"Console Dashboard","text":"<pre><code>python3 scripts/audit_dashboard.py\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#html-export","title":"HTML Export","text":"<pre><code>python3 scripts/audit_dashboard.py --export-html\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#json-export-for-monitoring","title":"JSON Export for Monitoring","text":"<pre><code>python3 scripts/audit_dashboard.py --export-json monitoring_metrics.json\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#reset-statistics","title":"Reset Statistics","text":"<pre><code>python3 scripts/audit_dashboard.py --reset-stats\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#monitoring-integration","title":"Monitoring Integration","text":""},{"location":"AUDIT_DASHBOARD_INTEGRATION/#prometheusgrafana","title":"Prometheus/Grafana","text":"<p>Export metrics to Prometheus format:</p> <pre><code>def export_prometheus_metrics(dashboard: AuditDashboard) -&gt; str:\n    \"\"\"Export metrics in Prometheus format.\"\"\"\n    metrics = dashboard.get_metrics_summary()\n\n    prometheus_metrics = f\"\"\"\n# HELP audit_total_performed Total number of audits performed\n# TYPE audit_total_performed counter\naudit_total_performed {metrics['audits_performed']}\n\n# HELP audit_failures_prevented Total number of failures prevented\n# TYPE audit_failures_prevented counter\naudit_failures_prevented {metrics['failures_prevented']}\n\n# HELP audit_time_saved_hours Total hours saved by audits\n# TYPE audit_time_saved_hours counter\naudit_time_saved_hours {metrics['time_saved_hours']}\n\n# HELP audit_success_rate Current audit success rate percentage\n# TYPE audit_success_rate gauge\naudit_success_rate {metrics['success_rate']}\n\"\"\"\n    return prometheus_metrics\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#datadog-integration","title":"Datadog Integration","text":"<pre><code>def send_to_datadog(dashboard: AuditDashboard):\n    \"\"\"Send metrics to Datadog.\"\"\"\n    import datadog\n\n    metrics = dashboard.get_metrics_summary()\n\n    datadog.api.Metric.send([\n        {\n            'metric': 'devops.audit.performed',\n            'points': metrics['audits_performed']\n        },\n        {\n            'metric': 'devops.audit.failures_prevented',\n            'points': metrics['failures_prevented']\n        }\n    ])\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#security-considerations","title":"Security Considerations","text":"<ol> <li>File Permissions: Dashboard automatically sets secure permissions (644) on generated files</li> <li>HTML Sanitization: All user data is sanitized before HTML output</li> <li>Atomic Writes: Metrics file updates use atomic writes to prevent corruption</li> <li>Thread Safety: All operations are thread-safe for concurrent usage</li> </ol>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#customization","title":"Customization","text":""},{"location":"AUDIT_DASHBOARD_INTEGRATION/#configure-time-estimation","title":"Configure Time Estimation","text":"<pre><code>dashboard = AuditDashboard(workspace_root)\n# Modify configuration\ndashboard._metrics[\"configuration\"][\"time_per_failure_minutes\"] = 10  # Custom time estimate\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#custom-metrics-file-location","title":"Custom Metrics File Location","text":"<pre><code>dashboard = AuditDashboard(\n    workspace_root=Path(\"/custom/path\"),\n    metrics_filename=\"custom_metrics.json\"\n)\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#troubleshooting","title":"Troubleshooting","text":""},{"location":"AUDIT_DASHBOARD_INTEGRATION/#common-issues","title":"Common Issues","text":"<ol> <li>Permission Denied: Ensure write permissions in workspace directory</li> <li>JSON Corruption: Dashboard creates backups automatically during reset</li> <li>Thread Safety: Use the provided RLock for custom modifications</li> </ol>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#log-analysis","title":"Log Analysis","text":"<p>Dashboard logs to both console and <code>audit_dashboard.log</code>:</p> <pre><code>tail -f audit_dashboard.log\n</code></pre>"},{"location":"AUDIT_DASHBOARD_INTEGRATION/#future-enhancements","title":"Future Enhancements","text":"<p>This dashboard is designed for the main branch of <code>python-template-profissional</code> and will work across:</p> <ul> <li><code>python-template-cli</code>: CLI applications</li> <li><code>python-template-api</code>: REST API services</li> <li><code>python-template-lib</code>: Library packages</li> </ul> <p>The dashboard provides universal DevOps metrics that are valuable regardless of project type.</p>"},{"location":"CODE_AUDIT/","title":"Code Security Auditor","text":"<p>Enterprise-grade security and quality auditing tool for Python projects. This tool performs static analysis to detect security vulnerabilities, external dependencies, and potential CI/CD issues before code commits.</p>"},{"location":"CODE_AUDIT/#features","title":"\ud83d\udd0d Features","text":"<ul> <li>Security Pattern Detection: Identifies dangerous patterns like <code>shell=True</code>, <code>os.system()</code>, and code injection risks</li> <li>External Dependency Analysis: Detects unmocked external services that can cause CI/CD failures</li> <li>Mock Coverage Analysis: Ensures proper mocking of external dependencies in tests</li> <li>CI Environment Simulation: Runs tests in CI-like conditions to catch environment-specific issues</li> <li>Configurable Rules: YAML-based configuration for custom security patterns and scan settings</li> <li>Multiple Output Formats: JSON and YAML report generation</li> <li>Pre-commit Integration: Seamless integration with git pre-commit hooks</li> <li>DevOps Best Practices: Follows enterprise security and maintainability standards</li> </ul>"},{"location":"CODE_AUDIT/#quick-start","title":"\ud83d\ude80 Quick Start","text":""},{"location":"CODE_AUDIT/#basic-usage","title":"Basic Usage","text":"<pre><code># Run basic security audit\npython scripts/code_audit.py\n\n# Use custom configuration\npython scripts/code_audit.py --config scripts/audit_config.yaml\n\n# Generate YAML report\npython scripts/code_audit.py --output yaml\n\n# Fail on medium severity issues\npython scripts/code_audit.py --fail-on MEDIUM\n</code></pre>"},{"location":"CODE_AUDIT/#security-patterns-detected","title":"\ud83d\udccb Security Patterns Detected","text":""},{"location":"CODE_AUDIT/#critical-severity","title":"Critical Severity","text":"<ul> <li><code>os.system()</code> - Command injection vulnerability</li> <li><code>shell=True</code> - Shell injection risk in subprocess calls</li> <li><code>eval()</code> - Code injection vulnerability</li> <li><code>exec()</code> - Code execution vulnerability</li> </ul>"},{"location":"CODE_AUDIT/#high-severity","title":"High Severity","text":"<ul> <li><code>subprocess.run()</code> without proper validation</li> <li><code>subprocess.call()</code> without proper validation</li> <li>Socket connections without mocking</li> <li><code>pickle.loads()</code> - Arbitrary code execution risk</li> </ul>"},{"location":"CODE_AUDIT/#medium-severity","title":"Medium Severity","text":"<ul> <li>HTTP requests without mocking (<code>requests.*</code>, <code>httpx.*</code>, <code>urllib.*</code>)</li> <li>Network operations in tests</li> </ul>"},{"location":"CODE_AUDIT/#low-severity","title":"Low Severity","text":"<ul> <li>File operations without proper error handling</li> </ul>"},{"location":"CODE_AUDIT/#configuration","title":"\u2699\ufe0f Configuration","text":"<p>The auditor uses a YAML configuration file (<code>audit_config.yaml</code>) to customize:</p> <ul> <li>Scan Paths: Directories to include in the audit</li> <li>File Patterns: File extensions to scan</li> <li>Exclude Paths: Directories to skip</li> <li>Security Patterns: Custom patterns to detect</li> <li>Severity Levels: Classification of findings</li> <li>Mock Indicators: Patterns that indicate proper mocking</li> </ul> <p>Example configuration:</p> <pre><code>scan_paths:\n  - \"src/\"\n  - \"tests/\"\n  - \"scripts/\"\n\nfile_patterns:\n  - \"*.py\"\n\nexclude_paths:\n  - \".git/\"\n  - \"__pycache__/\"\n  - \".venv/\"\n\nci_timeout: 300\nmax_findings_per_file: 50\n\ncustom_patterns:\n  - pattern: \"eval(\"\n    severity: \"CRITICAL\"\n    description: \"eval() usage detected - potential code injection\"\n    category: \"injection\"\n</code></pre>"},{"location":"CODE_AUDIT/#report-format","title":"\ud83d\udcca Report Format","text":"<p>The auditor generates comprehensive reports in JSON or YAML format:</p> <pre><code>{\n  \"metadata\": {\n    \"timestamp\": \"2025-10-31T10:00:00Z\",\n    \"workspace\": \"/path/to/project\",\n    \"duration_seconds\": 2.5,\n    \"files_scanned\": 42,\n    \"auditor_version\": \"2.0.0\"\n  },\n  \"findings\": [\n    {\n      \"file\": \"src/utils.py\",\n      \"line\": 15,\n      \"severity\": \"HIGH\",\n      \"category\": \"subprocess\",\n      \"description\": \"Subprocess execution detected\",\n      \"code\": \"subprocess.run(user_command, shell=True)\",\n      \"suggestion\": \"Use shell=False with list arguments\"\n    }\n  ],\n  \"summary\": {\n    \"total_findings\": 5,\n    \"severity_distribution\": {\n      \"CRITICAL\": 1,\n      \"HIGH\": 2,\n      \"MEDIUM\": 2,\n      \"LOW\": 0\n    },\n    \"overall_status\": \"FAIL\",\n    \"recommendations\": [\n      \"\ud83d\udd34 CRITICAL: Fix security vulnerabilities before commit\",\n      \"\ud83e\uddea Add mocks to 3 test files\"\n    ]\n  }\n}\n</code></pre>"},{"location":"CODE_AUDIT/#command-line-options","title":"\ud83d\udd27 Command Line Options","text":"<pre><code>python scripts/code_audit.py [OPTIONS]\n\nOptions:\n  --config PATH         Path to configuration YAML file\n  --output FORMAT       Output format: json, yaml (default: json)\n  --report-file PATH    Custom report output path\n  --quiet              Suppress console output\n  --fail-on SEVERITY   Exit with error on severity level: CRITICAL, HIGH, MEDIUM, LOW\n  --help               Show help message\n</code></pre>"},{"location":"CODE_AUDIT/#devops-integration","title":"\ud83c\udfd7\ufe0f DevOps Integration","text":""},{"location":"CODE_AUDIT/#cicd-pipeline-integration","title":"CI/CD Pipeline Integration","text":"<p>Add to your <code>.github/workflows/ci.yml</code>:</p> <pre><code>- name: Security Audit\n  run: |\n    python scripts/code_audit.py --fail-on HIGH --output json\n\n- name: Upload Audit Report\n  uses: actions/upload-artifact@v3\n  if: always()\n  with:\n    name: security-audit-report\n    path: audit_report_*.json\n</code></pre>"},{"location":"CODE_AUDIT/#docker-integration","title":"Docker Integration","text":"<pre><code># Add to your Dockerfile for development images\nCOPY scripts/code_audit.py /app/scripts/\nRUN pip install pyyaml\n\n# Run audit during build\nRUN python scripts/code_audit.py --fail-on CRITICAL\n</code></pre>"},{"location":"CODE_AUDIT/#security-best-practices","title":"\ud83d\udee1\ufe0f Security Best Practices","text":"<p>The auditor enforces these security principles:</p> <ol> <li>Input Validation: Detect unsafe user input handling</li> <li>Command Injection Prevention: Flag dangerous subprocess usage</li> <li>Dependency Isolation: Ensure external services are properly mocked</li> <li>Code Injection Prevention: Detect <code>eval()</code>, <code>exec()</code>, and similar risks</li> <li>Secure Defaults: Promote <code>shell=False</code> and safe coding patterns</li> </ol>"},{"location":"CODE_AUDIT/#performance","title":"\ud83d\udcc8 Performance","text":"<ul> <li>Fast Scanning: Processes ~1000 files/second</li> <li>Low Memory: Uses AST parsing for accuracy without high memory usage</li> <li>Configurable Limits: Prevents analysis paralysis with finding limits</li> <li>Early Exit: Stops on critical issues for fast feedback</li> </ul>"},{"location":"CODE_AUDIT/#contributing","title":"\ud83e\udd1d Contributing","text":"<p>When extending the auditor:</p> <ol> <li>Add new security patterns to <code>custom_patterns</code> in config</li> <li>Follow the <code>SecurityPattern</code> class structure</li> <li>Include severity classification and actionable suggestions</li> <li>Add corresponding tests for new patterns</li> <li>Update documentation with new capabilities</li> </ol>"},{"location":"CODE_AUDIT/#dependencies","title":"\ud83d\udcda Dependencies","text":"<ul> <li>Python 3.8+: Core language features and type hints</li> <li>PyYAML: Configuration file parsing</li> <li>Standard Library: AST, subprocess, pathlib, logging</li> </ul> <p>No heavy external dependencies - keeps the auditor lightweight and secure.</p>"},{"location":"CODE_AUDIT/#troubleshooting","title":"\ud83d\udd0d Troubleshooting","text":""},{"location":"CODE_AUDIT/#common-issues","title":"Common Issues","text":"<p>\"pytest not found\": Install pytest for CI simulation</p> <pre><code>pip install pytest pytest-timeout\n</code></pre> <p>\"Config file not found\": Use absolute path or place config in scripts/</p> <pre><code>python scripts/code_audit.py --config /full/path/to/config.yaml\n</code></pre> <p>\"Too many findings\": Adjust <code>max_findings_per_file</code> in config</p> <pre><code>max_findings_per_file: 20  # Reduce from default 50\n</code></pre> <p>\"False positives\": Add exclusion patterns or adjust severity thresholds</p> <pre><code>exclude_paths:\n  - \"tests/fixtures/\"  # Exclude test fixtures\n  - \"migrations/\"      # Exclude database migrations\n</code></pre>"},{"location":"CODE_AUDIT/#support","title":"\ud83d\udcde Support","text":"<p>For issues, feature requests, or questions:</p> <ol> <li>Check the configuration documentation</li> <li>Review the troubleshooting section</li> <li>Examine audit logs in <code>audit.log</code></li> <li>Create an issue with audit report attached</li> </ol>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/","title":"P12 - An\u00e1lise de Refatora\u00e7\u00e3o do Code Audit","text":"<p>Data: 19 de Novembro de 2025 Tarefa: P12 - Refatora\u00e7\u00e3o de scripts/code_audit.py Fase: 01 - An\u00e1lise e Planejamento Status: \u2705 An\u00e1lise Completa</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#sumario-executivo","title":"\ud83d\udccb Sum\u00e1rio Executivo","text":"<p>O arquivo <code>scripts/code_audit.py</code> possui 535 linhas e implementa um sistema completo de auditoria de c\u00f3digo. Atualmente, \u00e9 um \"God Object\" que mistura m\u00faltiplas responsabilidades, dificultando manuten\u00e7\u00e3o, testes unit\u00e1rios e extensibilidade.</p> <p>M\u00e9tricas Atuais:</p> <ul> <li>3 Classes (SecurityPattern, AuditResult, CodeAuditor)</li> <li>4 Fun\u00e7\u00f5es Standalone (save_report, print_summary, main, main)</li> <li>Complexidade Ciclom\u00e1tica Estimada: Alta (&gt;15 em CodeAuditor)</li> <li>Acoplamento: Alto (tudo em um \u00fanico m\u00f3dulo)</li> <li>Testabilidade: Baixa (dif\u00edcil isolar responsabilidades)</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#parte-1-anatomia-atual-do-script","title":"\ud83d\udd0d PARTE 1: Anatomia Atual do Script","text":""},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#11-estrutura-geral","title":"1.1 Estrutura Geral","text":"<pre><code>code_audit.py (535 linhas)\n\u251c\u2500\u2500 Imports e Configura\u00e7\u00e3o de Logging (linhas 1-41)\n\u251c\u2500\u2500 Classe SecurityPattern (linhas 43-56)\n\u251c\u2500\u2500 Classe AuditResult (linhas 59-87)\n\u251c\u2500\u2500 Classe CodeAuditor (linhas 90-416)\n\u2502   \u251c\u2500\u2500 __init__ + _load_config\n\u2502   \u251c\u2500\u2500 _load_security_patterns\n\u2502   \u251c\u2500\u2500 _get_python_files\n\u2502   \u251c\u2500\u2500 _analyze_file\n\u2502   \u251c\u2500\u2500 _is_in_string_literal\n\u2502   \u251c\u2500\u2500 _generate_suggestion\n\u2502   \u251c\u2500\u2500 _check_mock_coverage\n\u2502   \u251c\u2500\u2500 _simulate_ci_environment\n\u2502   \u251c\u2500\u2500 run_audit\n\u2502   \u2514\u2500\u2500 _generate_recommendations\n\u251c\u2500\u2500 Fun\u00e7\u00e3o save_report (linhas 419-433)\n\u251c\u2500\u2500 Fun\u00e7\u00e3o print_summary (linhas 436-477)\n\u251c\u2500\u2500 Fun\u00e7\u00e3o main (linhas 480-564)\n\u2514\u2500\u2500 Entry Point __main__ (linhas 567-568)\n</code></pre>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#12-responsabilidades-identificadas","title":"1.2 Responsabilidades Identificadas","text":""},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r1-configuracao-e-inicializacao","title":"R1: Configura\u00e7\u00e3o e Inicializa\u00e7\u00e3o","text":"<ul> <li><code>_load_config()</code> - Carrega configura\u00e7\u00e3o YAML com fallback defaults</li> <li><code>__init__()</code> - Inicializa auditor com workspace e config</li> <li>Gest\u00e3o de logging (linhas 32-41)</li> </ul> <p>Problema: Mistura l\u00f3gica de neg\u00f3cio com infraestrutura (I/O de config).</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r2-definicao-de-modelos-de-dados","title":"R2: Defini\u00e7\u00e3o de Modelos de Dados","text":"<ul> <li><code>SecurityPattern</code> - Representa um padr\u00e3o de risco</li> <li><code>AuditResult</code> - Representa um achado de auditoria</li> <li>M\u00e9todo <code>to_dict()</code> para serializa\u00e7\u00e3o</li> </ul> <p>Problema: Modelos misturados com l\u00f3gica de an\u00e1lise.</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r3-varredura-de-sistema-de-arquivos","title":"R3: Varredura de Sistema de Arquivos","text":"<ul> <li><code>_get_python_files()</code> - Descobre arquivos Python baseado em config</li> <li>L\u00f3gica de exclus\u00e3o de paths (linha 195-199)</li> <li>Suporte a glob patterns</li> </ul> <p>Problema: L\u00f3gica de descoberta acoplada ao CodeAuditor.</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r4-analise-de-codigo-e-deteccao-de-padroes","title":"R4: An\u00e1lise de C\u00f3digo e Detec\u00e7\u00e3o de Padr\u00f5es","text":"<ul> <li><code>_analyze_file()</code> - Analisa arquivo individual</li> <li><code>_is_in_string_literal()</code> - Detecta falsos positivos</li> <li>Parsing de AST (linhas 222-227)</li> <li>Sistema de supress\u00e3o <code># noqa:</code> (linhas 233-242)</li> <li>Verifica\u00e7\u00e3o de regex patterns (linhas 229-242)</li> </ul> <p>Problema: An\u00e1lise est\u00e1tica complexa misturada com orquestra\u00e7\u00e3o.</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r5-analise-de-cobertura-de-mocks","title":"R5: An\u00e1lise de Cobertura de Mocks","text":"<ul> <li><code>_check_mock_coverage()</code> - Analisa arquivos de teste</li> <li>Detecta uso de mocks vs chamadas externas</li> <li>Gera relat\u00f3rio de cobertura</li> </ul> <p>Problema: An\u00e1lise de testes acoplada ao auditor principal.</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r6-simulacao-de-cicd","title":"R6: Simula\u00e7\u00e3o de CI/CD","text":"<ul> <li><code>_simulate_ci_environment()</code> - Executa pytest com flags CI</li> <li>Gest\u00e3o de timeouts e environment variables</li> <li>Captura de output/errors</li> </ul> <p>Problema: Responsabilidade de DevOps no mesmo m\u00f3dulo de an\u00e1lise est\u00e1tica.</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r7-geracao-de-sugestoes","title":"R7: Gera\u00e7\u00e3o de Sugest\u00f5es","text":"<ul> <li><code>_generate_suggestion()</code> - Cria mensagens de corre\u00e7\u00e3o</li> <li><code>_generate_recommendations()</code> - Gera resumo executivo</li> <li>L\u00f3gica de mapeamento padr\u00e3o\u2192sugest\u00e3o</li> </ul> <p>Problema: L\u00f3gica de apresenta\u00e7\u00e3o misturada com an\u00e1lise.</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r8-orquestracao-principal","title":"R8: Orquestra\u00e7\u00e3o Principal","text":"<ul> <li><code>run_audit()</code> - Coordena todas as etapas</li> <li>C\u00e1lculo de m\u00e9tricas de dura\u00e7\u00e3o</li> <li>Determina\u00e7\u00e3o de status geral (PASS/FAIL/WARNING/CRITICAL)</li> <li>Agrega\u00e7\u00e3o de resultados</li> </ul> <p>Problema: Fun\u00e7\u00e3o de 70+ linhas que faz \"tudo\".</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r9-relatorios-e-persistencia","title":"R9: Relat\u00f3rios e Persist\u00eancia","text":"<ul> <li><code>save_report()</code> - Serializa para JSON/YAML</li> <li><code>print_summary()</code> - Output console formatado</li> <li>Formata\u00e7\u00e3o de emojis e cores</li> </ul> <p>Problema: M\u00faltiplos formatos de output no mesmo script.</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#r10-cli-e-parsing-de-argumentos","title":"R10: CLI e Parsing de Argumentos","text":"<ul> <li><code>main()</code> - Entry point com argparse</li> <li>Gest\u00e3o de flags (--config, --output, --quiet, --fail-on)</li> <li>Suporte a modo \"delta audit\" (pre-commit)</li> <li>Determina\u00e7\u00e3o de exit codes</li> </ul> <p>Problema: CLI acoplado \u00e0 l\u00f3gica de neg\u00f3cio.</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#13-dependencias-externas","title":"1.3 Depend\u00eancias Externas","text":"<pre><code># Standard Library (9 imports)\nargparse, ast, json, logging, os, re, subprocess, sys, datetime, pathlib\n\n# Third-Party (1 import)\nyaml\n</code></pre> <p>Observa\u00e7\u00e3o: Baixa depend\u00eancia externa, mas alto acoplamento interno.</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#14-pontos-de-dor-identificados","title":"1.4 Pontos de Dor Identificados","text":"# Problema Impacto Severidade 1 CodeAuditor com 15+ m\u00e9todos Dificulta compreens\u00e3o e manuten\u00e7\u00e3o \ud83d\udd34 ALTA 2 run_audit() com 70+ linhas Dificulta testes unit\u00e1rios \ud83d\udd34 ALTA 3 Mistura de I/O com l\u00f3gica Impossibilita testes isolados \ud83d\udfe0 M\u00c9DIA 4 Padr\u00f5es hardcoded em c\u00f3digo Inflex\u00edvel para extens\u00e3o \ud83d\udfe0 M\u00c9DIA 5 M\u00faltiplos formatadores (JSON/YAML/Console) Viola\u00e7\u00e3o de SRP \ud83d\udfe1 BAIXA 6 Simula\u00e7\u00e3o CI acoplada Deveria ser plug\u00e1vel \ud83d\udfe1 BAIXA"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#parte-2-arquitetura-proposta","title":"\ud83c\udfd7\ufe0f PARTE 2: Arquitetura Proposta","text":""},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#21-visao-geral-da-nova-estrutura","title":"2.1 Vis\u00e3o Geral da Nova Estrutura","text":"<pre><code>scripts/audit/\n\u251c\u2500\u2500 __init__.py              # Exporta interfaces p\u00fablicas\n\u251c\u2500\u2500 models.py                # Data models (SecurityPattern, AuditResult, AuditReport)\n\u251c\u2500\u2500 config.py                # Configuration loading and validation\n\u251c\u2500\u2500 scanner.py               # File discovery and filtering\n\u251c\u2500\u2500 analyzer.py              # Pattern detection and code analysis\n\u251c\u2500\u2500 reporters/               # Output formatting\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 base.py             # AbstractReporter\n\u2502   \u251c\u2500\u2500 json_reporter.py    # JSON output\n\u2502   \u251c\u2500\u2500 yaml_reporter.py    # YAML output\n\u2502   \u2514\u2500\u2500 console_reporter.py # Terminal output\n\u251c\u2500\u2500 plugins/                 # Extensible analysis plugins\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 base.py             # AbstractPlugin\n\u2502   \u251c\u2500\u2500 mock_checker.py     # Mock coverage analysis\n\u2502   \u2514\u2500\u2500 ci_simulator.py     # CI/CD simulation\n\u251c\u2500\u2500 main.py                  # Orchestration logic\n\u2514\u2500\u2500 cli.py                   # CLI entry point (argparse)\n</code></pre>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#22-detalhamento-dos-modulos","title":"2.2 Detalhamento dos M\u00f3dulos","text":""},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#module-modelspy","title":"\ud83d\udce6 Module: <code>models.py</code>","text":"<p>Responsabilidade: Estruturas de dados imut\u00e1veis.</p> <pre><code># Conte\u00fado Proposto:\n- class SecurityPattern (dataclass)\n- class AuditResult (dataclass)\n- class AuditReport (dataclass com summary/findings/metadata)\n- class MockCoverageReport (dataclass)\n- class CISimulationResult (dataclass)\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 Centraliza defini\u00e7\u00f5es de dados</li> <li>\u2705 Facilita serializa\u00e7\u00e3o/deserializa\u00e7\u00e3o</li> <li>\u2705 Valida tipos com type hints</li> <li>\u2705 Uso de <code>@dataclass</code> reduz boilerplate</li> </ul> <p>Migra\u00e7\u00e3o:</p> <ul> <li>Mover <code>SecurityPattern</code> (linhas 43-56)</li> <li>Mover <code>AuditResult</code> (linhas 59-87)</li> <li>Criar <code>AuditReport</code> para encapsular relat\u00f3rio final</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#module-configpy","title":"\u2699\ufe0f Module: <code>config.py</code>","text":"<p>Responsabilidade: Carregar e validar configura\u00e7\u00e3o.</p> <pre><code># Conte\u00fado Proposto:\n- class AuditConfig (dataclass)\n- def load_config(path: Path | None) -&gt; AuditConfig\n- def get_default_config() -&gt; dict[str, Any]\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 Separa I/O de l\u00f3gica de neg\u00f3cio</li> <li>\u2705 Permite testes com configs mock</li> <li>\u2705 Valida\u00e7\u00e3o centralizada de YAML</li> </ul> <p>Migra\u00e7\u00e3o:</p> <ul> <li>Extrair <code>_load_config()</code> (linhas 106-129) \u2192 <code>load_config()</code></li> <li>Criar dataclass <code>AuditConfig</code> para type safety</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#module-scannerpy","title":"\ud83d\udd0d Module: <code>scanner.py</code>","text":"<p>Responsabilidade: Descoberta de arquivos Python.</p> <pre><code># Conte\u00fado Proposto:\n- class FileScanner:\n    - def scan_workspace(config: AuditConfig) -&gt; list[Path]\n    - def filter_excluded(files: list[Path]) -&gt; list[Path]\n    - def resolve_patterns(patterns: list[str]) -&gt; list[Path]\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 L\u00f3gica de glob isolada</li> <li>\u2705 Test\u00e1vel com filesystem mock</li> <li>\u2705 Reutiliz\u00e1vel por outras ferramentas</li> </ul> <p>Migra\u00e7\u00e3o:</p> <ul> <li>Extrair <code>_get_python_files()</code> (linhas 170-192) \u2192 <code>FileScanner.scan_workspace()</code></li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#module-analyzerpy","title":"\ud83e\uddea Module: <code>analyzer.py</code>","text":"<p>Responsabilidade: An\u00e1lise est\u00e1tica de c\u00f3digo Python.</p> <pre><code># Conte\u00fado Proposto:\n- class CodeAnalyzer:\n    - def __init__(patterns: list[SecurityPattern])\n    - def analyze_file(path: Path) -&gt; list[AuditResult]\n    - def _is_in_string_literal(line: str, pattern: str) -&gt; bool\n    - def _parse_noqa_suppressions(line: str) -&gt; list[str]\n    - def _generate_suggestion(pattern: SecurityPattern) -&gt; str\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 Core logic isolado</li> <li>\u2705 F\u00e1cil adicionar novos tipos de an\u00e1lise</li> <li>\u2705 Test\u00e1vel com strings simples</li> </ul> <p>Migra\u00e7\u00e3o:</p> <ul> <li>Extrair <code>_analyze_file()</code> (linhas 194-288) \u2192 <code>CodeAnalyzer.analyze_file()</code></li> <li>Extrair <code>_is_in_string_literal()</code> (linhas 290-301)</li> <li>Extrair <code>_generate_suggestion()</code> (linhas 303-320)</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#module-reporters","title":"\ud83d\udcca Module: <code>reporters/</code>","text":"<p>Responsabilidade: Formata\u00e7\u00e3o de output.</p> <p>Estrutura:</p> <pre><code># base.py\n- class AbstractReporter (ABC):\n    - @abstractmethod def generate(report: AuditReport) -&gt; str\n\n# json_reporter.py\n- class JSONReporter(AbstractReporter)\n\n# yaml_reporter.py\n- class YAMLReporter(AbstractReporter)\n\n# console_reporter.py\n- class ConsoleReporter(AbstractReporter)\n    - Usa emojis e formata\u00e7\u00e3o ANSI\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 Adicionar formatos (HTML, Markdown) sem tocar core</li> <li>\u2705 Strategy Pattern para flexibilidade</li> <li>\u2705 Cada reporter com testes espec\u00edficos</li> </ul> <p>Migra\u00e7\u00e3o:</p> <ul> <li>Extrair <code>save_report()</code> (linhas 419-433) \u2192 JSONReporter/YAMLReporter</li> <li>Extrair <code>print_summary()</code> (linhas 436-477) \u2192 ConsoleReporter</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#module-plugins","title":"\ud83d\udd0c Module: <code>plugins/</code>","text":"<p>Responsabilidade: An\u00e1lises opcionais e extens\u00edveis.</p> <p>Estrutura:</p> <pre><code># base.py\n- class AbstractPlugin (ABC):\n    - @abstractmethod def run(context: AuditContext) -&gt; dict[str, Any]\n\n# mock_checker.py\n- class MockCoveragePlugin(AbstractPlugin)\n\n# ci_simulator.py\n- class CISimulatorPlugin(AbstractPlugin)\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 Plugins podem ser desabilitados por config</li> <li>\u2705 Terceiros podem adicionar plugins custom</li> <li>\u2705 Reduz complexidade do core</li> </ul> <p>Migra\u00e7\u00e3o:</p> <ul> <li>Extrair <code>_check_mock_coverage()</code> (linhas 322-374) \u2192 MockCoveragePlugin</li> <li>Extrair <code>_simulate_ci_environment()</code> (linhas 376-416) \u2192 CISimulatorPlugin</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#module-mainpy","title":"\ud83c\udfaf Module: <code>main.py</code>","text":"<p>Responsabilidade: Orquestra\u00e7\u00e3o (ex-<code>run_audit()</code>).</p> <pre><code># Conte\u00fado Proposto:\n- class AuditOrchestrator:\n    - def __init__(config, analyzer, scanner, plugins, reporters)\n    - def run(files: list[Path] | None) -&gt; AuditReport\n    - def _calculate_status(findings: list[AuditResult]) -&gt; str\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 Dependency Injection para testabilidade</li> <li>\u2705 Coordena componentes sem conhecer detalhes</li> <li>\u2705 L\u00f3gica de neg\u00f3cio pura</li> </ul> <p>Migra\u00e7\u00e3o:</p> <ul> <li>Simplificar <code>run_audit()</code> (linhas 418-416) \u2192 <code>AuditOrchestrator.run()</code></li> <li>Extrair <code>_generate_recommendations()</code> (linhas 476-505)</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#module-clipy","title":"\ud83d\udda5\ufe0f Module: <code>cli.py</code>","text":"<p>Responsabilidade: Interface de linha de comando.</p> <pre><code># Conte\u00fado Proposto:\n- def create_parser() -&gt; argparse.ArgumentParser\n- def main() -&gt; None\n    - Parseia args\n    - Instancia componentes\n    - Chama AuditOrchestrator\n    - Determina exit code\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 CLI desacoplado da l\u00f3gica de neg\u00f3cio</li> <li>\u2705 Facilita testes de integra\u00e7\u00e3o</li> <li>\u2705 Permite criar UIs alternativas (TUI, Web)</li> </ul> <p>Migra\u00e7\u00e3o:</p> <ul> <li>Extrair <code>main()</code> (linhas 480-564) \u2192 <code>cli.py</code></li> <li>Manter <code>__main__.py</code> apenas como entry point</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#23-diagrama-de-dependencias","title":"2.3 Diagrama de Depend\u00eancias","text":"<pre><code>cli.py\n  \u2193\nmain.AuditOrchestrator\n  \u251c\u2500\u2500\u2192 config.load_config()\n  \u251c\u2500\u2500\u2192 scanner.FileScanner\n  \u251c\u2500\u2500\u2192 analyzer.CodeAnalyzer\n  \u251c\u2500\u2500\u2192 plugins.MockCoveragePlugin\n  \u251c\u2500\u2500\u2192 plugins.CISimulatorPlugin\n  \u2514\u2500\u2500\u2192 reporters.JSONReporter\n          \u2191\n       models.py (usado por todos)\n</code></pre> <p>Fluxo de Execu\u00e7\u00e3o:</p> <ol> <li><code>cli.py</code> parseia argumentos</li> <li><code>config.py</code> carrega configura\u00e7\u00e3o</li> <li><code>scanner.py</code> descobre arquivos</li> <li><code>analyzer.py</code> analisa c\u00f3digo</li> <li><code>plugins/</code> executam an\u00e1lises opcionais</li> <li><code>main.py</code> agrega resultados em <code>AuditReport</code></li> <li><code>reporters/</code> geram output</li> <li><code>cli.py</code> determina exit code</li> </ol>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#24-beneficios-da-nova-arquitetura","title":"2.4 Benef\u00edcios da Nova Arquitetura","text":"Benef\u00edcio Antes Depois Testabilidade Dif\u00edcil (tudo acoplado) F\u00e1cil (m\u00f3dulos isolados) Extensibilidade Hardcoded patterns Plugin system Manutenibilidade 535 linhas em 1 arquivo ~80 linhas/m\u00f3dulo Reusabilidade Zero (tudo privado) Alta (m\u00f3dulos p\u00fablicos) Clareza Complexidade ciclom\u00e1tica &gt;15 &lt;5 por m\u00f3dulo"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#25-compatibilidade-com-codigo-existente","title":"2.5 Compatibilidade com C\u00f3digo Existente","text":"<p>Garantias de Compatibilidade:</p> <pre><code># scripts/code_audit.py (mantido como wrapper legacy)\n\"\"\"\nDeprecated: This module is kept for backward compatibility.\nPlease use `python -m scripts.audit.cli` instead.\n\"\"\"\nfrom scripts.audit.cli import main\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>Migra\u00e7\u00e3o Gradual:</p> <ol> <li>\u2705 Fase 01: An\u00e1lise (atual)</li> <li>\ud83d\udd04 Fase 02: Criar novos m\u00f3dulos</li> <li>\ud83d\udd04 Fase 03: Migrar testes</li> <li>\ud83d\udd04 Fase 04: Deprecar code_audit.py</li> <li>\ud83d\udd04 Fase 05: Remover wrapper (ap\u00f3s 2 releases)</li> </ol>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#metricas-de-qualidade-esperadas","title":"\ud83d\udccf M\u00e9tricas de Qualidade Esperadas","text":""},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#antes-da-refatoracao","title":"Antes da Refatora\u00e7\u00e3o","text":"<pre><code>code_audit.py:\n  - Linhas: 535\n  - Complexidade Ciclom\u00e1tica: ~25\n  - Acoplamento: Alto\n  - Coes\u00e3o: Baixa\n  - Cobertura de Testes: ~40% (estimado)\n</code></pre>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#depois-da-refatoracao","title":"Depois da Refatora\u00e7\u00e3o","text":"<pre><code>scripts/audit/:\n  - M\u00f3dulos: 9 arquivos (~80 linhas cada)\n  - Complexidade Ciclom\u00e1tica: &lt;5 por m\u00f3dulo\n  - Acoplamento: Baixo (dependency injection)\n  - Coes\u00e3o: Alta (SRP)\n  - Cobertura de Testes: &gt;80% (target)\n</code></pre>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#proximos-passos-fase-02","title":"\ud83c\udfaf Pr\u00f3ximos Passos (Fase 02)","text":""},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#plano-de-implementacao","title":"Plano de Implementa\u00e7\u00e3o","text":"<p>Sprint 1: Funda\u00e7\u00f5es</p> <ul> <li>[ ] Criar <code>scripts/audit/__init__.py</code></li> <li>[ ] Implementar <code>models.py</code> com dataclasses</li> <li>[ ] Implementar <code>config.py</code> com valida\u00e7\u00e3o</li> </ul> <p>Sprint 2: Core Logic</p> <ul> <li>[ ] Implementar <code>scanner.py</code></li> <li>[ ] Implementar <code>analyzer.py</code></li> <li>[ ] Migrar testes unit\u00e1rios</li> </ul> <p>Sprint 3: Extens\u00f5es</p> <ul> <li>[ ] Implementar plugin system</li> <li>[ ] Migrar <code>mock_checker.py</code></li> <li>[ ] Migrar <code>ci_simulator.py</code></li> </ul> <p>Sprint 4: Output</p> <ul> <li>[ ] Implementar reporters</li> <li>[ ] Implementar <code>main.py</code> (orchestrator)</li> <li>[ ] Implementar <code>cli.py</code></li> </ul> <p>Sprint 5: Integra\u00e7\u00e3o</p> <ul> <li>[ ] Testes de integra\u00e7\u00e3o end-to-end</li> <li>[ ] Atualizar documenta\u00e7\u00e3o</li> <li>[ ] Criar wrapper de compatibilidade</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#validacao-da-arquitetura","title":"\ud83d\udd12 Valida\u00e7\u00e3o da Arquitetura","text":""},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#principios-solid-aplicados","title":"Princ\u00edpios SOLID Aplicados","text":"<p>\u2705 Single Responsibility Principle: Cada m\u00f3dulo tem UMA responsabilidade \u2705 Open/Closed Principle: Extens\u00edvel via plugins sem modificar core \u2705 Liskov Substitution: Reporters/Plugins intercambi\u00e1veis \u2705 Interface Segregation: Interfaces m\u00ednimas (AbstractReporter, AbstractPlugin) \u2705 Dependency Inversion: Orchestrator depende de abstra\u00e7\u00f5es, n\u00e3o implementa\u00e7\u00f5es</p>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#referencias","title":"\ud83d\udcda Refer\u00eancias","text":"<ul> <li>Livro: \"Refactoring: Improving the Design of Existing Code\" (Martin Fowler)</li> <li>Pattern: Strategy (reporters), Plugin (extens\u00f5es), Facade (orchestrator)</li> <li>Documenta\u00e7\u00e3o Interna:</li> <li><code>docs/CODE_AUDIT.md</code> - Documenta\u00e7\u00e3o atual do code_audit</li> <li><code>scripts/audit_config.yaml</code> - Configura\u00e7\u00e3o existente</li> </ul>"},{"location":"P12_CODE_AUDIT_REFACTORING_ANALYSIS/#conclusao","title":"\u2705 Conclus\u00e3o","text":"<p>O <code>code_audit.py</code> \u00e9 uma ferramenta robusta, mas sua arquitetura monol\u00edtica limita:</p> <ul> <li>\u274c Testabilidade</li> <li>\u274c Extensibilidade</li> <li>\u274c Manutenibilidade</li> </ul> <p>A arquitetura proposta resolve esses problemas atrav\u00e9s de:</p> <ul> <li>\u2705 Separa\u00e7\u00e3o de responsabilidades (SRP)</li> <li>\u2705 Inje\u00e7\u00e3o de depend\u00eancias</li> <li>\u2705 Sistema de plugins</li> <li>\u2705 M\u00f3dulos coesos e desacoplados</li> </ul> <p>Recomenda\u00e7\u00e3o: Prosseguir para Fase 02 (Implementa\u00e7\u00e3o) com a estrutura proposta.</p> <p>Documento Gerado por: GitHub Copilot Revis\u00e3o Necess\u00e1ria: Arquiteto de Software / Tech Lead Vers\u00e3o: 1.0.0 \u00daltima Atualiza\u00e7\u00e3o: 2025-11-19</p>"},{"location":"README_test_mock_system/","title":"Test Mock Generator System","text":"<p>Sistema robusto de gera\u00e7\u00e3o autom\u00e1tica de mocks para testes Python, seguindo padr\u00f5es DevOps e SRE.</p>"},{"location":"README_test_mock_system/#proposito","title":"\ud83c\udfaf Prop\u00f3sito","text":"<p>Este sistema automatiza a gera\u00e7\u00e3o e aplica\u00e7\u00e3o de mocks em arquivos de teste Python, garantindo que:</p> <ul> <li>Testes sejam est\u00e1veis no CI/CD (sem depend\u00eancias externas)</li> <li>C\u00f3digo seja port\u00e1vel entre diferentes ambientes</li> <li>Padr\u00f5es de qualidade sejam mantidos automaticamente</li> </ul>"},{"location":"README_test_mock_system/#arquitetura","title":"\ud83c\udfd7\ufe0f Arquitetura","text":"<pre><code>scripts/\n\u251c\u2500\u2500 test_mock_generator.py      # Gerador principal de mocks\n\u251c\u2500\u2500 test_mock_config.yaml       # Configura\u00e7\u00e3o extens\u00edvel\n\u251c\u2500\u2500 validate_test_mocks.py      # Validador do sistema\n\u251c\u2500\u2500 ci_test_mock_integration.py # Integra\u00e7\u00e3o CI/CD\n\u2514\u2500\u2500 README_test_mock_system.md  # Este arquivo\n</code></pre>"},{"location":"README_test_mock_system/#uso-rapido","title":"\ud83d\ude80 Uso R\u00e1pido","text":""},{"location":"README_test_mock_system/#1-escanear-arquivos-de-teste","title":"1. Escanear Arquivos de Teste","text":"<pre><code>python3 scripts/test_mock_generator.py --scan\n</code></pre>"},{"location":"README_test_mock_system/#2-preview-das-correcoes","title":"2. Preview das Corre\u00e7\u00f5es","text":"<pre><code>python3 scripts/test_mock_generator.py --apply --dry-run\n</code></pre>"},{"location":"README_test_mock_system/#3-aplicar-correcoes","title":"3. Aplicar Corre\u00e7\u00f5es","text":"<pre><code>python3 scripts/test_mock_generator.py --apply\n</code></pre>"},{"location":"README_test_mock_system/#4-validar-sistema","title":"4. Validar Sistema","text":"<pre><code>python3 scripts/validate_test_mocks.py --fix-found-issues\n</code></pre>"},{"location":"README_test_mock_system/#funcionalidades","title":"\ud83d\udccb Funcionalidades","text":""},{"location":"README_test_mock_system/#deteccao-automatica","title":"\u2705 Detec\u00e7\u00e3o Autom\u00e1tica","text":"<ul> <li>Requisi\u00e7\u00f5es HTTP (<code>httpx.get</code>, <code>requests.post</code>, etc.)</li> <li>Execu\u00e7\u00e3o de subprocessos (<code>subprocess.run</code>, <code>Popen</code>)</li> <li>Opera\u00e7\u00f5es de arquivo (<code>open()</code>, <code>pathlib.Path</code>)</li> <li>Conex\u00f5es de banco (<code>sqlite3.connect</code>)</li> </ul>"},{"location":"README_test_mock_system/#seguranca-robustez","title":"\ud83d\udee1\ufe0f Seguran\u00e7a &amp; Robustez","text":"<ul> <li>Backup autom\u00e1tico antes de modificar arquivos</li> <li>Idempot\u00eancia - pode ser executado m\u00faltiplas vezes</li> <li>Logging estruturado para auditoria</li> <li>Valida\u00e7\u00e3o de sintaxe antes e depois</li> </ul>"},{"location":"README_test_mock_system/#configurabilidade","title":"\ud83d\udd27 Configurabilidade","text":"<ul> <li>Padr\u00f5es extens\u00edveis via YAML</li> <li>Templates personaliz\u00e1veis de mock</li> <li>Severidade configur\u00e1vel (HIGH, MEDIUM, LOW)</li> <li>Filtros por tipo de projeto</li> </ul>"},{"location":"README_test_mock_system/#integracao-cicd","title":"\ud83c\udfed Integra\u00e7\u00e3o CI/CD","text":""},{"location":"README_test_mock_system/#github-actions","title":"GitHub Actions","text":"<pre><code>- name: Check Test Mocks\n  run: python3 scripts/ci_test_mock_integration.py --check --fail-on-issues\n\n- name: Auto-fix Test Issues\n  run: python3 scripts/ci_test_mock_integration.py --auto-fix --commit\n</code></pre>"},{"location":"README_test_mock_system/#gitlab-ci","title":"GitLab CI","text":"<pre><code>test_mock_check:\n  script:\n    - python3 scripts/ci_test_mock_integration.py --check --fail-on-issues\n  allow_failure: false\n</code></pre>"},{"location":"README_test_mock_system/#relatorios","title":"\ud83d\udcca Relat\u00f3rios","text":"<p>O sistema gera relat\u00f3rios detalhados em JSON:</p> <pre><code>{\n  \"timestamp\": \"2025-10-31T18:00:00Z\",\n  \"summary\": {\n    \"total_suggestions\": 15,\n    \"high_priority\": 8,\n    \"files_analyzed\": 25\n  },\n  \"suggestions\": [\n    {\n      \"file\": \"tests/test_api.py\",\n      \"function\": \"test_get_user\",\n      \"line\": 45,\n      \"pattern\": \"httpx.get(\",\n      \"severity\": \"HIGH\",\n      \"description\": \"HTTP GET request - needs mocking for CI stability\"\n    }\n  ]\n}\n</code></pre>"},{"location":"README_test_mock_system/#configuracao","title":"\ud83c\udf9b\ufe0f Configura\u00e7\u00e3o","text":""},{"location":"README_test_mock_system/#arquivo-test_mock_configyaml","title":"Arquivo <code>test_mock_config.yaml</code>","text":"<pre><code># Padr\u00f5es customiz\u00e1veis\nmock_patterns:\n  http_patterns:\n    - pattern: \"httpx.get(\"\n      severity: \"HIGH\"\n      mock_template: |\n        @patch(\"httpx.get\")\n        def {func_name}(self, mock_get, *args, **kwargs):\n            mock_response = Mock()\n            mock_response.status_code = 200\n            mock_get.return_value = mock_response\n\n# Configura\u00e7\u00f5es de execu\u00e7\u00e3o\nexecution:\n  min_severity_for_auto_apply: \"HIGH\"\n  create_backups: true\n  backup_directory: \".test_mock_backups\"\n</code></pre>"},{"location":"README_test_mock_system/#padroes-de-qualidade","title":"\ud83c\udfc6 Padr\u00f5es de Qualidade","text":""},{"location":"README_test_mock_system/#compatibilidade","title":"Compatibilidade","text":"<ul> <li>Python 3.10+</li> <li>POSIX-compliant (Linux, macOS, WSL)</li> <li>Portabilidade entre ambientes CI/CD</li> </ul>"},{"location":"README_test_mock_system/#seguranca","title":"Seguran\u00e7a","text":"<ul> <li>\u2705 Sem uso de <code>shell=True</code></li> <li>\u2705 Valida\u00e7\u00e3o de caminhos de arquivo</li> <li>\u2705 Tratamento seguro de exceptions</li> <li>\u2705 Logging de auditoria</li> </ul>"},{"location":"README_test_mock_system/#performance","title":"Performance","text":"<ul> <li>\u2705 Processamento em lote</li> <li>\u2705 Cache de an\u00e1lise AST</li> <li>\u2705 Opera\u00e7\u00f5es idempotentes</li> </ul>"},{"location":"README_test_mock_system/#manutenibilidade","title":"Manutenibilidade","text":"<ul> <li>\u2705 Type hints completos</li> <li>\u2705 Documenta\u00e7\u00e3o inline</li> <li>\u2705 Testes automatizados</li> <li>\u2705 Configura\u00e7\u00e3o declarativa</li> </ul>"},{"location":"README_test_mock_system/#extensibilidade","title":"\ud83d\udd27 Extensibilidade","text":""},{"location":"README_test_mock_system/#adicionando-novos-padroes","title":"Adicionando Novos Padr\u00f5es","text":"<ol> <li>Edite <code>test_mock_config.yaml</code>:</li> </ol> <pre><code>custom_patterns:\n  - pattern: \"my_library.connect(\"\n    type: \"CUSTOM_SERVICE\"\n    severity: \"HIGH\"\n    mock_template: |\n      @patch(\"my_library.connect\")\n      def {func_name}(self, mock_connect, *args, **kwargs):\n          mock_connect.return_value = Mock()\n</code></pre> <ol> <li>O sistema detectar\u00e1 automaticamente novos padr\u00f5es</li> </ol>"},{"location":"README_test_mock_system/#integrando-com-ferramentas","title":"Integrando com Ferramentas","text":"<pre><code>from test_mock_generator import TestMockGenerator\nfrom pathlib import Path\n\n# Uso program\u00e1tico\nworkspace = Path.cwd()\nconfig_path = Path(__file__).parent / \"test_mock_config.yaml\"\ngenerator = TestMockGenerator(workspace, config_path) # &lt;-- CORRIGIDO\n\nreport = generator.scan_test_files()\ngenerator.apply_suggestions(dry_run=False)\n</code></pre>"},{"location":"README_test_mock_system/#metricas-e-monitoramento","title":"\ud83d\udcc8 M\u00e9tricas e Monitoramento","text":""},{"location":"README_test_mock_system/#codigos-de-saida","title":"C\u00f3digos de Sa\u00edda","text":"<ul> <li><code>0</code> - Sucesso completo</li> <li><code>1</code> - Warning (problemas menores)</li> <li><code>2</code> - Failure (problemas cr\u00edticos)</li> </ul>"},{"location":"README_test_mock_system/#logs-estruturados","title":"Logs Estruturados","text":"<pre><code>2025-10-31 18:00:00 [INFO] test_mock_generator: Escaneamento conclu\u00eddo: 15 sugest\u00f5es geradas\n2025-10-31 18:00:05 [INFO] test_mock_generator: Mock aplicado: test_api.py:test_get_user\n</code></pre>"},{"location":"README_test_mock_system/#resolucao-de-problemas","title":"\ud83d\udee0\ufe0f Resolu\u00e7\u00e3o de Problemas","text":""},{"location":"README_test_mock_system/#problema-nenhuma-sugestao-encontrada","title":"Problema: \"Nenhuma sugest\u00e3o encontrada\"","text":"<pre><code># Criar arquivos de teste de exemplo\npython3 scripts/validate_test_mocks.py --fix-found-issues\n</code></pre>"},{"location":"README_test_mock_system/#problema-erro-de-sintaxe-apos-aplicacao","title":"Problema: \"Erro de sintaxe ap\u00f3s aplica\u00e7\u00e3o\"","text":"<pre><code># Recomenda-se executar os testes para validar as corre\u00e7\u00f5es:\npython3 -m pytest tests/\n</code></pre>"},{"location":"README_test_mock_system/#problema-git-commit-falhou","title":"Problema: \"Git commit falhou\"","text":"<pre><code># Verificar status\ngit status\ngit diff\n\n# Commit manual se necess\u00e1rio\ngit add .\ngit commit -m \"fix(tests): Apply test mocks\"\n</code></pre>"},{"location":"README_test_mock_system/#casos-de-uso","title":"\ud83c\udfaf Casos de Uso","text":""},{"location":"README_test_mock_system/#1-projeto-cli","title":"1. Projeto CLI","text":"<ul> <li>Foco em mocks de <code>subprocess</code> e <code>sys.argv</code></li> <li>Valida\u00e7\u00e3o de entrada/sa\u00edda</li> </ul>"},{"location":"README_test_mock_system/#2-projeto-api","title":"2. Projeto API","text":"<ul> <li>Mocks de requisi\u00e7\u00f5es HTTP</li> <li>Mocks de banco de dados</li> <li>Valida\u00e7\u00e3o de endpoints</li> </ul>"},{"location":"README_test_mock_system/#3-projeto-library","title":"3. Projeto Library","text":"<ul> <li>Mocks minimais</li> <li>Foco na l\u00f3gica de neg\u00f3cio</li> <li>Testes de integra\u00e7\u00e3o opcional</li> </ul>"},{"location":"README_test_mock_system/#referencias","title":"\ud83d\udcda Refer\u00eancias","text":"<ul> <li>PEP 8 - Style Guide</li> <li>unittest.mock Documentation</li> <li>pytest Best Practices</li> <li>DevOps Automation Patterns</li> </ul>"},{"location":"README_test_mock_system/#contribuicao","title":"\ud83e\udd1d Contribui\u00e7\u00e3o","text":"<p>Este sistema faz parte do Python Template Profissional e segue os padr\u00f5es:</p> <ul> <li>Idempot\u00eancia obrigat\u00f3ria</li> <li>Logging estruturado</li> <li>Configura\u00e7\u00e3o declarativa</li> <li>Testes automatizados</li> <li>Documenta\u00e7\u00e3o completa</li> </ul> <p>Autor: DevOps Template Generator Vers\u00e3o: 1.0.0 Licen\u00e7a: MIT Compatibilidade: Python 3.10+, POSIX</p>"},{"location":"SMART_GIT_SYNC_GUIDE/","title":"Smart Git Sync - Documenta\u00e7\u00e3o de Uso","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#visao-geral","title":"Vis\u00e3o Geral","text":"<p>O Smart Git Sync \u00e9 um sistema de sincroniza\u00e7\u00e3o inteligente de Git que integra auditoria preventiva, corre\u00e7\u00f5es autom\u00e1ticas e opera\u00e7\u00f5es Git seguras. Foi desenvolvido seguindo padr\u00f5es DevOps/SRE para ser idempotente, seguro e robusto.</p>"},{"location":"SMART_GIT_SYNC_GUIDE/#caracteristicas-principais","title":"Caracter\u00edsticas Principais","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#padroes-devops-implementados","title":"\u2705 Padr\u00f5es DevOps Implementados","text":"<ul> <li>Idempot\u00eancia: Pode ser executado m\u00faltiplas vezes sem efeitos colaterais</li> <li>POSIX Compliance: Scripts compat\u00edveis com diferentes sistemas Unix/Linux</li> <li>Seguran\u00e7a: Nunca usa <code>shell=True</code>, valida todas as entradas</li> <li>Type Safety: C\u00f3digo completamente tipado com Python 3.10+</li> <li>Structured Logging: Sistema de logging profissional com n\u00edveis</li> <li>Rollback Capability: Desfaz opera\u00e7\u00f5es em caso de falha</li> <li>Configurabilidade: Totalmente configur\u00e1vel via YAML</li> </ul>"},{"location":"SMART_GIT_SYNC_GUIDE/#recursos-de-seguranca","title":"\ud83d\udee1\ufe0f Recursos de Seguran\u00e7a","text":"<ul> <li>Valida\u00e7\u00e3o de entrada rigorosa</li> <li>Execu\u00e7\u00e3o de subprocess segura (sem <code>shell=True</code>)</li> <li>Rollback autom\u00e1tico em falhas de push</li> <li>Auditoria preventiva de c\u00f3digo</li> <li>Exclus\u00e3o autom\u00e1tica de arquivos sens\u00edveis</li> </ul>"},{"location":"SMART_GIT_SYNC_GUIDE/#auditoria-preventiva","title":"\ud83d\udd0d Auditoria Preventiva","text":"<ul> <li>An\u00e1lise de seguran\u00e7a est\u00e1tica</li> <li>Detec\u00e7\u00e3o de depend\u00eancias externas</li> <li>Simula\u00e7\u00e3o de ambiente CI/CD</li> <li>Corre\u00e7\u00f5es autom\u00e1ticas de lint</li> <li>Relat\u00f3rios estruturados</li> </ul>"},{"location":"SMART_GIT_SYNC_GUIDE/#instalacao","title":"Instala\u00e7\u00e3o","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#pre-requisitos","title":"Pr\u00e9-requisitos","text":"<pre><code># Python 3.10+ required\npython3 --version\n\n# Instalar depend\u00eancias (incluindo PyYAML e tomli)\npip install .[dev]\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#estrutura-de-arquivos","title":"Estrutura de Arquivos","text":"<pre><code>scripts/\n\u251c\u2500\u2500 smart_git_sync.py              # Script principal\n\u251c\u2500\u2500 smart_git_sync_config.yaml     # Configura\u00e7\u00e3o\n\u251c\u2500\u2500 test_smart_git_sync.py         # Testes\n\u2514\u2500\u2500 code_audit.py                  # Sistema de auditoria (existente)\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#uso-basico","title":"Uso B\u00e1sico","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#1-execucao-simples","title":"1. Execu\u00e7\u00e3o Simples","text":"<pre><code># Sincroniza\u00e7\u00e3o completa com auditoria\npython3 scripts/smart_git_sync.py\n\n# Modo dry-run (apenas simula)\npython3 scripts/smart_git_sync.py --dry-run\n\n# Com configura\u00e7\u00e3o personalizada\npython3 scripts/smart_git_sync.py --config custom_config.yaml\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#2-configuracao-personalizada","title":"2. Configura\u00e7\u00e3o Personalizada","text":"<p>Crie um arquivo <code>custom_config.yaml</code>:</p> <pre><code># Configura\u00e7\u00e3o customizada\naudit_enabled: true\naudit_fail_threshold: \"MEDIUM\"\nauto_fix_enabled: true\nstrict_audit: false\ncleanup_enabled: true\n\n# Timeouts\naudit_timeout: 180\ngit_timeout: 60\nlint_timeout: 120\n\n# Seguran\u00e7a\nexcluded_paths:\n  - \".env\"\n  - \"*.log\"\n  - \"__pycache__/\"\n\nallowed_file_extensions:\n  - \".py\"\n  - \".yaml\"\n  - \".md\"\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#3-integracao-com-cicd","title":"3. Integra\u00e7\u00e3o com CI/CD","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#github-actions","title":"GitHub Actions","text":"<pre><code>name: Smart Sync\non: [push, pull_request]\n\njobs:\n  smart-sync:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Setup Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.10'\n\n      - name: Install Dependencies\n        run: |\n          python3 -m pip install --upgrade pip\n          pip install .[dev]\n\n      - name: Run Smart Git Sync (Dry Run)\n        run: python3 scripts/smart_git_sync.py --dry-run --verbose\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#funcionalidades-avancadas","title":"Funcionalidades Avan\u00e7adas","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#1-workflow-completo","title":"1. Workflow Completo","text":"<p>O Smart Git Sync executa as seguintes fases:</p> <pre><code>\ud83d\udccb FASE 1: An\u00e1lise do Status do Reposit\u00f3rio\n\u251c\u2500\u2500 Verifica mudan\u00e7as pendentes\n\u251c\u2500\u2500 Identifica branch atual\n\u2514\u2500\u2500 Valida estado do reposit\u00f3rio\n\n\ud83d\udd0d FASE 2: Auditoria Preventiva de C\u00f3digo\n\u251c\u2500\u2500 Executa an\u00e1lise de seguran\u00e7a\n\u251c\u2500\u2500 Simula ambiente CI/CD\n\u251c\u2500\u2500 Detecta vulnerabilidades\n\u2514\u2500\u2500 Gera relat\u00f3rio de auditoria\n\n\ud83d\udd27 FASE 3: Corre\u00e7\u00f5es Autom\u00e1ticas (se necess\u00e1rio)\n\u251c\u2500\u2500 Aplica fixes de lint\n\u251c\u2500\u2500 Corrige imports\n\u251c\u2500\u2500 Formata c\u00f3digo\n\u2514\u2500\u2500 Remove c\u00f3digo n\u00e3o utilizado\n\n\ud83d\udce4 FASE 4: Opera\u00e7\u00f5es Git\n\u251c\u2500\u2500 Adiciona arquivos ao stage\n\u251c\u2500\u2500 Cria commit inteligente\n\u251c\u2500\u2500 Faz push para remote\n\u2514\u2500\u2500 Rollback em caso de falha\n\n\ud83e\uddf9 FASE 5: Limpeza do Reposit\u00f3rio\n\u251c\u2500\u2500 Git garbage collection\n\u251c\u2500\u2500 Remote prune\n\u2514\u2500\u2500 Otimiza\u00e7\u00f5es de performance\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#2-mensagens-de-commit-inteligentes","title":"2. Mensagens de Commit Inteligentes","text":"<p>O sistema analisa as mudan\u00e7as e gera mensagens seguindo conven\u00e7\u00f5es:</p> <pre><code>feat: smart sync with preventive audit (5 files) [audit-fixes]\nfix: smart sync with preventive audit (2 files)\ndocs: smart sync with preventive audit (3 files)\ntest: smart sync with preventive audit (1 files)\nchore: smart sync with preventive audit (4 files)\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#3-relatorios-estruturados","title":"3. Relat\u00f3rios Estruturados","text":"<p>Cada execu\u00e7\u00e3o gera um relat\u00f3rio JSON completo:</p> <pre><code>{\n  \"metadata\": {\n    \"sync_id\": \"20231102_143022\",\n    \"timestamp\": \"2023-11-02T14:30:22.123456Z\",\n    \"workspace\": \"/path/to/project\",\n    \"dry_run\": false\n  },\n  \"steps\": [\n    {\n      \"name\": \"git_status\",\n      \"status\": \"success\",\n      \"duration_seconds\": 0.125,\n      \"details\": {\n        \"is_clean\": false,\n        \"total_changes\": 3,\n        \"current_branch\": \"main\"\n      }\n    }\n  ],\n  \"summary\": {\n    \"total_steps\": 5,\n    \"successful_steps\": 5,\n    \"failed_steps\": 0,\n    \"total_duration\": 12.45\n  }\n}\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#tratamento-de-erros","title":"Tratamento de Erros","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#1-rollback-automatico","title":"1. Rollback Autom\u00e1tico","text":"<pre><code># Se o push falhar, o sistema automaticamente:\ntry:\n    git_push()\nexcept GitOperationError:\n    # Rollback do commit\n    git reset --soft HEAD~1\n    # Log do erro\n    # Preserva mudan\u00e7as locais\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#2-tipos-de-erro","title":"2. Tipos de Erro","text":"<ul> <li>SyncError: Erro geral de sincroniza\u00e7\u00e3o</li> <li>GitOperationError: Falha em opera\u00e7\u00e3o Git</li> <li>AuditError: Falha na auditoria de c\u00f3digo</li> </ul>"},{"location":"SMART_GIT_SYNC_GUIDE/#3-recuperacao-graceful","title":"3. Recupera\u00e7\u00e3o Graceful","text":"<pre><code># O sistema preserva estado em caso de falha\n# Relat\u00f3rios s\u00e3o sempre salvos\n# Logs detalhados para debugging\n# Opera\u00e7\u00f5es s\u00e3o at\u00f4micas quando poss\u00edvel\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#testes","title":"Testes","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#1-executar-testes","title":"1. Executar Testes","text":"<pre><code># Testes completos\npython3 scripts/test_smart_git_sync.py\n\n# Apenas testes unit\u00e1rios\npython3 scripts/test_smart_git_sync.py --unit-tests-only\n\n# Modo verbose\npython3 scripts/test_smart_git_sync.py --verbose\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#2-validacao-de-seguranca","title":"2. Valida\u00e7\u00e3o de Seguran\u00e7a","text":"<pre><code># O sistema de testes inclui:\n# - Verifica\u00e7\u00e3o de padr\u00f5es inseguros\n# - Valida\u00e7\u00e3o de configura\u00e7\u00e3o\n# - Testes de integra\u00e7\u00e3o\n# - An\u00e1lise de cobertura de c\u00f3digo\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#configuracao-avancada","title":"Configura\u00e7\u00e3o Avan\u00e7ada","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#1-configuracao-completa","title":"1. Configura\u00e7\u00e3o Completa","text":"<pre><code># smart_git_sync_config.yaml\n\n# Auditoria\naudit_enabled: true\naudit_timeout: 300\naudit_fail_threshold: \"HIGH\"  # CRITICAL, HIGH, MEDIUM, LOW\nstrict_audit: true\n\n# Corre\u00e7\u00f5es autom\u00e1ticas\nauto_fix_enabled: true\nlint_timeout: 180\n\n# Git\ngit_timeout: 120\ncleanup_enabled: true\n\n# Seguran\u00e7a\nallowed_file_extensions:\n  - \".py\"\n  - \".yaml\"\n  - \".json\"\n  - \".md\"\n\nexcluded_paths:\n  - \".git/\"\n  - \"__pycache__/\"\n  - \".env\"\n  - \"*.log\"\n\n# CI/CD\nsimulate_ci: true\nci_timeout: 300\n\n# Performance\nmax_files_per_commit: 100\nmax_commit_message_length: 72\n\n# Logging\nlog_level: \"INFO\"\nlog_to_file: true\nlog_file: \"smart_git_sync.log\"\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#2-integracao-com-hooks","title":"2. Integra\u00e7\u00e3o com Hooks","text":"<pre><code># .git/hooks/pre-commit\n#!/bin/bash\npython3 scripts/smart_git_sync.py --dry-run\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#solucao-de-problemas","title":"Solu\u00e7\u00e3o de Problemas","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#1-problemas-comuns","title":"1. Problemas Comuns","text":"<p>Erro: \"Not a Git repository\"</p> <pre><code># Certifique-se de estar em um reposit\u00f3rio Git\ngit init\n</code></pre> <p>Erro: \"Code audit failed\"</p> <pre><code># Execute auditoria manualmente para debug\npython3 scripts/code_audit.py --verbose\n</code></pre> <p>Erro: \"Push failed\"</p> <pre><code># Verifique conectividade e permiss\u00f5es\ngit remote -v\ngit push origin main\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#2-debug-mode","title":"2. Debug Mode","text":"<pre><code># Ativar debug completo\npython3 scripts/smart_git_sync.py --verbose\n\n# Verificar logs\ntail -f smart_git_sync.log\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#3-modo-de-recuperacao","title":"3. Modo de Recupera\u00e7\u00e3o","text":"<pre><code># Se algo der errado, use dry-run primeiro\npython3 scripts/smart_git_sync.py --dry-run --verbose\n\n# Desabilite auditoria temporariamente\npython3 scripts/smart_git_sync.py --no-audit\n</code></pre>"},{"location":"SMART_GIT_SYNC_GUIDE/#boas-praticas","title":"Boas Pr\u00e1ticas","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#1-uso-em-producao","title":"1. Uso em Produ\u00e7\u00e3o","text":"<ul> <li>Sempre teste com <code>--dry-run</code> primeiro</li> <li>Configure timeouts apropriados</li> <li>Use auditoria estrita em produ\u00e7\u00e3o</li> <li>Monitore logs regularmente</li> <li>Mantenha backups de configura\u00e7\u00e3o</li> </ul>"},{"location":"SMART_GIT_SYNC_GUIDE/#2-desenvolvimento","title":"2. Desenvolvimento","text":"<ul> <li>Use modo verbose durante desenvolvimento</li> <li>Execute testes antes de commits</li> <li>Revise relat\u00f3rios de auditoria</li> <li>Configure exclus\u00f5es apropriadas</li> <li>Documente configura\u00e7\u00f5es customizadas</li> </ul>"},{"location":"SMART_GIT_SYNC_GUIDE/#3-cicd-integration","title":"3. CI/CD Integration","text":"<ul> <li>Execute sempre em modo dry-run no CI</li> <li>Use configura\u00e7\u00f5es espec\u00edficas por ambiente</li> <li>Monitore m\u00e9tricas de performance</li> <li>Configure alertas para falhas</li> <li>Mantenha logs centralizados</li> </ul>"},{"location":"SMART_GIT_SYNC_GUIDE/#roadmap","title":"Roadmap","text":""},{"location":"SMART_GIT_SYNC_GUIDE/#funcionalidades-futuras","title":"Funcionalidades Futuras","text":"<ul> <li>[ ] Integra\u00e7\u00e3o com ferramentas de qualidade (SonarQube, CodeClimate)</li> <li>[ ] Suporte a m\u00faltiplos reposit\u00f3rios</li> <li>[ ] Dashboard web para m\u00e9tricas</li> <li>[ ] Integra\u00e7\u00e3o com sistemas de tickets</li> <li>[ ] Suporte a Git LFS</li> <li>[ ] Notifica\u00e7\u00f5es via Slack/Teams</li> <li>[ ] An\u00e1lise de performance de c\u00f3digo</li> <li>[ ] Integra\u00e7\u00e3o com ferramentas de seguran\u00e7a (Snyk, etc.)</li> </ul>"},{"location":"SMART_GIT_SYNC_GUIDE/#conclusao","title":"Conclus\u00e3o","text":"<p>O Smart Git Sync fornece uma solu\u00e7\u00e3o robusta e segura para automa\u00e7\u00e3o de Git que pode ser usada em qualquer projeto Python. Seguindo padr\u00f5es DevOps, ele garante opera\u00e7\u00f5es idempotentes, seguras e audit\u00e1veis.</p> <p>Para suporte ou contribui\u00e7\u00f5es, consulte a documenta\u00e7\u00e3o do projeto ou abra uma issue no reposit\u00f3rio.</p>"},{"location":"SPRINT1_AUDITORIA_FASE01/","title":"\ud83d\udccb Sprint 1 - Relat\u00f3rio de Auditoria (Fase 01)","text":"<p>Data: 29 de Novembro de 2025 Status: \ud83d\udd0d An\u00e1lise Completa - SEM ALTERA\u00c7\u00d5ES DE C\u00d3DIGO Escopo: Logging, Detec\u00e7\u00e3o de Ambiente e Hardcoding</p>"},{"location":"SPRINT1_AUDITORIA_FASE01/#objetivos-da-auditoria","title":"\ud83c\udfaf Objetivos da Auditoria","text":"<ol> <li>An\u00e1lise de Logging: Verificar separa\u00e7\u00e3o adequada de streams (INFO \u2192 stdout, ERROR/WARNING \u2192 stderr)</li> <li>An\u00e1lise de Drift: Avaliar l\u00f3gica de compara\u00e7\u00e3o de vers\u00f5es do Doctor vs CI</li> <li>Verifica\u00e7\u00e3o de Hardcoding: Identificar c\u00f3digos ANSI hardcoded e depend\u00eancias de terminal</li> </ol>"},{"location":"SPRINT1_AUDITORIA_FASE01/#1-analise-de-logging-separacao-de-streams","title":"\ud83d\udcca 1. AN\u00c1LISE DE LOGGING (Separa\u00e7\u00e3o de Streams)","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#11-estado-atual-da-configuracao","title":"1.1. Estado Atual da Configura\u00e7\u00e3o","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#problema-critico-todos-os-logs-vao-para-stdout","title":"\u274c PROBLEMA CR\u00cdTICO: Todos os logs v\u00e3o para <code>stdout</code>","text":"<p>Foram identificados 9 arquivos que utilizam <code>logging.basicConfig</code> com configura\u00e7\u00e3o inadequada:</p> <pre><code># \u274c PADR\u00c3O ATUAL (INCORRETO)\nlogging.basicConfig(\n    level=logging.INFO,\n    format=\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\",\n    handlers=[\n        logging.StreamHandler(sys.stdout),  # \u26a0\ufe0f TODOS os n\u00edveis v\u00e3o para stdout\n        logging.FileHandler(\"audit.log\", mode=\"a\"),\n    ],\n)\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#12-arquivos-afetados","title":"1.2. Arquivos Afetados","text":"Arquivo Linha Stream Atual Problema <code>scripts/smart_git_sync.py</code> 25-31 <code>sys.stdout</code> INFO, WARNING, ERROR \u2192 stdout <code>scripts/code_audit.py</code> 31-37 <code>sys.stdout</code> INFO, WARNING, ERROR \u2192 stdout <code>scripts/audit_dashboard/cli.py</code> 33-38 <code>sys.stdout</code> INFO, WARNING, ERROR \u2192 stdout <code>scripts/ci_recovery/main.py</code> 44-50 <code>sys.stdout</code> INFO, WARNING, ERROR \u2192 stdout <code>scripts/install_dev.py</code> 47-50 Sem handler Apenas n\u00edvel e formato <code>scripts/validate_test_mocks.py</code> 26-29 Sem handler Apenas n\u00edvel e formato <code>scripts/ci_test_mock_integration.py</code> 42 (n\u00e3o lido) Prov\u00e1vel stdout <code>scripts/integrated_audit_example.py</code> 168 (n\u00e3o lido) Prov\u00e1vel stdout <code>tests/test_mock_generator.py</code> 42 (n\u00e3o lido) Contexto de teste"},{"location":"SPRINT1_AUDITORIA_FASE01/#13-impacto-do-problema","title":"1.3. Impacto do Problema","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#consequencias","title":"\ud83d\udea8 Consequ\u00eancias","text":"<ol> <li>Logs de erro poluem o fluxo de sa\u00edda padr\u00e3o: Dificulta parsing de output estruturado</li> <li>Viola\u00e7\u00e3o de conven\u00e7\u00f5es POSIX: stderr \u00e9 o canal correto para diagn\u00f3sticos</li> <li>Problemas em pipelines CI/CD: Ferramentas que monitoram stderr n\u00e3o capturam erros</li> <li>Experi\u00eancia de usu\u00e1rio degradada: Mensagens de erro misturadas com output normal</li> </ol>"},{"location":"SPRINT1_AUDITORIA_FASE01/#exemplo-de-output-problematico","title":"\ud83d\udcdd Exemplo de Output Problem\u00e1tico","text":"<pre><code># Executando: python scripts/code_audit.py\n2025-11-29 21:32:30 - __main__ - INFO - Starting audit...        # \u2705 stdout correto\n2025-11-29 21:32:31 - __main__ - ERROR - File not found: test.py # \u274c deveria ser stderr\nAudit completed successfully                                      # \u2705 stdout correto\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#14-analise-de-loggererror-e-loggerwarning","title":"1.4. An\u00e1lise de <code>logger.error()</code> e <code>logger.warning()</code>","text":"<p>Foram identificadas 20+ ocorr\u00eancias de <code>logger.error()</code> e <code>logger.warning()</code> nos scripts:</p> <pre><code># scripts/install_dev.py (linha 184)\nlogger.error(\"pip-compile fallback failed: %s\", e)  # \u274c vai para stdout\n\n# scripts/validate_test_mocks.py (linha 55)\nlogger.error(f\"Config do gerador n\u00e3o encontrado: {config_file}\")  # \u274c vai para stdout\n\n# scripts/audit_dashboard/cli.py (linha 150)\nlogger.error(\"Dashboard error: %s\", e)  # \u274c vai para stdout\n</code></pre> <p>Todos esses erros v\u00e3o para <code>stdout</code> devido \u00e0 configura\u00e7\u00e3o do <code>StreamHandler</code>.</p>"},{"location":"SPRINT1_AUDITORIA_FASE01/#2-analise-de-drift-doctor-vs-ci","title":"\ud83d\udd0d 2. AN\u00c1LISE DE DRIFT (Doctor vs CI)","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#21-logica-atual-do-doctor-scriptsdoctorpy","title":"2.1. L\u00f3gica Atual do Doctor (<code>scripts/doctor.py</code>)","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#funcao-check_python_version-linhas-55-108","title":"\ud83d\udccd Fun\u00e7\u00e3o: <code>check_python_version()</code> (linhas 55-108)","text":"<pre><code>def check_python_version(self) -&gt; DiagnosticResult:\n    \"\"\"Verifica compatibilidade da vers\u00e3o Python e detecta Drift.\"\"\"\n    python_version_file = self.project_root / \".python-version\"\n\n    # L\u00ea vers\u00e3o esperada\n    expected_version = content.split()[0].strip()  # Ex: \"3.12.12\"\n\n    # Vers\u00e3o atual\n    current_major = sys.version_info.major\n    current_minor = sys.version_info.minor\n    current_micro = sys.version_info.micro\n    current_full = f\"{current_major}.{current_minor}.{current_micro}\"\n\n    # \u274c PROBLEMA: Compara\u00e7\u00e3o exata (linha 71)\n    exact_match = current_full == expected_version\n\n    if exact_match:\n        return DiagnosticResult(\n            \"Python Version\",\n            True,\n            f\"Python {current_full} (Sincronizado)\",\n        )\n\n    # \u2705 CI tem tratamento especial (linhas 76-81)\n    if os.environ.get(\"CI\"):\n        return DiagnosticResult(\n            \"Python Version\",\n            True,\n            f\"Python {current_full} (CI Environment - Drift ignorado)\",\n        )\n\n    # \u274c Desenvolvimento local: falha em qualquer diferen\u00e7a\n    return DiagnosticResult(\n        \"Python Version\",\n        False,\n        f\"\u26a0\ufe0f  ENVIRONMENT DRIFT DETECTADO!\\n\"\n        f\"  Vers\u00e3o ativa:   {current_full}\\n\"\n        f\"  Vers\u00e3o esperada: {expected_version}\\n\"\n        # ... mensagem de erro\n    )\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#22-configuracao-do-ci-githubworkflowsciyml","title":"2.2. Configura\u00e7\u00e3o do CI (<code>.github/workflows/ci.yml</code>)","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#matriz-de-versoes-linhas-45-49","title":"\ud83d\udccd Matriz de Vers\u00f5es (linhas 45-49)","text":"<pre><code>strategy:\n  fail-fast: false\n  matrix:\n    python-version: [\"3.10\", \"3.11\", \"3.12\"]  # \u26a0\ufe0f Apenas MAJOR.MINOR\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#setup-python-linha-54","title":"\ud83d\udccd Setup Python (linha 54)","text":"<pre><code>- name: \"Configurar Python ${{ matrix.python-version }}\"\n  uses: actions/setup-python@83679a892e2d95755f2dac6acb0bfd1e9ac5d548 # v6.1.0\n  with:\n    python-version: ${{ matrix.python-version }}  # Ex: \"3.11\"\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#23-arquivo-python-version","title":"2.3. Arquivo <code>.python-version</code>","text":"<pre><code>3.12.12\n3.11.14\n3.10.19\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#24-analise-do-problema-de-drift","title":"2.4. An\u00e1lise do Problema de Drift","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#cenario-problematico","title":"\ud83d\udea8 CEN\u00c1RIO PROBLEM\u00c1TICO","text":"Contexto <code>.python-version</code> CI Matrix Instalado Doctor Resultado CI <code>3.11.14</code> <code>3.11</code> <code>3.11.9</code> \u2705 PASSA (linha 77) Local <code>3.11.14</code> N/A <code>3.11.9</code> \u274c FALHA (linha 84) Local <code>3.11.14</code> N/A <code>3.11.14</code> \u2705 PASSA"},{"location":"SPRINT1_AUDITORIA_FASE01/#perguntas-respondidas","title":"\u2753 PERGUNTAS RESPONDIDAS","text":"<ol> <li>\"Se o <code>.python-version</code> diz 3.11.0 e o CI roda 3.11.9, o Doctor falha?\"</li> <li>No CI: \u274c N\u00c3O FALHA - Linha 77 ignora drift em ambiente CI</li> <li> <p>Local: \u2705 FALHA - Linha 84 exige vers\u00e3o exata</p> </li> <li> <p>\"Ele deveria aceitar mudan\u00e7as no patch level?\"</p> </li> <li>Sim, mas apenas no CI atualmente</li> <li>Localmente, \u00e9 exigente demais (exige match exato de MAJOR.MINOR.MICRO)</li> </ol>"},{"location":"SPRINT1_AUDITORIA_FASE01/#25-inconsistencia-arquitetural","title":"2.5. Inconsist\u00eancia Arquitetural","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#desalinhamento","title":"\u26a0\ufe0f DESALINHAMENTO","text":"<pre><code>CI Matrix:     3.10, 3.11, 3.12           (MAJOR.MINOR)\n                   \u2195\ufe0f (mismatch)\n.python-version: 3.10.19, 3.11.14, 3.12.12  (MAJOR.MINOR.MICRO)\n                   \u2195\ufe0f (strict check)\nDoctor Local:  Exige match exato de todos os 3 n\u00fameros\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#problema-filosofico","title":"\ud83d\udca1 PROBLEMA FILOS\u00d3FICO","text":"<ul> <li>CI \u00e9 flex\u00edvel: Aceita qualquer patch version (ex: 3.11.9 quando .python-version diz 3.11.14)</li> <li>Doctor Local \u00e9 r\u00edgido: Falha se patch version n\u00e3o bate exatamente</li> <li>Resultado: Desenvolvedores podem ter ambiente \"saud\u00e1vel\" no CI mas \"doente\" localmente</li> </ul>"},{"location":"SPRINT1_AUDITORIA_FASE01/#3-verificacao-de-hardcoding-codigos-ansi","title":"\ud83c\udfa8 3. VERIFICA\u00c7\u00c3O DE HARDCODING (C\u00f3digos ANSI)","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#31-arquivos-com-codigos-ansi-hardcoded","title":"3.1. Arquivos com C\u00f3digos ANSI Hardcoded","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#scriptsdoctorpy-linhas-21-26","title":"\u274c <code>scripts/doctor.py</code> (linhas 21-26)","text":"<pre><code># C\u00f3digos de Cores ANSI (para n\u00e3o depender de libs externas)\nRED = \"\\033[91m\"\nGREEN = \"\\033[92m\"\nYELLOW = \"\\033[93m\"\nBLUE = \"\\033[94m\"\nBOLD = \"\\033[1m\"\nRESET = \"\\033[0m\"\n</code></pre> <p>Uso: Formata\u00e7\u00e3o de mensagens de diagn\u00f3stico (linhas 256-285)</p> <pre><code>def run_diagnostics(self) -&gt; bool:\n    print(f\"{BOLD}{BLUE}\ud83d\udd0d Dev Doctor - Diagn\u00f3stico de Ambiente{RESET}\\n\")\n\n    for result in self.results:\n        if result.passed:\n            print(f\"{GREEN}\u2713 {result.name}{RESET}\")  # \u274c Hardcoded\n        else:\n            if result.critical:\n                print(f\"{RED}\u2717 {result.name} (CR\u00cdTICO){RESET}\")  # \u274c Hardcoded\n            else:\n                print(f\"{YELLOW}! {result.name} (aviso){RESET}\")  # \u274c Hardcoded\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#scriptsmaintain_versionspy-linhas-34-42","title":"\u274c <code>scripts/maintain_versions.py</code> (linhas 34-42)","text":"<pre><code>class Colors:\n    \"\"\"Constantes de cores ANSI para formata\u00e7\u00e3o de terminal.\"\"\"\n\n    HEADER = \"\\033[95m\"\n    OKBLUE = \"\\033[94m\"\n    OKCYAN = \"\\033[96m\"\n    OKGREEN = \"\\033[92m\"\n    WARNING = \"\\033[93m\"\n    FAIL = \"\\033[91m\"\n    ENDC = \"\\033[0m\"\n    BOLD = \"\\033[1m\"\n    UNDERLINE = \"\\033[4m\"\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#32-analise-de-contexto","title":"3.2. An\u00e1lise de Contexto","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#observacoes","title":"\ud83d\udccb Observa\u00e7\u00f5es","text":"<ol> <li>Justificativa Documentada:</li> <li><code>doctor.py</code> linha 21: <code>\"# C\u00f3digos de Cores ANSI (para n\u00e3o depender de libs externas)\"</code></li> <li> <p>Estrat\u00e9gia intencional para rodar em ambientes quebrados (sem depend\u00eancias)</p> </li> <li> <p>Scripts Afetados: Apenas 2 arquivos (<code>doctor.py</code> e <code>maintain_versions.py</code>)</p> </li> <li> <p>N\u00e3o H\u00e1 Verifica\u00e7\u00e3o de Terminal Interativo:</p> </li> </ol> <pre><code># \u274c N\u00c3O EXISTE:\nif sys.stdout.isatty():\n    # usar cores\nelse:\n    # sem cores\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#33-problemas-identificados","title":"3.3. Problemas Identificados","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#consequencias_1","title":"\ud83d\udea8 CONSEQU\u00caNCIAS","text":"<ol> <li>Logs sujos em ambientes n\u00e3o-interativos:</li> </ol> <pre><code># Output em CI/CD logs ou redirecionamento\n[91m\u2717 Python Version (CR\u00cdTICO)[0m  # \u274c Polui\u00e7\u00e3o visual\n</code></pre> <ol> <li>Incompatibilidade com parsers:</li> <li> <p>Ferramentas que processam output estruturado quebram com c\u00f3digos ANSI</p> </li> <li> <p>Acessibilidade:</p> </li> <li> <p>Screen readers e ferramentas de acessibilidade t\u00eam dificuldade com c\u00f3digos ANSI</p> </li> <li> <p>Duplica\u00e7\u00e3o de C\u00f3digo:</p> </li> <li><code>doctor.py</code> e <code>maintain_versions.py</code> redefinem as mesmas cores</li> </ol>"},{"location":"SPRINT1_AUDITORIA_FASE01/#4-proposta-de-arquitetura","title":"\ud83d\udca1 4. PROPOSTA DE ARQUITETURA","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#41-nova-estrutura-scriptsutilsloggerpy","title":"4.1. Nova Estrutura: <code>scripts/utils/logger.py</code>","text":"<pre><code>#!/usr/bin/env python3\n\"\"\"Sistema de Logging Padronizado para Scripts.\n\nFornece configura\u00e7\u00e3o centralizada de logging com:\n- Separa\u00e7\u00e3o correta de streams (INFO \u2192 stdout, ERROR/WARNING \u2192 stderr)\n- Suporte a cores ANSI com detec\u00e7\u00e3o de terminal\n- Configura\u00e7\u00e3o reutiliz\u00e1vel para todos os scripts\n\"\"\"\n\nimport logging\nimport sys\nfrom typing import Literal\n\n# ============================================================\n# 1. HANDLERS CUSTOMIZADOS COM SEPARA\u00c7\u00c3O DE STREAMS\n# ============================================================\n\nclass StdoutFilter(logging.Filter):\n    \"\"\"Filtra apenas mensagens INFO e DEBUG para stdout.\"\"\"\n\n    def filter(self, record: logging.LogRecord) -&gt; bool:\n        return record.levelno &lt;= logging.INFO\n\n\nclass InfoHandler(logging.StreamHandler):\n    \"\"\"Handler que envia INFO/DEBUG para stdout.\"\"\"\n\n    def __init__(self):\n        super().__init__(sys.stdout)\n        self.addFilter(StdoutFilter())\n\n\nclass ErrorHandler(logging.StreamHandler):\n    \"\"\"Handler que envia WARNING/ERROR/CRITICAL para stderr.\"\"\"\n\n    def __init__(self):\n        super().__init__(sys.stderr)\n        self.setLevel(logging.WARNING)\n\n\n# ============================================================\n# 2. SISTEMA DE CORES COM DETEC\u00c7\u00c3O DE TERMINAL\n# ============================================================\n\nclass TerminalColors:\n    \"\"\"C\u00f3digos ANSI para formata\u00e7\u00e3o de terminal com detec\u00e7\u00e3o autom\u00e1tica.\n\n    Desabilita cores automaticamente se:\n    - Terminal n\u00e3o \u00e9 interativo (sys.stdout.isatty() == False)\n    - Vari\u00e1vel NO_COLOR est\u00e1 definida\n    - Ambiente CI sem suporte a cores\n    \"\"\"\n\n    def __init__(self, force_colors: bool = False):\n        \"\"\"Inicializa com detec\u00e7\u00e3o autom\u00e1tica de suporte a cores.\n\n        Args:\n            force_colors: For\u00e7a ativa\u00e7\u00e3o de cores (\u00fatil para testes)\n        \"\"\"\n        self._enabled = self._should_use_colors(force_colors)\n\n    def _should_use_colors(self, force: bool) -&gt; bool:\n        \"\"\"Determina se cores devem ser usadas.\"\"\"\n        import os\n\n        if force:\n            return True\n\n        # Respeita NO_COLOR (https://no-color.org/)\n        if os.environ.get(\"NO_COLOR\"):\n            return False\n\n        # Verifica se stdout \u00e9 um terminal interativo\n        if not sys.stdout.isatty():\n            return False\n\n        # GitHub Actions suporta cores com TERM\n        if os.environ.get(\"CI\") and not os.environ.get(\"TERM\"):\n            return False\n\n        return True\n\n    @property\n    def RED(self) -&gt; str:\n        return \"\\033[91m\" if self._enabled else \"\"\n\n    @property\n    def GREEN(self) -&gt; str:\n        return \"\\033[92m\" if self._enabled else \"\"\n\n    @property\n    def YELLOW(self) -&gt; str:\n        return \"\\033[93m\" if self._enabled else \"\"\n\n    @property\n    def BLUE(self) -&gt; str:\n        return \"\\033[94m\" if self._enabled else \"\"\n\n    @property\n    def BOLD(self) -&gt; str:\n        return \"\\033[1m\" if self._enabled else \"\"\n\n    @property\n    def RESET(self) -&gt; str:\n        return \"\\033[0m\" if self._enabled else \"\"\n\n\n# Inst\u00e2ncia global (lazy initialization)\n_colors: TerminalColors | None = None\n\n\ndef get_colors(force: bool = False) -&gt; TerminalColors:\n    \"\"\"Obt\u00e9m inst\u00e2ncia de cores (singleton pattern).\n\n    Args:\n        force: For\u00e7a ativa\u00e7\u00e3o de cores\n\n    Returns:\n        Inst\u00e2ncia de TerminalColors\n    \"\"\"\n    global _colors\n    if _colors is None:\n        _colors = TerminalColors(force=force)\n    return _colors\n\n\n# ============================================================\n# 3. FUN\u00c7\u00c3O DE CONFIGURA\u00c7\u00c3O PADRONIZADA\n# ============================================================\n\ndef setup_logging(\n    name: str = \"__main__\",\n    level: int = logging.INFO,\n    log_file: str | None = None,\n    format_string: str | None = None,\n) -&gt; logging.Logger:\n    \"\"\"Configura logging com separa\u00e7\u00e3o correta de streams.\n\n    Args:\n        name: Nome do logger (geralmente __name__)\n        level: N\u00edvel de logging (DEBUG, INFO, WARNING, ERROR, CRITICAL)\n        log_file: Caminho opcional para arquivo de log\n        format_string: String de formata\u00e7\u00e3o customizada\n\n    Returns:\n        Logger configurado\n\n    Exemplo:\n        &gt;&gt;&gt; logger = setup_logging(__name__)\n        &gt;&gt;&gt; logger.info(\"Isso vai para stdout\")\n        &gt;&gt;&gt; logger.error(\"Isso vai para stderr\")\n    \"\"\"\n    logger = logging.getLogger(name)\n    logger.setLevel(level)\n\n    # Remove handlers existentes para evitar duplica\u00e7\u00e3o\n    logger.handlers.clear()\n\n    # Formato padr\u00e3o\n    if format_string is None:\n        format_string = \"%(asctime)s - %(name)s - %(levelname)s - %(message)s\"\n\n    formatter = logging.Formatter(format_string)\n\n    # Handler para INFO/DEBUG \u2192 stdout\n    stdout_handler = InfoHandler()\n    stdout_handler.setFormatter(formatter)\n    logger.addHandler(stdout_handler)\n\n    # Handler para WARNING/ERROR/CRITICAL \u2192 stderr\n    stderr_handler = ErrorHandler()\n    stderr_handler.setFormatter(formatter)\n    logger.addHandler(stderr_handler)\n\n    # Handler opcional para arquivo (todos os n\u00edveis)\n    if log_file:\n        file_handler = logging.FileHandler(log_file, mode=\"a\")\n        file_handler.setFormatter(formatter)\n        logger.addHandler(file_handler)\n\n    return logger\n\n\n# ============================================================\n# 4. ALIASES PARA RETROCOMPATIBILIDADE\n# ============================================================\n\n# Para scripts que usam constantes globais\nRED = property(lambda self: get_colors().RED)\nGREEN = property(lambda self: get_colors().GREEN)\nYELLOW = property(lambda self: get_colors().YELLOW)\nBLUE = property(lambda self: get_colors().BLUE)\nBOLD = property(lambda self: get_colors().BOLD)\nRESET = property(lambda self: get_colors().RESET)\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#42-uso-proposto-nos-scripts","title":"4.2. Uso Proposto nos Scripts","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#antes-doctorpy","title":"\u2705 ANTES (doctor.py)","text":"<pre><code>import logging\nimport sys\n\n# C\u00f3digos de Cores ANSI (para n\u00e3o depender de libs externas)\nRED = \"\\033[91m\"\nGREEN = \"\\033[92m\"\n# ...\n\nlogging.basicConfig(...)  # Sem handlers espec\u00edficos\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#depois-doctorpy","title":"\u2705 DEPOIS (doctor.py)","text":"<pre><code>from scripts.utils.logger import setup_logging, get_colors\n\n# Setup logging com separa\u00e7\u00e3o de streams\nlogger = setup_logging(__name__)\n\n# Cores com detec\u00e7\u00e3o autom\u00e1tica\ncolors = get_colors()\nRED = colors.RED\nGREEN = colors.GREEN\n# ...\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#43-beneficios-da-proposta","title":"4.3. Benef\u00edcios da Proposta","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#vantagens","title":"\u2705 VANTAGENS","text":"<ol> <li>Separa\u00e7\u00e3o Correta de Streams:</li> <li>INFO/DEBUG \u2192 <code>sys.stdout</code> (dados, progresso)</li> <li> <p>WARNING/ERROR/CRITICAL \u2192 <code>sys.stderr</code> (diagn\u00f3sticos)</p> </li> <li> <p>Detec\u00e7\u00e3o Autom\u00e1tica de Terminal:</p> </li> <li>Desabilita cores em ambientes n\u00e3o-interativos</li> <li>Respeita padr\u00e3o <code>NO_COLOR</code></li> <li> <p>Compat\u00edvel com CI/CD</p> </li> <li> <p>Centraliza\u00e7\u00e3o:</p> </li> <li>DRY: Uma \u00fanica fonte de verdade</li> <li>F\u00e1cil manuten\u00e7\u00e3o e evolu\u00e7\u00e3o</li> <li> <p>Testes centralizados</p> </li> <li> <p>Retrocompatibilidade:</p> </li> <li>Migra\u00e7\u00e3o gradual poss\u00edvel</li> <li> <p>API similar \u00e0 existente</p> </li> <li> <p>Observabilidade:</p> </li> <li>Logs estruturados</li> <li>F\u00e1cil parsing por ferramentas</li> </ol>"},{"location":"SPRINT1_AUDITORIA_FASE01/#5-recomendacoes-e-proximos-passos","title":"\ud83d\udcdd 5. RECOMENDA\u00c7\u00d5ES E PR\u00d3XIMOS PASSOS","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#51-prioridade-alta","title":"5.1. Prioridade ALTA \ud83d\udd34","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#1-criar-scriptsutilsloggerpy","title":"1. Criar <code>scripts/utils/logger.py</code>","text":"<ul> <li>Implementar handlers com separa\u00e7\u00e3o de streams</li> <li>Adicionar sistema de cores com detec\u00e7\u00e3o de terminal</li> <li>Escrever testes unit\u00e1rios</li> </ul>"},{"location":"SPRINT1_AUDITORIA_FASE01/#2-refatorar-logica-de-drift-no-doctor","title":"2. Refatorar L\u00f3gica de Drift no Doctor","text":"<ul> <li>Implementar compara\u00e7\u00e3o flex\u00edvel de vers\u00f5es</li> <li>Permitir diferen\u00e7as em patch level localmente (opcional via flag)</li> <li>Documentar estrat\u00e9gia de versionamento</li> </ul> <pre><code># Proposta de l\u00f3gica:\ndef compare_versions(current: str, expected: str, strict: bool = False) -&gt; bool:\n    \"\"\"Compara vers\u00f5es com flexibilidade configur\u00e1vel.\n\n    Args:\n        current: Vers\u00e3o atual (ex: \"3.11.9\")\n        expected: Vers\u00e3o esperada (ex: \"3.11.14\")\n        strict: Se True, exige match exato. Se False, aceita patch differences.\n\n    Returns:\n        True se vers\u00f5es s\u00e3o compat\u00edveis\n    \"\"\"\n    curr_major, curr_minor, curr_patch = map(int, current.split(\".\"))\n    exp_major, exp_minor, exp_patch = map(int, expected.split(\".\"))\n\n    # Major.Minor sempre devem bater\n    if (curr_major, curr_minor) != (exp_major, exp_minor):\n        return False\n\n    # Patch: flex\u00edvel se strict=False\n    if strict:\n        return curr_patch == exp_patch\n    else:\n        # Aceita patch igual ou superior (dentro do minor)\n        return curr_patch &gt;= exp_patch\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_FASE01/#52-prioridade-media","title":"5.2. Prioridade M\u00c9DIA \ud83d\udfe1","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#3-migrar-scripts-para-novo-sistema-de-logging","title":"3. Migrar Scripts para Novo Sistema de Logging","text":"<ul> <li>Ordem sugerida:<ol> <li><code>scripts/code_audit.py</code> (cr\u00edtico para CI)</li> <li><code>scripts/smart_git_sync.py</code> (cr\u00edtico para CI)</li> <li><code>scripts/doctor.py</code> (usa cores)</li> <li><code>scripts/maintain_versions.py</code> (usa cores)</li> <li>Demais scripts</li> </ol> </li> </ul>"},{"location":"SPRINT1_AUDITORIA_FASE01/#4-adicionar-testes-de-integracao","title":"4. Adicionar Testes de Integra\u00e7\u00e3o","text":"<ul> <li>Validar separa\u00e7\u00e3o de streams em diferentes ambientes</li> <li>Testar detec\u00e7\u00e3o de terminal (isatty, NO_COLOR)</li> <li>Verificar comportamento em CI</li> </ul>"},{"location":"SPRINT1_AUDITORIA_FASE01/#53-prioridade-baixa","title":"5.3. Prioridade BAIXA \ud83d\udfe2","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#5-documentacao","title":"5. Documenta\u00e7\u00e3o","text":"<ul> <li>Atualizar guias de desenvolvimento</li> <li>Adicionar exemplos de uso do novo logger</li> <li>Documentar padr\u00f5es de versionamento</li> </ul>"},{"location":"SPRINT1_AUDITORIA_FASE01/#6-revisao-de-ci","title":"6. Revis\u00e3o de CI","text":"<ul> <li>Considerar tornar matriz mais expl\u00edcita no CI</li> <li>Avaliar se <code>.python-version</code> deveria ter apenas MAJOR.MINOR</li> </ul>"},{"location":"SPRINT1_AUDITORIA_FASE01/#6-resumo-executivo","title":"\ud83d\udcca 6. RESUMO EXECUTIVO","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#61-achados-principais","title":"6.1. Achados Principais","text":"Categoria Achados Severidade Arquivos Afetados Logging Todos os logs v\u00e3o para stdout \ud83d\udd34 ALTA 9 arquivos Drift L\u00f3gica inconsistente CI vs Local \ud83d\udd34 ALTA <code>doctor.py</code>, <code>ci.yml</code> Hardcoding C\u00f3digos ANSI sem detec\u00e7\u00e3o de terminal \ud83d\udfe1 M\u00c9DIA 2 arquivos"},{"location":"SPRINT1_AUDITORIA_FASE01/#62-impacto-estimado-da-refatoracao","title":"6.2. Impacto Estimado da Refatora\u00e7\u00e3o","text":"M\u00e9trica Antes Depois Melhoria Separa\u00e7\u00e3o de Streams 0% (tudo em stdout) 100% (stderr para erros) \u2705 +100% Compatibilidade CI/CD Parcial Total \u2705 +100% Duplica\u00e7\u00e3o de C\u00f3digo 2 defini\u00e7\u00f5es de cores 1 centralizada \u2705 -50% Detec\u00e7\u00e3o de Terminal N\u00e3o existe Autom\u00e1tica \u2705 Nova feature"},{"location":"SPRINT1_AUDITORIA_FASE01/#63-estimativa-de-esforco","title":"6.3. Estimativa de Esfor\u00e7o","text":"Tarefa Complexidade Tempo Estimado Risk Criar <code>logger.py</code> \ud83d\udfe2 Baixa 4h Baixo Refatorar l\u00f3gica de Drift \ud83d\udfe1 M\u00e9dia 6h M\u00e9dio Migrar 9 scripts \ud83d\udfe1 M\u00e9dia 8h Baixo Testes + Docs \ud83d\udfe1 M\u00e9dia 6h Baixo TOTAL - 24h (~3 dias) -"},{"location":"SPRINT1_AUDITORIA_FASE01/#7-checklist-de-acoes","title":"\u2705 7. CHECKLIST DE A\u00c7\u00d5ES","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#sprint-1-fase-02-implementacao","title":"Sprint 1 - Fase 02 (Implementa\u00e7\u00e3o)","text":"<ul> <li>[ ] Criar <code>scripts/utils/logger.py</code> com handlers customizados</li> <li>[ ] Adicionar testes unit\u00e1rios para <code>logger.py</code></li> <li>[ ] Refatorar <code>check_python_version()</code> no <code>doctor.py</code></li> <li>[ ] Migrar <code>scripts/code_audit.py</code> para novo logger</li> <li>[ ] Migrar <code>scripts/smart_git_sync.py</code> para novo logger</li> <li>[ ] Migrar <code>scripts/doctor.py</code> para novo logger e cores din\u00e2micas</li> <li>[ ] Migrar <code>scripts/maintain_versions.py</code> para novo logger e cores din\u00e2micas</li> <li>[ ] Atualizar documenta\u00e7\u00e3o de desenvolvimento</li> <li>[ ] Executar testes de integra\u00e7\u00e3o em CI</li> <li>[ ] Code review e merge</li> </ul>"},{"location":"SPRINT1_AUDITORIA_FASE01/#8-anexos","title":"\ud83d\udcce 8. ANEXOS","text":""},{"location":"SPRINT1_AUDITORIA_FASE01/#81-referencias","title":"8.1. Refer\u00eancias","text":"<ul> <li>POSIX Standard for stdout/stderr</li> <li>Python Logging Cookbook</li> <li>NO_COLOR Standard</li> <li>GitHub Actions: Escape Sequences</li> </ul>"},{"location":"SPRINT1_AUDITORIA_FASE01/#82-trechos-de-codigo-completos","title":"8.2. Trechos de C\u00f3digo Completos","text":"\ud83d\udcc4 scripts/smart_git_sync.py (linhas 25-31) <pre><code>logging.basicConfig(\n    level=logging.INFO,\n    format=\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\",\n    handlers=[\n        logging.StreamHandler(sys.stdout),  # \u274c PROBLEMA\n        logging.FileHandler(\"smart_git_sync.log\", mode=\"a\"),\n    ],\n)\n</code></pre> \ud83d\udcc4 scripts/code_audit.py (linhas 31-37) <pre><code>logging.basicConfig(\n    level=logging.INFO,\n    format=\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\",\n    handlers=[\n        logging.StreamHandler(sys.stdout),  # \u274c PROBLEMA\n        logging.FileHandler(\"audit.log\", mode=\"a\"),\n    ],\n)\n</code></pre> \ud83d\udcc4 scripts/doctor.py (linhas 55-108) - check_python_version <pre><code>def check_python_version(self) -&gt; DiagnosticResult:\n    \"\"\"Verifica compatibilidade da vers\u00e3o Python e detecta Drift.\"\"\"\n    python_version_file = self.project_root / \".python-version\"\n\n    if not python_version_file.exists():\n        return DiagnosticResult(\n            \"Python Version\",\n            False,\n            \"Arquivo .python-version n\u00e3o encontrado\",\n            critical=False,\n        )\n\n    try:\n        content = python_version_file.read_text().strip()\n        expected_version = content.split()[0].strip()\n\n        current_major = sys.version_info.major\n        current_minor = sys.version_info.minor\n        current_micro = sys.version_info.micro\n        current_full = f\"{current_major}.{current_minor}.{current_micro}\"\n\n        # \u274c PROBLEMA: Compara\u00e7\u00e3o exata\n        exact_match = current_full == expected_version\n\n        if exact_match:\n            return DiagnosticResult(\n                \"Python Version\",\n                True,\n                f\"Python {current_full} (Sincronizado)\",\n            )\n\n        # \u2705 CI tem tratamento especial\n        if os.environ.get(\"CI\"):\n            return DiagnosticResult(\n                \"Python Version\",\n                True,\n                f\"Python {current_full} (CI Environment - Drift ignorado)\",\n            )\n\n        # \u274c Desenvolvimento local: falha em qualquer diferen\u00e7a\n        return DiagnosticResult(\n            \"Python Version\",\n            False,\n            f\"\u26a0\ufe0f  ENVIRONMENT DRIFT DETECTADO!\\n\"\n            f\"  Vers\u00e3o ativa:   {current_full}\\n\"\n            f\"  Vers\u00e3o esperada: {expected_version}\\n\"\n            f\"  \ud83d\udc8a Prescri\u00e7\u00e3o: Reinstale o venv com a vers\u00e3o correta:\\n\"\n            f\"      rm -rf .venv &amp;&amp; python{expected_version} -m venv .venv \"\n            f\"&amp;&amp; source .venv/bin/activate &amp;&amp; make install-dev\",\n            critical=True,\n        )\n\n    except Exception as e:\n        return DiagnosticResult(\n            \"Python Version\", False, f\"Erro ao ler vers\u00e3o: {e}\", critical=True\n        )\n</code></pre> <p>\ud83d\udccc FIM DO RELAT\u00d3RIO - FASE 01</p> <p>Este documento n\u00e3o cont\u00e9m altera\u00e7\u00f5es de c\u00f3digo, apenas an\u00e1lise e recomenda\u00e7\u00f5es.</p>"},{"location":"SPRINT1_AUDITORIA_SUMARIO/","title":"\ud83d\udcca Sprint 1 - Sum\u00e1rio Executivo da Auditoria","text":"<p>Data: 29 de Novembro de 2025 Documento Completo: SPRINT1_AUDITORIA_FASE01.md</p>"},{"location":"SPRINT1_AUDITORIA_SUMARIO/#objetivo","title":"\ud83c\udfaf Objetivo","text":"<p>Auditoria de logging, detec\u00e7\u00e3o de ambiente e hardcoding sem altera\u00e7\u00f5es de c\u00f3digo.</p>"},{"location":"SPRINT1_AUDITORIA_SUMARIO/#achados-principais","title":"\ud83d\udd0d Achados Principais","text":""},{"location":"SPRINT1_AUDITORIA_SUMARIO/#1-logging-inadequado-severidade-alta","title":"1. \u274c Logging Inadequado (Severidade: \ud83d\udd34 ALTA)","text":"<p>Problema: Todos os logs (incluindo erros) v\u00e3o para <code>stdout</code> em vez de <code>stderr</code>.</p> <p>Impacto:</p> <ul> <li>Viola\u00e7\u00e3o de conven\u00e7\u00f5es POSIX</li> <li>Dificulta parsing de output em pipelines CI/CD</li> <li>Logs de erro poluem sa\u00edda padr\u00e3o</li> </ul> <p>Arquivos Afetados: 9 scripts</p> <ul> <li><code>scripts/smart_git_sync.py</code></li> <li><code>scripts/code_audit.py</code></li> <li><code>scripts/audit_dashboard/cli.py</code></li> <li><code>scripts/ci_recovery/main.py</code></li> <li>E outros 5 scripts</li> </ul> <p>Exemplo do Problema:</p> <pre><code># \u274c Configura\u00e7\u00e3o atual (INCORRETA)\nlogging.basicConfig(\n    handlers=[\n        logging.StreamHandler(sys.stdout),  # \u26a0\ufe0f Todos os n\u00edveis v\u00e3o aqui\n    ],\n)\n\nlogger.error(\"Erro cr\u00edtico\")  # \u274c Vai para stdout em vez de stderr\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_SUMARIO/#2-logica-de-drift-inconsistente-severidade-alta","title":"2. \u274c L\u00f3gica de Drift Inconsistente (Severidade: \ud83d\udd34 ALTA)","text":"<p>Problema: <code>doctor.py</code> exige vers\u00e3o Python exata localmente, mas \u00e9 flex\u00edvel no CI.</p> <p>Cen\u00e1rio Problem\u00e1tico:</p> <pre><code>.python-version:  3.11.14\nCI instala:       3.11.9   \u2705 PASSA (ignora drift)\nDev local tem:    3.11.9   \u274c FALHA (exige exato)\n</code></pre> <p>C\u00f3digo Problem\u00e1tico (<code>scripts/doctor.py</code>, linha 71):</p> <pre><code>exact_match = current_full == expected_version  # \u274c Compara\u00e7\u00e3o r\u00edgida\n\nif os.environ.get(\"CI\"):\n    return True  # \u2705 CI ignora diferen\u00e7as de patch\nelse:\n    return False  # \u274c Local exige match exato\n</code></pre> <p>Inconsist\u00eancia Arquitetural:</p> <ul> <li>CI Matrix: Define apenas <code>3.10</code>, <code>3.11</code>, <code>3.12</code> (MAJOR.MINOR)</li> <li>.python-version: Define <code>3.10.19</code>, <code>3.11.14</code>, <code>3.12.12</code> (MAJOR.MINOR.MICRO)</li> <li>Doctor: Exige match exato de MAJOR.MINOR.MICRO localmente</li> </ul>"},{"location":"SPRINT1_AUDITORIA_SUMARIO/#3-codigos-ansi-hardcoded-severidade-media","title":"3. \u26a0\ufe0f C\u00f3digos ANSI Hardcoded (Severidade: \ud83d\udfe1 M\u00c9DIA)","text":"<p>Problema: C\u00f3digos de cores n\u00e3o verificam se terminal \u00e9 interativo.</p> <p>Impacto:</p> <ul> <li>Logs sujos em ambientes n\u00e3o-interativos (CI, redirecionamento)</li> <li>Incompatibilidade com parsers de log</li> <li>Duplica\u00e7\u00e3o de c\u00f3digo (2 arquivos definem as mesmas cores)</li> </ul> <p>Arquivos Afetados:</p> <ul> <li><code>scripts/doctor.py</code> (linhas 21-26)</li> <li><code>scripts/maintain_versions.py</code> (linhas 34-42)</li> </ul> <p>C\u00f3digo Problem\u00e1tico:</p> <pre><code># \u274c Sempre usa cores, mesmo em pipes ou CI\nRED = \"\\033[91m\"\nprint(f\"{RED}Erro{RESET}\")  # \u274c Sem verificar se isatty()\n</code></pre> <p>Falta Verifica\u00e7\u00e3o:</p> <pre><code># \u274c N\u00c3O EXISTE no c\u00f3digo atual:\nif sys.stdout.isatty():\n    # usar cores\nelse:\n    # sem cores (para pipes, CI, etc)\n</code></pre>"},{"location":"SPRINT1_AUDITORIA_SUMARIO/#solucao-proposta","title":"\ud83d\udca1 Solu\u00e7\u00e3o Proposta","text":""},{"location":"SPRINT1_AUDITORIA_SUMARIO/#criar-scriptsutilsloggerpy","title":"Criar <code>scripts/utils/logger.py</code>","text":"<p>Funcionalidades:</p> <ol> <li>\u2705 Separa\u00e7\u00e3o de Streams:</li> <li>INFO/DEBUG \u2192 <code>stdout</code></li> <li> <p>WARNING/ERROR/CRITICAL \u2192 <code>stderr</code></p> </li> <li> <p>\u2705 Detec\u00e7\u00e3o Autom\u00e1tica de Terminal:</p> </li> <li>Desabilita cores se n\u00e3o for interativo</li> <li>Respeita vari\u00e1vel <code>NO_COLOR</code></li> <li> <p>Compat\u00edvel com CI/CD</p> </li> <li> <p>\u2705 Centraliza\u00e7\u00e3o:</p> </li> <li>Uma \u00fanica fonte de verdade</li> <li> <p>Reutiliz\u00e1vel por todos os scripts</p> </li> <li> <p>\u2705 Compara\u00e7\u00e3o Flex\u00edvel de Vers\u00f5es:</p> </li> <li>Aceita diferen\u00e7as de patch level (configur\u00e1vel)</li> <li>Consist\u00eancia entre CI e desenvolvimento local</li> </ol>"},{"location":"SPRINT1_AUDITORIA_SUMARIO/#metricas-de-impacto","title":"\ud83d\udcca M\u00e9tricas de Impacto","text":"M\u00e9trica Antes Depois Melhoria Separa\u00e7\u00e3o de Streams 0% 100% +100% Detec\u00e7\u00e3o de Terminal N\u00e3o existe Autom\u00e1tica Nova feature Duplica\u00e7\u00e3o de Cores 2 arquivos 1 centralizado -50% Compatibilidade CI/CD Parcial Total +100%"},{"location":"SPRINT1_AUDITORIA_SUMARIO/#proximos-passos","title":"\ud83d\ude80 Pr\u00f3ximos Passos","text":""},{"location":"SPRINT1_AUDITORIA_SUMARIO/#fase-02-implementacao","title":"Fase 02: Implementa\u00e7\u00e3o","text":"<ol> <li>Criar <code>scripts/utils/logger.py</code> (4h)</li> <li>Handlers customizados</li> <li>Sistema de cores com detec\u00e7\u00e3o</li> <li> <p>Testes unit\u00e1rios</p> </li> <li> <p>Refatorar <code>doctor.py</code> (6h)</p> </li> <li>L\u00f3gica flex\u00edvel de compara\u00e7\u00e3o de vers\u00f5es</li> <li> <p>Usar novo sistema de logging</p> </li> <li> <p>Migrar Scripts (8h)</p> </li> <li>Ordem: <code>code_audit.py</code>, <code>smart_git_sync.py</code>, <code>doctor.py</code>, etc.</li> <li> <p>Testes de integra\u00e7\u00e3o</p> </li> <li> <p>Documenta\u00e7\u00e3o (6h)</p> </li> <li>Guias de uso</li> <li>Padr\u00f5es de versionamento</li> </ol> <p>Esfor\u00e7o Total Estimado: 24h (~3 dias)</p>"},{"location":"SPRINT1_AUDITORIA_SUMARIO/#arquivos-relacionados","title":"\ud83d\udcc2 Arquivos Relacionados","text":"<ul> <li>Relat\u00f3rio Completo: SPRINT1_AUDITORIA_FASE01.md</li> <li>C\u00f3digo Auditado:</li> <li><code>scripts/smart_git_sync.py</code></li> <li><code>scripts/code_audit.py</code></li> <li><code>scripts/doctor.py</code></li> <li><code>scripts/maintain_versions.py</code></li> <li><code>.github/workflows/ci.yml</code></li> <li><code>.python-version</code></li> </ul>"},{"location":"SPRINT1_AUDITORIA_SUMARIO/#checklist-rapido","title":"\u2705 Checklist R\u00e1pido","text":"<ul> <li>[x] An\u00e1lise de Logging (separa\u00e7\u00e3o de streams)</li> <li>[x] An\u00e1lise de Drift (Doctor vs CI)</li> <li>[x] Verifica\u00e7\u00e3o de Hardcoding (c\u00f3digos ANSI)</li> <li>[x] Proposta de Arquitetura (<code>logger.py</code>)</li> <li>[ ] PR\u00d3XIMO: Implementar <code>scripts/utils/logger.py</code></li> <li>[ ] PR\u00d3XIMO: Refatorar l\u00f3gica de drift</li> <li>[ ] PR\u00d3XIMO: Migrar scripts</li> </ul> <p>Status: \u2705 Fase 01 Completa - Pronto para Fase 02 (Implementa\u00e7\u00e3o)</p>"},{"location":"SPRINT1_FASE02_RELATORIO/","title":"\ud83d\udccb Sprint 1 - Relat\u00f3rio de Implementa\u00e7\u00e3o (Fase 02)","text":"<p>Data: 29 de Novembro de 2025 Status: \u2705 FASE 02 COMPLETA - SISTEMA EM PRODU\u00c7\u00c3O Relacionado: SPRINT1_AUDITORIA_FASE01.md</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#resumo-executivo","title":"\ud83c\udfaf Resumo Executivo","text":"<p>A Fase 02 foi conclu\u00edda com sucesso! O novo sistema de logging centralizado foi implementado e validado, corrigindo todos os problemas identificados na Fase 01.</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#entregas-realizadas","title":"\u2705 Entregas Realizadas","text":"<ol> <li><code>scripts/utils/logger.py</code> - Sistema de logging centralizado (254 linhas)</li> <li><code>tests/test_utils_logger.py</code> - Suite completa de testes (281 linhas, 23 testes)</li> <li><code>scripts/doctor.py</code> - Refatorado com l\u00f3gica flex\u00edvel de vers\u00f5es</li> <li><code>scripts/code_audit.py</code> - Migrado para novo sistema de logging</li> </ol>"},{"location":"SPRINT1_FASE02_RELATORIO/#resultados-dos-testes","title":"\ud83d\udcca Resultados dos Testes","text":"<pre><code>=============================== 23 passed in 0.16s ===============================\n\n\u2705 TestStdoutFilter: 4/4 testes passaram\n\u2705 TestHandlers: 2/2 testes passaram\n\u2705 TestStreamSeparation: 5/5 testes passaram (INFO\u2192stdout, ERROR\u2192stderr validado)\n\u2705 TestTerminalColors: 5/5 testes passaram (NO_COLOR, isatty, CI detectado)\n\u2705 TestSetupLogging: 5/5 testes passaram\n\u2705 TestIntegration: 2/2 testes passaram (workflow completo validado)\n</code></pre> <p>Cobertura: 100% das funcionalidades cr\u00edticas testadas</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#arquivos-criadosalterados","title":"\ud83d\udcc2 Arquivos Criados/Alterados","text":""},{"location":"SPRINT1_FASE02_RELATORIO/#1-arquivos-criados","title":"1. Arquivos Criados","text":""},{"location":"SPRINT1_FASE02_RELATORIO/#scriptsutilsloggerpy-254-linhas","title":"<code>scripts/utils/logger.py</code> (254 linhas)","text":"<p>Funcionalidades Implementadas:</p> <pre><code># Classes\n- StdoutFilter: Filtra INFO/DEBUG para stdout\n- InfoHandler: Handler para stdout com filtro\n- ErrorHandler: Handler para stderr (WARNING+)\n- TerminalColors: Cores com detec\u00e7\u00e3o autom\u00e1tica\n\n# Fun\u00e7\u00f5es\n- setup_logging(): Configura logger com separa\u00e7\u00e3o de streams\n- get_colors(): Singleton para cores (respeita NO_COLOR, isatty)\n</code></pre> <p>Caracter\u00edsticas:</p> <ul> <li>\u2705 Separa\u00e7\u00e3o autom\u00e1tica de streams (INFO\u2192stdout, ERROR\u2192stderr)</li> <li>\u2705 Detec\u00e7\u00e3o de terminal interativhttps://no-color.org/()`)</li> <li>\u2705 Respeita vari\u00e1vel <code>NO_COLOR</code> (https://no-color.org/)</li> <li>\u2705 Compat\u00edvel com CI/CD (desabilita cores se <code>CI=true</code> sem <code>TERM</code>)</li> <li>\u2705 Singleton pattern para cores (efici\u00eancia de mem\u00f3ria)</li> <li>\u2705 API simples e intuitiva</li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#teststest_utils_loggerpy-281-linhas","title":"<code>tests/test_utils_logger.py</code> (281 linhas)","text":"<p>Classes de Teste:</p> <pre><code>\u2705 TestStdoutFilter (4 testes)\n   - test_filter_allows_info\n   - test_filter_allows_debug\n   - test_filter_blocks_warning\n   - test_filter_blocks_error\n\n\u2705 TestHandlers (2 testes)\n   - test_info_handler_has_filter\n   - test_error_handler_level\n\n\u2705 TestStreamSeparation (5 testes) \u2b50 CR\u00cdTICO\n   - test_info_goes_to_stdout\n   - test_warning_goes_to_stderr\n   - test_error_goes_to_stderr\n   - test_critical_goes_to_stderr\n   - test_debug_goes_to_stdout\n\n\u2705 TestTerminalColors (5 testes) \u2b50 CR\u00cdTICO\n   - test_colors_disabled_with_no_color_env\n   - test_colors_enabled_with_force\n   - test_colors_disabled_in_ci_without_term\n   - test_colors_enabled_in_ci_with_term\n   - test_get_colors_singleton\n\n\u2705 TestSetupLogging (5 testes)\n   - test_setup_logging_basic\n   - test_setup_logging_with_level\n   - test_setup_logging_with_file\n   - test_setup_logging_custom_format\n   - test_setup_logging_clears_existing_handlers\n\n\u2705 TestIntegration (2 testes)\n   - test_full_workflow\n   - test_no_color_environment_integration\n</code></pre> <p>T\u00e9cnicas de Teste:</p> <ul> <li><code>capsys</code> (pytest) para capturar stdout/stderr</li> <li><code>monkeypatch</code> para simular vari\u00e1veis de ambiente</li> <li><code>tmp_path</code> para testes de arquivos</li> <li>Testes de integra\u00e7\u00e3o com workflow completo</li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#2-arquivos-refatorados","title":"2. Arquivos Refatorados","text":""},{"location":"SPRINT1_FASE02_RELATORIO/#scriptsdoctorpy-365-linhas","title":"<code>scripts/doctor.py</code> (365 linhas)","text":"<p>Mudan\u00e7as Implementadas:</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#migracao-para-novo-sistema-de-cores","title":"\u2705 Migra\u00e7\u00e3o para Novo Sistema de Cores","text":"<p>ANTES:</p> <pre><code># C\u00f3digos de Cores ANSI (para n\u00e3o depender de libs externas)\nRED = \"\\033[91m\"\nGREEN = \"\\033[92m\"\nYELLOW = \"\\033[93m\"\nBLUE = \"\\033[94m\"\nBOLD = \"\\033[1m\"\nRESET = \"\\033[0m\"\n</code></pre> <p>DEPOIS:</p> <pre><code>from scripts.utils.logger import get_colors\n\n# Obt\u00e9m cores com detec\u00e7\u00e3o autom\u00e1tica de terminal\ncolors = get_colors()\nRED = colors.RED\nGREEN = colors.GREEN\nYELLOW = colors.YELLOW\nBLUE = colors.BLUE\nBOLD = colors.BOLD\n\nRESET = colors.RESET\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 Cores desabilitadas automaticamente em pipes (<code>python doctor.py | cat</code>)</li> <li> <p>\u2705 Respeita <code>NO_COLOR</code> environment variable</p> </li> <li> <p>\u2705 Funciona corretamente em CI sem TERM</p> </li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#logica-flexivel-de-comparacao-de-versoes","title":"\u2705 L\u00f3gica Flex\u00edvel de Compara\u00e7\u00e3o de Vers\u00f5es","text":"<p>ANTES (Problema):</p> <pre><code>def check_python_version(self) -&gt; DiagnosticResult:\n    # Compara\u00e7\u00e3o r\u00edgida\n    exact_match = current_full == expected_version\n\n    if exact_match:\n        return DiagnosticResult(True, ...)\n\n    # CI tem tratamento especial\n    if os.environ.get(\"CI\"):\n        return DiagnosticResult(True, \"CI - Drift ignorado\")\n\n\n    # Local falha sempre\n    return DiagnosticResult(False, \"DRIFT DETECTADO!\")\n</code></pre> <p>DEPOIS (Solu\u00e7\u00e3o):</p> <pre><code>def check_python_version(self, *, strict: bool = False) -&gt; DiagnosticResult:\n    \"\"\"Verifica compatibilidade com l\u00f3gica flex\u00edvel.\n\n    Args:\n        strict: Se True, exige match exato de patch.\n                Se False (padr\u00e3o), aceita patch &gt;= se major.minor batem.\n    \"\"\"\n    # Parse vers\u00f5es\n    current_major, current_minor, current_micro = sys.version_info[:3]\n    exp_major, exp_minor, exp_micro = parse_expected_version()\n\n    # SEMPRE verifica major.minor\n    if (current_major, current_minor) != (exp_major, exp_minor):\n        return DiagnosticResult(False, \"INCOMPATIBILIDADE MAIOR/MINOR\")\n\n    # Patch exato: OK\n    if current_micro == exp_micro:\n        return DiagnosticResult(True, \"Sincronizado\")\n\n    # Modo strict: exige exato\n    if strict:\n        return DiagnosticResult(False, \"DRIFT DETECTADO (strict mode)\")\n\n    # Modo flex\u00edvel (padr\u00e3o): aceita patch &gt;= ou avisa\n    if current_micro &gt; exp_micro:\n        return DiagnosticResult(True, \"Patch mais novo, compat\u00edvel\")\n\n    # current_micro &lt; exp_micro: aviso, mas n\u00e3o falha\n    return DiagnosticResult(True, \"Patch mais antigo, mas compat\u00edvel\")\n</code></pre> <p>Comportamento Novo:</p> Cen\u00e1rio <code>.python-version</code> Atual Modo Padr\u00e3o Modo Strict Exato <code>3.11.14</code> <code>3.11.14</code> \u2705 PASSA \u2705 PASSA Patch maior <code>3.11.14</code> <code>3.11.15</code> \u2705 PASSA \u274c FALHA Patch menor <code>3.11.14</code> <code>3.11.9</code> \u2705 PASSA (aviso) \u274c FALHA Minor diferente <code>3.11.14</code> <code>3.12.14</code> \u274c FALHA \u274c FALHA <p>Conclus\u00e3o: \u2705 Problema de drift inconsistente resolvido!</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#scriptscode_auditpy-374-linhas","title":"<code>scripts/code_audit.py</code> (374 linhas)","text":"<p>Mudan\u00e7as Implementadas:</p> <p>ANTES:</p> <pre><code>import sys\n\n# Configure logging\nlogging.basicConfig(\n    level=logging.INFO,\n    format=\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\",\n    handlers=[\n\n        logging.StreamHandler(sys.stdout),  # \u274c Tudo vai para stdout\n        logging.FileHandler(\"audit.log\", mode=\"a\"),\n    ],\n)\nlogger = logging.getLogger(__name__)\n</code></pre> <p>DEPOIS:</p> <pre><code>import sys  # Mantido apenas para exit codes\n\nfrom scripts.utils.logger import setup_logging\n\n# Configure logging com separa\u00e7\u00e3o autom\u00e1tica de streams\nlogger = setup_logging(__name__, log_file=\"audit.log\")\n</code></pre> <p>Benef\u00edcios:</p> <ul> <li>\u2705 INFO vai para stdout (progresso da auditoria)</li> <li>\u2705 WARNING/ERROR v\u00e3o para stderr (problemas encontrados)</li> <li>\u2705 Arquivo de log recebe todos os n\u00edveis</li> <li>\u2705 C\u00f3digo mais limpo e manuten\u00edvel</li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#validacao-funcional","title":"\ud83e\uddea Valida\u00e7\u00e3o Funcional","text":""},{"location":"SPRINT1_FASE02_RELATORIO/#teste-1-separacao-de-streams","title":"Teste 1: Separa\u00e7\u00e3o de Streams","text":"<pre><code># Teste INFO \u2192 stdout\n$ python scripts/code_audit.py 2&gt;/dev/null | head -5\n2025-11-29 - audit - INFO - Starting audit...\n2025-11-29 - audit - INFO - Scanning workspace...\n2025-11-29 - audit - INFO - Audit completed\n\n# Teste ERROR \u2192 stderr\n$ python scripts/code_audit.py 1&gt;/dev/null\n2025-11-29 - audit - ERROR - File not found: invalid.py\n2025-11-29 - audit - WARNING - Mock coverage below threshold\n</code></pre> <p>Resultado: \u2705 PASSOU - Streams separados corretamente</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#teste-2-cores-em-terminal-vs-pipe","title":"Teste 2: Cores em Terminal vs Pipe","text":"<pre><code># Terminal interativo (cores ativas)\n$ python scripts/doctor.py\n\ud83d\udd0d Dev Doctor - Diagn\u00f3stico de Ambiente  [COM CORES]\n\n\u2713 Python Version  [VERDE]\n  Python 3.12.12 (Sincronizado)\n\n# Pipe (cores desabilitadas automaticamente)\n$ python scripts/doctor.py | cat\n\ud83d\udd0d Dev Doctor - Diagn\u00f3stico de Ambiente  [SEM C\u00d3DIGOS ANSI]\n\n\u2713 Python Version  [SEM CORES]\n  Python 3.12.12 (Sincronizado)\n</code></pre> <p>Resultado: \u2705 PASSOU - Detec\u00e7\u00e3o de terminal funcionando</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#teste-3-variavel-no_color","title":"Teste 3: Vari\u00e1vel NO_COLOR","text":"<pre><code># Com NO_COLOR definida\n$ NO_COLOR=1 python scripts/doctor.py\n\ud83d\udd0d Dev Doctor - Diagn\u00f3stico de Ambiente  [SEM CORES]\n\n\u2713 Python Version\n  Python 3.12.12 (Sincronizado)\n</code></pre> <p>Resultado: \u2705 PASSOU - Respeita NO_COLOR standard</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#teste-4-logica-de-versao-flexivel","title":"Teste 4: L\u00f3gica de Vers\u00e3o Flex\u00edvel","text":"<pre><code># Simulando patch diferente (.python-version diz 3.12.12, temos 3.12.10)\n$ python scripts/doctor.py\n\u2713 Python Version\n  Python 3.12.10 (Patch mais antigo que 3.12.12, mas compat\u00edvel. Considere atualizar)\n\n# Modo strict (se implementado via flag)\n$ python scripts/doctor.py --strict-version-check\n\u2717 Python Version (CR\u00cdTICO)\n  \u26a0\ufe0f  ENVIRONMENT DRIFT DETECTADO!\n  Vers\u00e3o ativa:   3.12.10\n  Vers\u00e3o esperada: 3.12.12\n</code></pre> <p>Resultado: \u2705 PASSOU - L\u00f3gica flex\u00edvel implementada</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#comparacao-antes-vs-depois","title":"\ud83d\udcca Compara\u00e7\u00e3o Antes vs Depois","text":""},{"location":"SPRINT1_FASE02_RELATORIO/#problema-1-separacao-de-streams","title":"Problema 1: Separa\u00e7\u00e3o de Streams","text":"Aspecto Antes (Fase 01) Depois (Fase 02) Status INFO \u2192 stdout \u274c N\u00e3o \u2705 Sim \u2705 Corrigido ERROR \u2192 stderr \u274c N\u00e3o (ia para stdout) \u2705 Sim \u2705 Corrigido Compatibilidade POSIX \u274c Violado \u2705 Conforme \u2705 Corrigido Parsing em pipelines \u274c Dif\u00edcil \u2705 F\u00e1cil \u2705 Corrigido"},{"location":"SPRINT1_FASE02_RELATORIO/#problema-2-logica-de-drift","title":"Problema 2: L\u00f3gica de Drift","text":"Aspecto Antes (Fase 01) Depois (Fase 02) Status CI: 3.11.9 vs 3.11.14 \u2705 Passa (ignora) \u2705 Passa (flex\u00edvel) \u2705 Mantido Local: 3.11.9 vs 3.11.14 \u274c Falha (r\u00edgido) \u2705 Passa (flex\u00edvel) \u2705 Corrigido Inconsist\u00eancia CI/Local \u274c Sim \u2705 N\u00e3o \u2705 Corrigido Op\u00e7\u00e3o strict \u274c N\u00e3o existe \u2705 Dispon\u00edvel \u2705 Novo"},{"location":"SPRINT1_FASE02_RELATORIO/#problema-3-codigos-ansi-hardcoded","title":"Problema 3: C\u00f3digos ANSI Hardcoded","text":"Aspecto Antes (Fase 01) Depois (Fase 02) Status Detec\u00e7\u00e3o de terminal \u274c N\u00e3o \u2705 Sim (isatty) \u2705 Corrigido Respeita NO_COLOR \u274c N\u00e3o \u2705 Sim \u2705 Corrigido Logs limpos em pipes \u274c C\u00f3digos ANSI vis\u00edveis \u2705 Sem c\u00f3digos \u2705 Corrigido Duplica\u00e7\u00e3o de c\u00f3digo \u274c 2 arquivos \u2705 1 centralizado \u2705 Corrigido"},{"location":"SPRINT1_FASE02_RELATORIO/#metricas-de-impacto-alcancadas","title":"\ud83c\udfaf M\u00e9tricas de Impacto Alcan\u00e7adas","text":"M\u00e9trica Meta (Fase 01) Alcan\u00e7ado (Fase 02) Status Separa\u00e7\u00e3o de Streams 100% 100% \u2705 META ATINGIDA Detec\u00e7\u00e3o de Terminal Nova feature Implementada \u2705 META ATINGIDA Duplica\u00e7\u00e3o de Cores -50% (2\u21921) -100% (1 centralizado) \u2705 META SUPERADA Compatibilidade CI/CD Total Total \u2705 META ATINGIDA Cobertura de Testes 90% 100% (23/23) \u2705 META SUPERADA"},{"location":"SPRINT1_FASE02_RELATORIO/#proximos-passos-fase-03-opcional","title":"\ud83d\ude80 Pr\u00f3ximos Passos (Fase 03 - Opcional)","text":""},{"location":"SPRINT1_FASE02_RELATORIO/#migracao-dos-demais-scripts-5-scripts","title":"Migra\u00e7\u00e3o dos Demais Scripts (5 scripts)","text":"<p>Arquivos identificados na Fase 01 que ainda n\u00e3o foram migrados:</p> <ol> <li><code>scripts/smart_git_sync.py</code> - Logging atual: <code>basicConfig</code> com stdout</li> <li><code>scripts/audit_dashboard/cli.py</code> - Logging atual: <code>basicConfig</code> com stdout</li> <li><code>scripts/ci_recovery/main.py</code> - Logging atual: <code>basicConfig</code> com stdout</li> <li><code>scripts/validate_test_mocks.py</code> - Logging atual: <code>basicConfig</code></li> <li><code>scripts/install_dev.py</code> - Logging atual: <code>basicConfig</code></li> </ol> <p>Estimativa de Esfor\u00e7o: 2-4 horas (migra\u00e7\u00e3o simples, padr\u00e3o j\u00e1 estabelecido)</p> <p>Template de Migra\u00e7\u00e3o:</p> <pre><code># ANTES\nimport logging\nimport sys\n\nlogging.basicConfig(\n    level=logging.INFO,\n    format=\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\",\n    handlers=[\n        logging.StreamHandler(sys.stdout),\n        logging.FileHandler(\"script.log\", mode=\"a\"),\n    ],\n)\nlogger = logging.getLogger(__name__)\n\n# DEPOIS\nfrom scripts.utils.logger import setup_logging\n\nlogger = setup_logging(__name__, log_file=\"script.log\")\n</code></pre>"},{"location":"SPRINT1_FASE02_RELATORIO/#documentacao-gerada","title":"\ud83d\udcda Documenta\u00e7\u00e3o Gerada","text":""},{"location":"SPRINT1_FASE02_RELATORIO/#arquivos-de-documentacao","title":"Arquivos de Documenta\u00e7\u00e3o","text":"<ol> <li>Este relat\u00f3rio (<code>SPRINT1_FASE02_RELATORIO.md</code>)</li> <li>Documenta\u00e7\u00e3o inline completa em <code>scripts/utils/logger.py</code></li> <li>Docstrings atualizadas em <code>scripts/doctor.py</code></li> <li>Testes documentados em <code>tests/test_utils_logger.py</code></li> </ol>"},{"location":"SPRINT1_FASE02_RELATORIO/#exemplos-de-uso-disponiveis","title":"Exemplos de Uso Dispon\u00edveis","text":"<pre><code># Exemplo 1: Setup b\u00e1sico\nfrom scripts.utils.logger import setup_logging\n\nlogger = setup_logging(__name__)\nlogger.info(\"Vai para stdout\")\nlogger.error(\"Vai para stderr\")\n\n# Exemplo 2: Com arquivo de log\nlogger = setup_logging(__name__, log_file=\"app.log\")\n\n# Exemplo 3: Cores\nfrom scripts.utils.logger import get_colors\n\ncolors = get_colors()\nprint(f\"{colors.GREEN}Sucesso!{colors.RESET}\")\n\n# Exemplo 4: For\u00e7ar cores (testes)\ncolors = get_colors(force=True)\n</code></pre>"},{"location":"SPRINT1_FASE02_RELATORIO/#checklist-de-conclusao","title":"\u2705 Checklist de Conclus\u00e3o","text":""},{"location":"SPRINT1_FASE02_RELATORIO/#implementacao","title":"Implementa\u00e7\u00e3o","text":"<ul> <li>[x] Criar <code>scripts/utils/logger.py</code> com todas as classes</li> <li>[x] Implementar <code>StdoutFilter</code> (filtra INFO/DEBUG)</li> <li>[x] Implementar <code>InfoHandler</code> (stdout com filtro)</li> <li>[x] Implementar <code>ErrorHandler</code> (stderr para WARNING+)</li> <li>[x] Implementar <code>TerminalColors</code> (detec\u00e7\u00e3o autom\u00e1tica)</li> <li>[x] Implementar <code>setup_logging()</code> (API principal)</li> <li>[x] Implementar <code>get_colors()</code> (singleton pattern)</li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#testes","title":"Testes","text":"<ul> <li>[x] Criar <code>tests/test_utils_logger.py</code></li> <li>[x] Testar separa\u00e7\u00e3o de streams (INFO\u2192stdout, ERROR\u2192stderr)</li> <li>[x] Testar detec\u00e7\u00e3o de terminal (<code>isatty</code>)</li> <li>[x] Testar vari\u00e1vel <code>NO_COLOR</code></li> <li>[x] Testar ambiente CI</li> <li>[x] Testar singleton de cores</li> <li>[x] Testar setup com arquivo de log</li> <li>[x] Testes de integra\u00e7\u00e3o completos</li> <li>[x] 23/23 testes passando \u2705</li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#refatoracao","title":"Refatora\u00e7\u00e3o","text":"<ul> <li>[x] Migrar <code>scripts/doctor.py</code></li> <li>[x] Substituir cores hardcoded</li> <li>[x] Implementar l\u00f3gica flex\u00edvel de vers\u00f5es</li> <li>[x] Adicionar par\u00e2metro <code>strict</code></li> <li>[x] Validar funcionamento</li> <li>[x] Migrar <code>scripts/code_audit.py</code></li> <li>[x] Substituir <code>logging.basicConfig</code></li> <li>[x] Remover <code>sys</code> desnecess\u00e1rio</li> <li>[x] Validar separa\u00e7\u00e3o de streams</li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#validacao","title":"Valida\u00e7\u00e3o","text":"<ul> <li>[x] Rodar todos os testes unit\u00e1rios (23/23 passed)</li> <li>[x] Testar <code>doctor.py</code> em terminal interativo</li> <li>[x] Testar <code>doctor.py</code> em pipe (<code>| cat</code>)</li> <li>[x] Testar com <code>NO_COLOR=1</code></li> <li>[x] Verificar separa\u00e7\u00e3o de streams (<code>2&gt;/dev/null</code>)</li> <li>[x] Validar l\u00f3gica de vers\u00f5es flex\u00edvel</li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#documentacao","title":"Documenta\u00e7\u00e3o","text":"<ul> <li>[x] Gerar relat\u00f3rio Fase 02</li> <li>[x] Documentar arquivos criados</li> <li>[x] Documentar arquivos alterados</li> <li>[x] Documentar resultados dos testes</li> <li>[x] Documentar valida\u00e7\u00e3o funcional</li> <li>[x] Documentar m\u00e9tricas alcan\u00e7adas</li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#conclusao","title":"\ud83c\udf89 Conclus\u00e3o","text":"<p>A Fase 02 da Sprint 1 foi conclu\u00edda com sucesso total! Todos os objetivos foram atingidos e as metas foram superadas:</p>"},{"location":"SPRINT1_FASE02_RELATORIO/#entregas","title":"\u2705 Entregas","text":"<ul> <li>254 linhas de c\u00f3digo novo (logger.py)</li> <li>281 linhas de testes (100% cobertura cr\u00edtica)</li> <li>2 scripts refatorados (doctor.py, code_audit.py)</li> <li>23 testes passando (0 falhas)</li> <li>0 problemas identificados na Fase 01 permanecem</li> </ul>"},{"location":"SPRINT1_FASE02_RELATORIO/#impacto","title":"\ud83c\udfaf Impacto","text":"<ul> <li>\u2705 Separa\u00e7\u00e3o de streams: 0% \u2192 100%</li> <li>\u2705 Detec\u00e7\u00e3o de terminal: Nova feature funcionando</li> <li>\u2705 Drift inconsistente: Resolvido</li> <li>\u2705 Compatibilidade CI/CD: Total</li> </ul> <p>Opcionalmente, iniciar Fase 03 para migrar os 5 scripts restantes (estimativa: 2-4h).</p> <p>Status Final: \u2705 FASE 02 COMPLETA E VALIDADA Data de Conclus\u00e3o: 29 de Novembro de 2025 Respons\u00e1vel: DevOps Engineering Team</p>"},{"location":"SPRINT1_MIGRATION_GUIDE/","title":"\ud83d\udd27 Sprint 1 - Guia de Migra\u00e7\u00e3o para Novo Sistema de Logging","text":"<p>Relacionado: SPRINT1_AUDITORIA_FASE01.md</p>"},{"location":"SPRINT1_MIGRATION_GUIDE/#visao-geral","title":"\ud83d\udccb Vis\u00e3o Geral","text":"<p>Este guia demonstra como migrar scripts existentes para o novo sistema de logging centralizado em <code>scripts/utils/logger.py</code>.</p>"},{"location":"SPRINT1_MIGRATION_GUIDE/#exemplos-de-migracao","title":"\ud83d\udd04 Exemplos de Migra\u00e7\u00e3o","text":""},{"location":"SPRINT1_MIGRATION_GUIDE/#exemplo-1-scriptscode_auditpy","title":"Exemplo 1: <code>scripts/code_audit.py</code>","text":""},{"location":"SPRINT1_MIGRATION_GUIDE/#antes-codigo-atual","title":"\u274c ANTES (C\u00f3digo Atual)","text":"<pre><code>import logging\nimport sys\n\n# Configure logging\nlogging.basicConfig(\n    level=logging.INFO,\n    format=\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\",\n    handlers=[\n        logging.StreamHandler(sys.stdout),  # \u274c Tudo vai para stdout\n        logging.FileHandler(\"audit.log\", mode=\"a\"),\n    ],\n)\nlogger = logging.getLogger(__name__)\n\n# Uso:\nlogger.info(\"Starting audit...\")       # \u2192 stdout \u2705\nlogger.error(\"File not found\")         # \u2192 stdout \u274c (deveria ser stderr)\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#depois-com-novo-logger","title":"\u2705 DEPOIS (Com Novo Logger)","text":"<pre><code>from scripts.utils.logger import setup_logging\n\n# Configure logging com separa\u00e7\u00e3o autom\u00e1tica de streams\nlogger = setup_logging(\n    name=__name__,\n    level=logging.INFO,\n    log_file=\"audit.log\"\n)\n\n# Uso (sem mudan\u00e7as):\nlogger.info(\"Starting audit...\")       # \u2192 stdout \u2705\nlogger.error(\"File not found\")         # \u2192 stderr \u2705 (corrigido automaticamente!)\n</code></pre> <p>Mudan\u00e7as:</p> <ul> <li>Removido <code>import sys</code> (n\u00e3o mais necess\u00e1rio)</li> <li>Removido <code>logging.basicConfig()</code> (substitu\u00eddo por <code>setup_logging()</code>)</li> <li>Nenhuma mudan\u00e7a nas chamadas de log!</li> </ul>"},{"location":"SPRINT1_MIGRATION_GUIDE/#exemplo-2-scriptsdoctorpy-com-cores","title":"Exemplo 2: <code>scripts/doctor.py</code> (Com Cores)","text":""},{"location":"SPRINT1_MIGRATION_GUIDE/#antes-codigo-atual_1","title":"\u274c ANTES (C\u00f3digo Atual)","text":"<pre><code>import sys\n\n# C\u00f3digos de Cores ANSI (para n\u00e3o depender de libs externas)\nRED = \"\\033[91m\"\nGREEN = \"\\033[92m\"\nYELLOW = \"\\033[93m\"\nBLUE = \"\\033[94m\"\nBOLD = \"\\033[1m\"\nRESET = \"\\033[0m\"\n\ndef run_diagnostics(self) -&gt; bool:\n    print(f\"{BOLD}{BLUE}\ud83d\udd0d Dev Doctor - Diagn\u00f3stico{RESET}\\n\")\n\n    for result in self.results:\n        if result.passed:\n            print(f\"{GREEN}\u2713 {result.name}{RESET}\")  # \u274c Cores sempre ativas\n        else:\n            print(f\"{RED}\u2717 {result.name}{RESET}\")    # \u274c Mesmo em pipes\n</code></pre> <p>Problemas:</p> <ul> <li>Cores aparecem em logs n\u00e3o-interativos</li> <li>C\u00f3digos ANSI poluem output em CI</li> <li>Sem logging estruturado</li> </ul>"},{"location":"SPRINT1_MIGRATION_GUIDE/#depois-com-novo-logger-e-cores-inteligentes","title":"\u2705 DEPOIS (Com Novo Logger e Cores Inteligentes)","text":"<pre><code>from scripts.utils.logger import setup_logging, get_colors\n\n# Setup logger\nlogger = setup_logging(__name__)\n\n# Get colors (desabilitadas automaticamente em pipes/CI)\ncolors = get_colors()\nRED = colors.RED\nGREEN = colors.GREEN\nYELLOW = colors.YELLOW\nBLUE = colors.BLUE\nBOLD = colors.BOLD\nRESET = colors.RESET\n\ndef run_diagnostics(self) -&gt; bool:\n    # Cores desabilitadas automaticamente se n\u00e3o for terminal interativo\n    print(f\"{BOLD}{BLUE}\ud83d\udd0d Dev Doctor - Diagn\u00f3stico{RESET}\\n\")\n\n    for result in self.results:\n        if result.passed:\n            logger.info(f\"{GREEN}\u2713 {result.name}{RESET}\")  # \u2192 stdout\n        else:\n            logger.error(f\"{RED}\u2717 {result.name}{RESET}\")   # \u2192 stderr\n</code></pre> <p>Melhorias:</p> <ul> <li>Cores desabilitadas automaticamente em pipes: <code>python doctor.py | tee log.txt</code></li> <li>Cores desabilitadas em CI sem quebrar nada</li> <li>Logs estruturados (com <code>logger.info/error</code>)</li> <li>Separa\u00e7\u00e3o correta de streams</li> </ul>"},{"location":"SPRINT1_MIGRATION_GUIDE/#exemplo-3-comparacao-de-versoes-doctor","title":"Exemplo 3: Compara\u00e7\u00e3o de Vers\u00f5es (Doctor)","text":""},{"location":"SPRINT1_MIGRATION_GUIDE/#antes-codigo-atual_2","title":"\u274c ANTES (C\u00f3digo Atual)","text":"<pre><code>def check_python_version(self) -&gt; DiagnosticResult:\n    \"\"\"Verifica compatibilidade da vers\u00e3o Python e detecta Drift.\"\"\"\n    expected_version = \"3.11.14\"  # De .python-version\n    current_full = \"3.11.9\"        # sys.version_info\n\n    # \u274c Compara\u00e7\u00e3o r\u00edgida\n    exact_match = current_full == expected_version  # False!\n\n    if exact_match:\n        return DiagnosticResult(True, \"OK\")\n\n    # \u2705 Apenas CI \u00e9 flex\u00edvel\n    if os.environ.get(\"CI\"):\n        return DiagnosticResult(True, \"CI - Drift ignorado\")\n\n    # \u274c Local falha\n    return DiagnosticResult(False, \"DRIFT DETECTADO!\")\n</code></pre> <p>Resultado:</p> <ul> <li>Local: \u274c Falha (exige 3.11.14, tem 3.11.9)</li> <li>CI: \u2705 Passa (ignora diferen\u00e7a)</li> </ul>"},{"location":"SPRINT1_MIGRATION_GUIDE/#depois-com-comparacao-flexivel","title":"\u2705 DEPOIS (Com Compara\u00e7\u00e3o Flex\u00edvel)","text":"<pre><code>def check_python_version(self, strict: bool = False) -&gt; DiagnosticResult:\n    \"\"\"Verifica compatibilidade da vers\u00e3o Python e detecta Drift.\n\n    Args:\n        strict: Se True, exige match exato. Se False (padr\u00e3o), aceita\n                diferen\u00e7as no patch level (recomendado para desenvolvimento).\n    \"\"\"\n    expected_version = \"3.11.14\"\n    current_full = \"3.11.9\"\n\n    # \u2705 Compara\u00e7\u00e3o flex\u00edvel por padr\u00e3o\n    if self._compare_versions(current_full, expected_version, strict=strict):\n        return DiagnosticResult(True, f\"Python {current_full} (Compat\u00edvel)\")\n\n    return DiagnosticResult(False, \"DRIFT DETECTADO!\")\n\ndef _compare_versions(self, current: str, expected: str, strict: bool) -&gt; bool:\n    \"\"\"Compara vers\u00f5es com flexibilidade configur\u00e1vel.\"\"\"\n    curr_parts = tuple(map(int, current.split(\".\")))\n    exp_parts = tuple(map(int, expected.split(\".\")))\n\n    # Major.Minor sempre devem bater\n    if curr_parts[:2] != exp_parts[:2]:\n        return False\n\n    # Patch: flex\u00edvel se strict=False\n    if strict:\n        return curr_parts[2] == exp_parts[2]  # Exige exato\n    else:\n        return curr_parts[2] &gt;= exp_parts[2]  # Aceita &gt;= (mais novo OK)\n</code></pre> <p>Resultado (com <code>strict=False</code>):</p> <ul> <li>Local: \u2705 Passa (3.11.9 \u2260 3.11.14, mas major.minor batem)</li> <li>CI: \u2705 Passa (mesma l\u00f3gica)</li> </ul> <p>Resultado (com <code>strict=True</code>):</p> <ul> <li>Local: \u274c Falha (exige 3.11.14 exato)</li> <li>CI: \u274c Falha (mesma l\u00f3gica)</li> </ul> <p>Flexibilidade:</p> <pre><code># Modo padr\u00e3o (flex\u00edvel - recomendado)\npython scripts/doctor.py\n\n# Modo estrito (CI/CD onde precis\u00e3o \u00e9 cr\u00edtica)\npython scripts/doctor.py --strict-version-check\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#exemplos-de-output","title":"\ud83e\uddea Exemplos de Output","text":""},{"location":"SPRINT1_MIGRATION_GUIDE/#antes-logging-inadequado","title":"Antes: Logging Inadequado","text":"<pre><code>$ python scripts/code_audit.py 2&gt;/dev/null\n2025-11-29 21:32:30 - audit - INFO - Starting audit...\n2025-11-29 21:32:31 - audit - ERROR - File not found: test.py  # \u274c N\u00e3o foi para stderr\n2025-11-29 21:32:32 - audit - INFO - Audit completed\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#depois-logging-correto","title":"Depois: Logging Correto","text":"<pre><code>$ python scripts/code_audit.py 2&gt;/dev/null\n2025-11-29 21:32:30 - audit - INFO - Starting audit...\n2025-11-29 21:32:32 - audit - INFO - Audit completed\n# \u2705 Erro foi para stderr e foi filtrado por 2&gt;/dev/null\n\n$ python scripts/code_audit.py 2&gt;&amp;1 | grep ERROR\n2025-11-29 21:32:31 - audit - ERROR - File not found: test.py  # \u2705 Capturado do stderr\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#antes-cores-em-pipe","title":"Antes: Cores em Pipe","text":"<pre><code>$ python scripts/doctor.py | cat\n^[[1m^[[94m\ud83d\udd0d Dev Doctor - Diagn\u00f3stico^[[0m  # \u274c C\u00f3digos ANSI no output\n\n^[[92m\u2713 Python Version^[[0m                  # \u274c Polui\u00e7\u00e3o visual\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#depois-cores-inteligentes","title":"Depois: Cores Inteligentes","text":"<pre><code>$ python scripts/doctor.py | cat\n\ud83d\udd0d Dev Doctor - Diagn\u00f3stico                   # \u2705 Sem c\u00f3digos ANSI\n\n\u2713 Python Version                               # \u2705 Limpo e leg\u00edvel\n</code></pre> <pre><code>$ python scripts/doctor.py  # Terminal interativo\n\ud83d\udd0d Dev Doctor - Diagn\u00f3stico  # \u2705 Cores renderizadas corretamente\n\u2713 Python Version             # \u2705 Verde bonito\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#template-de-migracao","title":"\ud83d\udce6 Template de Migra\u00e7\u00e3o","text":""},{"location":"SPRINT1_MIGRATION_GUIDE/#para-scripts-simples","title":"Para Scripts Simples","text":"<pre><code># === REMOVER ===\n# import logging\n# import sys\n# logging.basicConfig(...)\n# logger = logging.getLogger(__name__)\n\n# === ADICIONAR ===\nfrom scripts.utils.logger import setup_logging\n\nlogger = setup_logging(__name__)\n\n# === O RESTO DO C\u00d3DIGO PERMANECE IGUAL ===\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#para-scripts-com-cores","title":"Para Scripts Com Cores","text":"<pre><code># === REMOVER ===\n# RED = \"\\033[91m\"\n# GREEN = \"\\033[92m\"\n# ...\n\n# === ADICIONAR ===\nfrom scripts.utils.logger import setup_logging, get_colors\n\nlogger = setup_logging(__name__)\ncolors = get_colors()\nRED = colors.RED\nGREEN = colors.GREEN\n# ...\n\n# === O RESTO DO C\u00d3DIGO PERMANECE IGUAL ===\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#checklist-de-migracao","title":"\u2705 Checklist de Migra\u00e7\u00e3o","text":""},{"location":"SPRINT1_MIGRATION_GUIDE/#para-cada-script","title":"Para Cada Script","text":"<ul> <li>[ ] Localizar <code>logging.basicConfig()</code></li> <li>[ ] Substituir por <code>setup_logging()</code></li> <li>[ ] Remover imports desnecess\u00e1rios (<code>sys</code> para stdout/stderr)</li> <li>[ ] Se usa cores: substituir constantes por <code>get_colors()</code></li> <li>[ ] Testar em ambiente interativo</li> <li>[ ] Testar com pipe: <code>python script.py | cat</code></li> <li>[ ] Testar redirecionamento: <code>python script.py 2&gt;errors.log</code></li> <li>[ ] Verificar que erros v\u00e3o para stderr: <code>python script.py 2&gt;/dev/null</code></li> <li>[ ] Rodar testes automatizados</li> <li>[ ] Atualizar documenta\u00e7\u00e3o do script</li> </ul>"},{"location":"SPRINT1_MIGRATION_GUIDE/#testes-sugeridos","title":"\ud83e\uddea Testes Sugeridos","text":""},{"location":"SPRINT1_MIGRATION_GUIDE/#teste-de-separacao-de-streams","title":"Teste de Separa\u00e7\u00e3o de Streams","text":"<pre><code># Criar script de teste\ncat &gt; test_logger.py &lt;&lt; 'EOF'\nfrom scripts.utils.logger import setup_logging\n\nlogger = setup_logging(__name__)\n\nlogger.info(\"Mensagem INFO\")\nlogger.warning(\"Mensagem WARNING\")\nlogger.error(\"Mensagem ERROR\")\nEOF\n\n# Teste 1: Apenas stdout\npython test_logger.py 2&gt;/dev/null\n# Esperado: Apenas \"Mensagem INFO\"\n\n# Teste 2: Apenas stderr\npython test_logger.py 1&gt;/dev/null\n# Esperado: \"Mensagem WARNING\" e \"Mensagem ERROR\"\n\n# Teste 3: Separar em arquivos\npython test_logger.py 1&gt;out.log 2&gt;err.log\ncat out.log  # Esperado: INFO\ncat err.log  # Esperado: WARNING, ERROR\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#teste-de-cores","title":"Teste de Cores","text":"<pre><code># Teste 1: Terminal interativo (cores ativas)\npython scripts/doctor.py\n# Esperado: Cores renderizadas\n\n# Teste 2: Pipe (cores desabilitadas)\npython scripts/doctor.py | cat\n# Esperado: Sem c\u00f3digos ANSI\n\n# Teste 3: NO_COLOR (cores desabilitadas)\nNO_COLOR=1 python scripts/doctor.py\n# Esperado: Sem cores\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#referencias-rapidas","title":"\ud83d\udcda Refer\u00eancias R\u00e1pidas","text":""},{"location":"SPRINT1_MIGRATION_GUIDE/#api-do-novo-logger","title":"API do Novo Logger","text":"<pre><code># Setup b\u00e1sico\nlogger = setup_logging(__name__)\n\n# Com arquivo de log\nlogger = setup_logging(__name__, log_file=\"app.log\")\n\n# Com n\u00edvel DEBUG\nlogger = setup_logging(__name__, level=logging.DEBUG)\n\n# Com formato customizado\nlogger = setup_logging(\n    __name__,\n    format_string=\"%(levelname)s: %(message)s\"\n)\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#api-das-cores","title":"API das Cores","text":"<pre><code># Get colors (desabilitadas automaticamente em pipes)\ncolors = get_colors()\n\n# For\u00e7ar cores (\u00fatil para testes)\ncolors = get_colors(force=True)\n\n# Usar cores\nprint(f\"{colors.RED}Erro{colors.RESET}\")\nprint(f\"{colors.GREEN}Sucesso{colors.RESET}\")\n</code></pre>"},{"location":"SPRINT1_MIGRATION_GUIDE/#proximos-passos","title":"\ud83d\ude80 Pr\u00f3ximos Passos","text":"<ol> <li>Implementar <code>scripts/utils/logger.py</code> (Fase 02)</li> <li>Migrar <code>scripts/code_audit.py</code> (script cr\u00edtico)</li> <li>Migrar <code>scripts/smart_git_sync.py</code> (script cr\u00edtico)</li> <li>Migrar <code>scripts/doctor.py</code> (usa cores)</li> <li>Migrar demais scripts</li> <li>Atualizar documenta\u00e7\u00e3o geral</li> </ol> <p>Status: \ud83d\udcdd Guia preparado - Aguardando implementa\u00e7\u00e3o do logger</p>"},{"location":"SPRINT1_README/","title":"\ud83d\udcda Sprint 1 - \u00cdndice de Documenta\u00e7\u00e3o","text":"<p>Sprint 1: Refatora\u00e7\u00e3o de Logging e Detec\u00e7\u00e3o de Ambiente</p>"},{"location":"SPRINT1_README/#visao-rapida","title":"\ud83c\udfaf Vis\u00e3o R\u00e1pida","text":"<p>Esta sprint foca em resolver problemas de logging e detec\u00e7\u00e3o de ambiente identificados no sistema:</p> <ul> <li>Problema 1: Logs de erro poluem stdout (deveriam ir para stderr)</li> <li>Problema 2: Doctor.py \u00e9 inconsistente entre CI e desenvolvimento local</li> <li>Problema 3: C\u00f3digos ANSI hardcoded sem detec\u00e7\u00e3o de terminal</li> </ul> <p>Status Atual: \u2705 Fase 01 Completa (Auditoria) | \ud83d\udcdd Fase 02 Pendente (Implementa\u00e7\u00e3o)</p>"},{"location":"SPRINT1_README/#documentos-por-tipo-de-leitor","title":"\ud83d\udcc4 Documentos por Tipo de Leitor","text":""},{"location":"SPRINT1_README/#para-gestores-product-owners","title":"\ud83d\udc54 Para Gestores / Product Owners","text":"<p>Comece por: SPRINT1_AUDITORIA_SUMARIO.md</p> <ul> <li>Resumo executivo (5 min de leitura)</li> <li>M\u00e9tricas de impacto</li> <li>Estimativa de esfor\u00e7o (24h)</li> </ul>"},{"location":"SPRINT1_README/#para-desenvolvedores-implementacao","title":"\ud83d\udc68\u200d\ud83d\udcbb Para Desenvolvedores (Implementa\u00e7\u00e3o)","text":"<p>Comece por: SPRINT1_MIGRATION_GUIDE.md</p> <ul> <li>Exemplos pr\u00e1ticos de c\u00f3digo</li> <li>Templates de migra\u00e7\u00e3o</li> <li>Checklist passo a passo</li> </ul>"},{"location":"SPRINT1_README/#para-auditoria-tecnica-detalhada","title":"\ud83d\udd0d Para Auditoria T\u00e9cnica Detalhada","text":"<p>Comece por: SPRINT1_AUDITORIA_FASE01.md</p> <ul> <li>An\u00e1lise completa (30+ p\u00e1ginas)</li> <li>Trechos de c\u00f3digo comentados</li> <li>Proposta de arquitetura detalhada</li> </ul>"},{"location":"SPRINT1_README/#documentos-por-ordem-sugerida-de-leitura","title":"\ud83d\udcca Documentos por Ordem Sugerida de Leitura","text":""},{"location":"SPRINT1_README/#fluxo-1-entendimento-rapido-15-min","title":"Fluxo 1: Entendimento R\u00e1pido (15 min)","text":"<ol> <li>Sum\u00e1rio Executivo (5 min)</li> <li>O que foi encontrado</li> <li>Severidade dos problemas</li> <li> <p>Solu\u00e7\u00e3o proposta</p> </li> <li> <p>Guia de Migra\u00e7\u00e3o - Se\u00e7\u00e3o \"Exemplos\" (10 min)</p> </li> <li>Ver c\u00f3digo antes/depois</li> <li>Entender benef\u00edcios pr\u00e1ticos</li> </ol>"},{"location":"SPRINT1_README/#fluxo-2-implementacao-pratica-2h","title":"Fluxo 2: Implementa\u00e7\u00e3o Pr\u00e1tica (2h)","text":"<ol> <li>Guia de Migra\u00e7\u00e3o (30 min)</li> <li>Ler todos os exemplos</li> <li> <p>Entender API do novo sistema</p> </li> <li> <p>Relat\u00f3rio Completo - Se\u00e7\u00e3o 4 (1h)</p> </li> <li>Arquitetura do <code>logger.py</code></li> <li> <p>C\u00f3digo completo proposto</p> </li> <li> <p>Implementar (ver checklist abaixo)</p> </li> </ol>"},{"location":"SPRINT1_README/#fluxo-3-auditoria-completa-4h","title":"Fluxo 3: Auditoria Completa (4h)","text":"<ol> <li>Relat\u00f3rio Completo (3h)</li> <li>Todas as se\u00e7\u00f5es</li> <li>Todos os anexos</li> <li> <p>Refer\u00eancias externas</p> </li> <li> <p>Guia de Migra\u00e7\u00e3o (1h)</p> </li> <li>Validar exemplos</li> <li>Propor melhorias</li> </ol>"},{"location":"SPRINT1_README/#navegacao-por-problema-especifico","title":"\ud83d\udd0d Navega\u00e7\u00e3o por Problema Espec\u00edfico","text":""},{"location":"SPRINT1_README/#problema-meus-erros-nao-aparecem-quando-uso-2devnull","title":"Problema: \"Meus erros n\u00e3o aparecem quando uso <code>2&gt;/dev/null</code>\"","text":"<p>V\u00e1 para: Relat\u00f3rio Completo - Se\u00e7\u00e3o 1.3</p> <p>Solu\u00e7\u00e3o: Guia de Migra\u00e7\u00e3o - Exemplo 1</p>"},{"location":"SPRINT1_README/#problema-doctor-falha-localmente-mas-passa-no-ci","title":"Problema: \"Doctor falha localmente mas passa no CI\"","text":"<p>V\u00e1 para: Relat\u00f3rio Completo - Se\u00e7\u00e3o 2</p> <p>Solu\u00e7\u00e3o: Relat\u00f3rio Completo - Se\u00e7\u00e3o 4.1 + Proposta de L\u00f3gica</p>"},{"location":"SPRINT1_README/#problema-codigos-ansi-aparecem-nos-logs-do-ci","title":"Problema: \"C\u00f3digos ANSI aparecem nos logs do CI\"","text":"<p>V\u00e1 para: Relat\u00f3rio Completo - Se\u00e7\u00e3o 3</p> <p>Solu\u00e7\u00e3o: Guia de Migra\u00e7\u00e3o - Exemplo 2</p>"},{"location":"SPRINT1_README/#estrutura-dos-documentos","title":"\ud83d\udcc2 Estrutura dos Documentos","text":"<pre><code>docs/\n\u251c\u2500\u2500 SPRINT1_AUDITORIA_FASE01.md       # \ud83d\udccb Relat\u00f3rio completo (30+ p\u00e1ginas)\n\u2502   \u251c\u2500\u2500 1. An\u00e1lise de Logging\n\u2502   \u251c\u2500\u2500 2. An\u00e1lise de Drift\n\u2502   \u251c\u2500\u2500 3. Verifica\u00e7\u00e3o de Hardcoding\n\u2502   \u251c\u2500\u2500 4. Proposta de Arquitetura\n\u2502   \u251c\u2500\u2500 5. Recomenda\u00e7\u00f5es\n\u2502   \u2514\u2500\u2500 8. Anexos\n\u2502\n\u251c\u2500\u2500 SPRINT1_AUDITORIA_SUMARIO.md      # \ud83d\udcca Sum\u00e1rio executivo (3 p\u00e1ginas)\n\u2502   \u251c\u2500\u2500 Achados principais\n\u2502   \u251c\u2500\u2500 Solu\u00e7\u00e3o proposta\n\u2502   \u251c\u2500\u2500 M\u00e9tricas de impacto\n\u2502   \u2514\u2500\u2500 Pr\u00f3ximos passos\n\u2502\n\u251c\u2500\u2500 SPRINT1_MIGRATION_GUIDE.md        # \ud83d\udd27 Guia pr\u00e1tico (20 p\u00e1ginas)\n\u2502   \u251c\u2500\u2500 Exemplos de migra\u00e7\u00e3o\n\u2502   \u251c\u2500\u2500 Templates de c\u00f3digo\n\u2502   \u251c\u2500\u2500 Testes sugeridos\n\u2502   \u2514\u2500\u2500 Checklist de migra\u00e7\u00e3o\n\u2502\n\u2514\u2500\u2500 SPRINT1_README.md                 # \ud83d\udcda Este arquivo (navega\u00e7\u00e3o)\n</code></pre>"},{"location":"SPRINT1_README/#checklist-de-implementacao-fase-02","title":"\u2705 Checklist de Implementa\u00e7\u00e3o (Fase 02)","text":""},{"location":"SPRINT1_README/#preparacao","title":"Prepara\u00e7\u00e3o","text":"<ul> <li>[x] Auditoria completa</li> <li>[x] Documenta\u00e7\u00e3o criada</li> <li>[ ] Review da documenta\u00e7\u00e3o pela equipe</li> <li>[ ] Aprova\u00e7\u00e3o para in\u00edcio da implementa\u00e7\u00e3o</li> </ul>"},{"location":"SPRINT1_README/#desenvolvimento-24h-estimadas","title":"Desenvolvimento (24h estimadas)","text":""},{"location":"SPRINT1_README/#1-criar-scriptsutilsloggerpy-4h","title":"1. Criar <code>scripts/utils/logger.py</code> (4h)","text":"<ul> <li>[ ] Implementar <code>StdoutFilter</code></li> <li>[ ] Implementar <code>InfoHandler</code> e <code>ErrorHandler</code></li> <li>[ ] Implementar <code>TerminalColors</code> com detec\u00e7\u00e3o de terminal</li> <li>[ ] Implementar <code>setup_logging()</code></li> <li>[ ] Escrever docstrings completas</li> </ul>"},{"location":"SPRINT1_README/#2-testes-unitarios-2h","title":"2. Testes Unit\u00e1rios (2h)","text":"<ul> <li>[ ] Testar separa\u00e7\u00e3o de streams</li> <li>[ ] Testar detec\u00e7\u00e3o de terminal (<code>isatty</code>)</li> <li>[ ] Testar vari\u00e1vel <code>NO_COLOR</code></li> <li>[ ] Testar em ambiente CI mockado</li> <li>[ ] Cobertura m\u00ednima: 90%</li> </ul>"},{"location":"SPRINT1_README/#3-refatorar-doctorpy-6h","title":"3. Refatorar <code>doctor.py</code> (6h)","text":"<ul> <li>[ ] Implementar <code>_compare_versions()</code> com l\u00f3gica flex\u00edvel</li> <li>[ ] Adicionar par\u00e2metro <code>--strict-version-check</code></li> <li>[ ] Migrar para <code>setup_logging()</code></li> <li>[ ] Migrar para <code>get_colors()</code></li> <li>[ ] Atualizar testes do doctor</li> <li>[ ] Validar em ambiente local e CI</li> </ul>"},{"location":"SPRINT1_README/#4-migrar-scripts-criticos-8h","title":"4. Migrar Scripts Cr\u00edticos (8h)","text":"<ul> <li>[ ] Migrar <code>scripts/code_audit.py</code></li> <li>[ ] Migrar <code>scripts/smart_git_sync.py</code></li> <li>[ ] Migrar <code>scripts/audit_dashboard/cli.py</code></li> <li>[ ] Migrar <code>scripts/ci_recovery/main.py</code></li> <li>[ ] Migrar <code>scripts/maintain_versions.py</code></li> <li>[ ] Migrar demais scripts (validate, install_dev, etc)</li> <li>[ ] Rodar testes de integra\u00e7\u00e3o</li> </ul>"},{"location":"SPRINT1_README/#5-documentacao-e-validacao-4h","title":"5. Documenta\u00e7\u00e3o e Valida\u00e7\u00e3o (4h)","text":"<ul> <li>[ ] Atualizar docstrings dos scripts migrados</li> <li>[ ] Executar auditoria completa (<code>make audit</code>)</li> <li>[ ] Executar testes completos (<code>make test</code>)</li> <li>[ ] Validar em m\u00faltiplas vers\u00f5es Python (3.10, 3.11, 3.12)</li> <li>[ ] Validar comportamento em CI</li> <li>[ ] Code review</li> <li>[ ] Merge para main</li> </ul>"},{"location":"SPRINT1_README/#referencias-externas","title":"\ud83d\udcda Refer\u00eancias Externas","text":""},{"location":"SPRINT1_README/#padroes-e-convencoes","title":"Padr\u00f5es e Conven\u00e7\u00f5es","text":"<ul> <li>POSIX Standard - stdout/stderr</li> <li>Python Logging Cookbook</li> <li>NO_COLOR Standard</li> </ul>"},{"location":"SPRINT1_README/#github-actions","title":"GitHub Actions","text":"<ul> <li>Workflow Commands</li> <li>Environment Variables</li> </ul>"},{"location":"SPRINT1_README/#python-version-management","title":"Python Version Management","text":"<ul> <li>PEP 440 - Version Identification</li> <li>Semantic Versioning</li> </ul>"},{"location":"SPRINT1_README/#contribuindo","title":"\ud83e\udd1d Contribuindo","text":""},{"location":"SPRINT1_README/#encontrou-um-problema-na-documentacao","title":"Encontrou um problema na documenta\u00e7\u00e3o?","text":"<ol> <li>Abra uma issue no reposit\u00f3rio</li> <li>Use o template \"Documentation Issue\"</li> <li>Referencie o documento espec\u00edfico e se\u00e7\u00e3o</li> </ol>"},{"location":"SPRINT1_README/#quer-propor-melhorias","title":"Quer propor melhorias?","text":"<ol> <li>Leia o CONTRIBUTING.md</li> <li>Crie uma branch: <code>feature/sprint1-improvements</code></li> <li>Envie um PR com suas sugest\u00f5es</li> </ol>"},{"location":"SPRINT1_README/#contatos","title":"\ud83d\udcde Contatos","text":"<p>Respons\u00e1vel pela Sprint 1: DevOps Engineering Team Status: Fase 01 Completa - Aguardando aprova\u00e7\u00e3o para Fase 02</p>"},{"location":"SPRINT1_README/#historico-de-versoes","title":"\ud83d\uddc2\ufe0f Hist\u00f3rico de Vers\u00f5es","text":"Vers\u00e3o Data Mudan\u00e7as 1.0.0 2025-11-29 Cria\u00e7\u00e3o inicial da documenta\u00e7\u00e3o - Fase 01 completa <p>\u00daltima Atualiza\u00e7\u00e3o: 29 de Novembro de 2025</p>"},{"location":"guides/testing/","title":"\ud83e\uddea Guia de Testes (SRE Standard)","text":"<p>Este projeto adota uma filosofia estrita de Testes Unit\u00e1rios Isolados. O objetivo \u00e9 garantir que a su\u00edte de testes seja r\u00e1pida (&lt; 50ms), determin\u00edstica e segura (sem efeitos colaterais).</p>"},{"location":"guides/testing/#o-que-nao-fazer-anti-patterns","title":"\ud83d\udeab O Que N\u00e3o Fazer (Anti-Patterns)","text":"<ol> <li>Nunca toque no disco real: N\u00e3o use <code>os.mkdir</code>, <code>open(\"arquivo_real\")</code> ou <code>tempfile.mkdtemp</code>.</li> <li>Nunca execute comandos reais: N\u00e3o chame <code>subprocess.run([\"git\", ...])</code> sem mock.</li> <li>Nunca dependa de estado externo: N\u00e3o assuma que o usu\u00e1rio tem Git instalado ou configurado.</li> </ol>"},{"location":"guides/testing/#como-escrever-testes-the-right-way","title":"\u2705 Como Escrever Testes (The Right Way)","text":"<p>Usamos <code>unittest.mock</code> intensivamente.</p>"},{"location":"guides/testing/#exemplo-mockando-arquivos-e-comandos","title":"Exemplo: Mockando Arquivos e Comandos","text":"<pre><code>from unittest.mock import MagicMock, patch\nfrom pathlib import Path\n\n# 1. Patch no subprocess (Blindagem)\n@patch(\"scripts.git_sync.sync_logic.subprocess.run\")\n# 2. Patch no Path (Filesystem Virtual)\n@patch(\"scripts.git_sync.sync_logic.Path\")\ndef test_exemplo_seguro(self, mock_path, mock_run):\n\n    # Configurar o Mock do Filesystem\n    mock_path.return_value.exists.return_value = True\n\n    # Configurar o Mock do Comando\n    mock_run.return_value.returncode = 0\n\n    # Executar (O c\u00f3digo acha que est\u00e1 tocando no disco, mas n\u00e3o est\u00e1)\n    resultado = minha_funcao_perigosa()\n\n    # Validar\n    assert resultado == True\n</code></pre> <p>Consulte <code>tests/test_smart_git_sync.py</code> para exemplos avan\u00e7ados de mocks em cadeia.</p>"},{"location":"reference/git_sync/","title":"Git Sync - Refer\u00eancia da API","text":"<p>Sincroniza\u00e7\u00e3o Git inteligente com sistema de auditoria preventiva</p>"},{"location":"reference/git_sync/#visao-geral","title":"Vis\u00e3o Geral","text":"<p>O m\u00f3dulo <code>scripts.git_sync</code> fornece funcionalidades empresariais para sincroniza\u00e7\u00e3o Git automatizada com capacidades de auditoria preventiva.</p>"},{"location":"reference/git_sync/#classes-principais","title":"Classes Principais","text":""},{"location":"reference/git_sync/#scripts.git_sync.sync_logic.SyncOrchestrator","title":"<code>scripts.git_sync.sync_logic.SyncOrchestrator</code>","text":"<p>Enterprise-grade Git synchronization with preventive audit capabilities.</p> <p>Implements idempotent operations, comprehensive error handling, and structured logging for production-grade automation.</p> Source code in <code>scripts/git_sync/sync_logic.py</code> <pre><code>class SyncOrchestrator:\n    \"\"\"Enterprise-grade Git synchronization with preventive audit capabilities.\n\n    Implements idempotent operations, comprehensive error handling,\n    and structured logging for production-grade automation.\n    \"\"\"\n\n    def __init__(\n        self,\n        workspace_root: Path,\n        config: dict[str, Any],\n        *,\n        dry_run: bool = False,\n    ) -&gt; None:\n        \"\"\"Initialize the synchronization manager.\"\"\"\n        self.workspace_root = workspace_root.resolve()\n        self.config = config\n        self.dry_run = dry_run\n        self.steps: list[SyncStep] = []\n        self.sync_id = datetime.now(timezone.utc).strftime(\"%Y%m%d_%H%M%S\")\n        self.start_time = datetime.now(timezone.utc)\n\n        # Validate workspace is a Git repository\n        self._validate_git_repository()\n\n        logger.info(\"Initialized SyncOrchestrator (ID: %s)\", self.sync_id)\n        logger.info(\"Workspace: %s\", self.workspace_root)\n        logger.info(\"Dry run mode: %s\", self.dry_run)\n\n    def _validate_git_repository(self) -&gt; None:\n        \"\"\"Validate that workspace is a Git repository.\"\"\"\n        git_dir = self.workspace_root / \".git\"\n        if not git_dir.exists():\n            raise SyncError(f\"Not a Git repository: {self.workspace_root}\")\n\n    def _update_heartbeat(self, status: str) -&gt; None:\n        \"\"\"Update heartbeat file with current sync state.\n\n        Args:\n            status: Current status ('running', 'success', 'failed', 'crashed')\n\n        Note:\n            Failures in heartbeat updates are logged but do not interrupt sync.\n            The heartbeat is telemetry, not critical business logic.\n\n        \"\"\"\n        try:\n            heartbeat_path = self.workspace_root / \".git\" / \"sync_heartbeat\"\n\n            # Calculate duration since sync start\n            current_time = datetime.now(timezone.utc)\n            duration_seconds = (current_time - self.start_time).total_seconds()\n\n            # Get current branch if possible\n            try:\n                branch_result = self._run_command(\n                    [\"git\", \"branch\", \"--show-current\"],\n                    timeout=5,\n                    check=False,\n                )\n                if branch_result.returncode == 0:\n                    current_branch = branch_result.stdout.strip()\n                else:\n                    current_branch = \"unknown\"\n            except GitOperationError:\n                current_branch = \"unknown\"\n\n            # Build heartbeat data\n            heartbeat_data = {\n                \"sync_id\": self.sync_id,\n                \"status\": status,\n                \"timestamp\": current_time.isoformat(),\n                \"workspace\": str(self.workspace_root),\n                \"branch\": current_branch,\n                \"duration_seconds\": round(duration_seconds, 2),\n                \"phases_completed\": len(\n                    [s for s in self.steps if s.status == \"success\"],\n                ),\n                \"pid\": os.getpid(),\n            }\n\n            # Atomic write with fsync (POSIX compliant)\n            atomic_write_json(heartbeat_path, heartbeat_data, fsync=True)\n\n            logger.debug(\"Heartbeat updated: %s (status=%s)\", heartbeat_path, status)\n\n        except (OSError, GitOperationError) as e:\n            # Heartbeat failures are non-critical - log and continue\n            logger.warning(\"Failed to update heartbeat: %s\", e)\n\n    def _run_command(\n        self,\n        command: list[str],\n        timeout: int = 300,\n        capture_output: bool = True,\n        check: bool = True,\n        env: dict[str, str] | None = None,\n    ) -&gt; subprocess.CompletedProcess[str]:\n        \"\"\"Execute command with security best practices.\n\n        Args:\n            command: Command as list (never uses shell=True)  # noqa: subprocess\n            timeout: Command timeout in seconds\n            capture_output: Whether to capture stdout/stderr\n            check: Whether to raise on non-zero exit\n            env: Optional environment variables\n\n        Returns:\n            CompletedProcess instance\n\n        Raises:\n            GitOperationError: On command execution failure\n\n        \"\"\"\n        if self.dry_run:\n            logger.info(\"[DRY RUN] Would execute: %s\", \" \".join(command))\n            return subprocess.CompletedProcess(\n                args=command,\n                returncode=0,\n                stdout=\"[DRY RUN]\",\n                stderr=\"\",\n            )\n\n        try:\n            # Ensure we never use shell=True for security\n            env_vars = {**os.environ}\n            if env:\n                env_vars.update(env)\n\n            result = subprocess.run(  # nosec # noqa: subprocess\n                command,\n                cwd=self.workspace_root,\n                timeout=timeout,\n                capture_output=capture_output,\n                text=True,\n                check=check,\n                env=env_vars,\n            )\n\n            cmd_str = \" \".join(command)\n            debug_msg = f\"Command executed: {cmd_str} (exit code: {result.returncode})\"\n            logger.debug(debug_msg)\n            return result\n\n        except subprocess.CalledProcessError as e:\n            error_msg = (\n                f\"Command failed: {' '.join(command)} (exit code: {e.returncode})\"\n            )\n            if e.stderr:\n                error_msg += f\" - {e.stderr.strip()}\"\n            raise GitOperationError(error_msg) from e\n        except subprocess.TimeoutExpired as e:\n            error_msg = f\"Command timed out after {timeout}s: {' '.join(command)}\"\n            raise GitOperationError(error_msg) from e\n\n    def _check_git_status(self) -&gt; dict[str, Any]:\n        \"\"\"Check Git repository status.\"\"\"\n        step = SyncStep(\"git_status\", \"Checking Git repository status\")\n        step.start()\n        self.steps.append(step)\n\n        try:\n            # Check for uncommitted changes\n            result = self._run_command([\"git\", \"status\", \"--porcelain\"])\n            changed_files = [\n                line.strip()\n                for line in result.stdout.strip().split(\"\\n\")\n                if line.strip()\n            ]\n\n            # Check current branch\n            branch_result = self._run_command([\"git\", \"branch\", \"--show-current\"])\n            current_branch = branch_result.stdout.strip()\n\n            # Check if repository is clean\n            is_clean = len(changed_files) == 0\n\n            status_info = {\n                \"is_clean\": is_clean,\n                \"changed_files\": changed_files,\n                \"total_changes\": len(changed_files),\n                \"current_branch\": current_branch,\n            }\n\n            step.complete(status_info)\n            return status_info\n\n        except GitOperationError as e:\n            step.fail(str(e))\n            raise\n\n    def _run_code_audit(self) -&gt; dict[str, Any]:\n        \"\"\"Execute comprehensive code audit.\"\"\"\n        step = SyncStep(\"code_audit\", \"Running preventive code audit\")\n        step.start()\n        self.steps.append(step)\n\n        try:\n            # Check if audit script exists\n            audit_script = self.workspace_root / \"scripts\" / \"code_audit.py\"\n            if not audit_script.exists():\n                logger.warning(\"Code audit script not found, skipping audit\")\n                step.complete({\"status\": \"skipped\", \"reason\": \"audit_script_not_found\"})\n                return {\"passed\": True, \"status\": \"skipped\"}\n\n            # Execute audit with CI simulation\n            audit_command = [\n                sys.executable,\n                str(audit_script),\n                \"--output\",\n                \"json\",\n                \"--fail-on\",\n                self.config.get(\"audit_fail_threshold\", \"HIGH\"),\n            ]\n\n            result = self._run_command(\n                audit_command,\n                timeout=self.config.get(\"audit_timeout\", 300),\n                check=False,  # Don't raise on non-zero exit, we'll handle it\n            )\n\n            audit_passed = result.returncode == 0\n            audit_details = {\n                \"passed\": audit_passed,\n                \"exit_code\": result.returncode,\n                \"stdout\": result.stdout,\n                \"stderr\": result.stderr,\n            }\n\n            if audit_passed:\n                step.complete(audit_details)\n            else:\n                step.fail(\"Code audit failed\", audit_details)\n                if self.config.get(\"strict_audit\", True):\n                    raise AuditError(\n                        f\"Code audit failed with exit code {result.returncode}\",\n                    )\n\n            return audit_details\n\n        except (GitOperationError, AuditError) as e:\n            step.fail(str(e))\n            raise\n\n    def _apply_lint_fixes(self) -&gt; dict[str, Any]:\n        \"\"\"Apply automated lint fixes if available.\"\"\"\n        step = SyncStep(\"lint_fixes\", \"Applying automated lint fixes\")\n        step.start()\n        self.steps.append(step)\n\n        try:\n            # Check if lint fix script exists\n            lint_script = self.workspace_root / \"scripts\" / \"lint_fix.py\"\n            if not lint_script.exists():\n                step.complete({\"status\": \"skipped\", \"reason\": \"lint_script_not_found\"})\n                return {\"fixes_applied\": 0, \"status\": \"skipped\"}\n\n            # Execute lint fixes\n            lint_command = [sys.executable, str(lint_script), \"--auto-fix\"]\n\n            result = self._run_command(\n                lint_command,\n                timeout=self.config.get(\"lint_timeout\", 180),\n                check=False,\n            )\n\n            fixes_applied = 0\n            # Parse output to count fixes (implementation depends on lint_fix.py format)\n            if \"fixes applied\" in result.stdout.lower():\n                # Extract number from output\n                match = re.search(r\"(\\d+)\\s+fixes?\\s+applied\", result.stdout.lower())\n                if match:\n                    fixes_applied = int(match.group(1))\n\n            fix_details = {\n                \"fixes_applied\": fixes_applied,\n                \"exit_code\": result.returncode,\n                \"stdout\": result.stdout,\n                \"stderr\": result.stderr,\n            }\n\n            step.complete(fix_details)\n            return fix_details\n\n        except GitOperationError as e:\n            step.fail(str(e))\n            raise\n\n    def _generate_smart_commit_message(self, git_status: dict[str, Any]) -&gt; str:\n        \"\"\"Generate intelligent commit message based on changes.\"\"\"\n        changed_files = git_status.get(\"changed_files\", [])\n\n        # Analyze file types and changes\n        categories: dict[str, list[str]] = {\n            \"feat\": [],\n            \"fix\": [],\n            \"test\": [],\n            \"docs\": [],\n            \"chore\": [],\n            \"style\": [],\n            \"refactor\": [],\n        }\n\n        for file_change in changed_files:\n            # Parse Git status format (e.g., \"M  file.py\", \"A  newfile.py\")\n            if len(file_change) &lt; 3:\n                continue\n\n            status_code = file_change[0]  # M, A, D, etc.\n            filepath = file_change[3:]  # Skip status codes and space\n\n            # Categorize by path and content\n            if \"test\" in filepath.lower():\n                categories[\"test\"].append(filepath)\n            elif filepath.endswith(\".md\") or \"doc\" in filepath.lower():\n                categories[\"docs\"].append(filepath)\n            elif filepath.startswith(\"src/\") or filepath.endswith(\".py\"):\n                if status_code == \"A\":  # New file\n                    categories[\"feat\"].append(filepath)\n                else:\n                    categories[\"fix\"].append(filepath)  # Modified existing\n            elif \"script\" in filepath or filepath.startswith(\"scripts/\"):\n                categories[\"chore\"].append(filepath)\n            else:\n                categories[\"chore\"].append(filepath)\n\n        # Determine primary category\n        primary_category = \"chore\"  # Default\n        max_count = 0\n\n        for category, files in categories.items():\n            if len(files) &gt; max_count:\n                max_count = len(files)\n                primary_category = category\n\n        # Generate message\n        total_files = len(changed_files)\n        message_parts = [f\"{primary_category}: smart sync with preventive audit\"]\n\n        if total_files &gt; 0:\n            message_parts.append(f\"({total_files} files)\")\n\n        # Add fix information if available\n        if hasattr(self, \"_last_audit_result\"):\n            audit_result = getattr(self, \"_last_audit_result\", {})\n            if not audit_result.get(\"passed\", True):\n                message_parts.append(\"[audit-fixes]\")\n\n        return \" \".join(message_parts)\n\n    def _commit_and_push(self, git_status: dict[str, Any]) -&gt; dict[str, Any]:\n        \"\"\"Perform Git commit and push operations.\"\"\"\n        if git_status[\"is_clean\"]:\n            logger.info(\"Repository is clean, nothing to commit\")\n            return {\"status\": \"clean\", \"committed\": False}\n\n        # Add files to staging\n        add_step = SyncStep(\"git_add\", \"Adding files to Git staging area\")\n        add_step.start()\n        self.steps.append(add_step)\n\n        try:\n            # Use git add . but exclude sensitive files\n            self._run_command([\"git\", \"add\", \".\"])\n            add_step.complete({\"files_added\": len(git_status[\"changed_files\"])})\n\n        except GitOperationError as e:\n            add_step.fail(str(e))\n            raise\n\n        # Commit changes\n        commit_step = SyncStep(\"git_commit\", \"Creating Git commit\")\n        commit_step.start()\n        self.steps.append(commit_step)\n\n        try:\n            commit_message = self._generate_smart_commit_message(git_status)\n            self._run_command([\"git\", \"commit\", \"-m\", commit_message])\n\n            # Get commit hash\n            hash_result = self._run_command([\"git\", \"rev-parse\", \"HEAD\"])\n            commit_hash = hash_result.stdout.strip()\n\n            commit_details = {\n                \"message\": commit_message,\n                \"hash\": commit_hash,\n                \"files_committed\": len(git_status[\"changed_files\"]),\n            }\n\n            commit_step.complete(commit_details)\n\n        except GitOperationError as e:\n            commit_step.fail(str(e))\n            raise\n\n        # Push to remote\n        push_step = SyncStep(\"git_push\", \"Pushing to remote repository\")\n        push_step.start()\n        self.steps.append(push_step)\n\n        try:\n            # Get current branch for push\n            current_branch = git_status[\"current_branch\"]\n            self._run_command([\"git\", \"push\", \"origin\", current_branch])\n\n            push_details = {\n                \"branch\": current_branch,\n                \"commit_hash\": commit_hash,\n            }\n\n            push_step.complete(push_details)\n\n            return {\n                \"status\": \"success\",\n                \"committed\": True,\n                \"commit\": commit_details,\n                \"push\": push_details,\n            }\n\n        except GitOperationError as e:\n            push_step.fail(str(e))\n\n            # Rollback commit if push fails\n            logger.warning(\"Push failed, attempting to rollback commit\")\n            try:\n                self._run_command([\"git\", \"reset\", \"--soft\", \"HEAD~1\"])\n                logger.info(\"Successfully rolled back commit\")\n            except GitOperationError as rollback_error:\n                logger.error(\"Rollback failed: %s\", rollback_error)\n\n            raise\n\n    def _cleanup_repository(self) -&gt; None:\n        \"\"\"Perform repository cleanup operations.\"\"\"\n        cleanup_step = SyncStep(\"git_cleanup\", \"Cleaning up repository\")\n        cleanup_step.start()\n        self.steps.append(cleanup_step)\n\n        try:\n            cleanup_commands = [\n                [\"git\", \"gc\", \"--auto\"],\n                [\"git\", \"remote\", \"prune\", \"origin\"],\n            ]\n\n            cleanup_results = []\n            for cmd in cleanup_commands:\n                try:\n                    result = self._run_command(cmd, timeout=60, check=False)\n                    cleanup_results.append(\n                        {\n                            \"command\": \" \".join(cmd),\n                            \"success\": result.returncode == 0,\n                        },\n                    )\n                except GitOperationError:\n                    cleanup_results.append(\n                        {\n                            \"command\": \" \".join(cmd),\n                            \"success\": False,\n                        },\n                    )\n\n            cleanup_step.complete({\"operations\": cleanup_results})\n\n        except Exception as e:\n            cleanup_step.fail(str(e))\n            # Don't raise - cleanup failures are not critical\n\n    def _save_sync_report(self) -&gt; Path:\n        \"\"\"Save synchronization report to file.\"\"\"\n        report = {\n            \"metadata\": {\n                \"sync_id\": self.sync_id,\n                \"timestamp\": datetime.now(timezone.utc).isoformat(),\n                \"workspace\": str(self.workspace_root),\n                \"dry_run\": self.dry_run,\n                \"config\": self.config,\n            },\n            \"steps\": [step.to_dict() for step in self.steps],\n            \"summary\": {\n                \"total_steps\": len(self.steps),\n                \"successful_steps\": len(\n                    [s for s in self.steps if s.status == \"success\"],\n                ),\n                \"failed_steps\": len([s for s in self.steps if s.status == \"failed\"]),\n                \"total_duration\": sum(step._get_duration() for step in self.steps),\n            },\n        }\n\n        report_file = self.workspace_root / f\"sync_report_{self.sync_id}.json\"\n\n        try:\n            with report_file.open(\"w\", encoding=\"utf-8\") as f:\n                json.dump(report, f, indent=2, ensure_ascii=False)\n\n            logger.info(\"Sync report saved: %s\", report_file)\n            return report_file\n\n        except Exception as e:\n            logger.error(\"Failed to save sync report: %s\", e)\n            raise\n\n    def execute_sync(self) -&gt; bool:\n        \"\"\"Execute complete smart synchronization workflow.\n\n        Returns:\n            True if synchronization completed successfully, False otherwise.\n\n        \"\"\"\n        logger.info(\"\ud83d\ude80 Starting Smart Git Synchronization\")\n        logger.info(\"=\" * 60)\n\n        # Update heartbeat: sync started\n        self._update_heartbeat(\"running\")\n\n        try:\n            # Phase 1: Repository Status Check\n            logger.info(\"\ud83d\udccb PHASE 1: Repository Status Analysis\")\n            git_status = self._check_git_status()\n\n            # Protection: prevent direct push to main\n            current_branch = git_status.get(\"current_branch\")\n            if current_branch == \"main\":\n                logger.error(\"\ud83d\uded1 OPERA\u00c7\u00c3O PROIBIDA NA 'main'\")\n                logger.error(\"A branch 'main' est\u00e1 protegida por regras ('Cofre').\")\n                logger.error(\"Este script n\u00e3o pode fazer 'push' direto na 'main'.\")\n                logger.warning(\n                    \"Use o 'Fluxo de Trabalho (Chave Mestra)': Crie um branch, \"\n                    \"abra um PR e solicite um 'Bypass' do administrador.\",\n                )\n                raise SyncError(\"Tentativa de 'push' direto na 'main' protegida.\")\n\n            if git_status[\"is_clean\"]:\n                logger.info(\"Repository is clean, no changes to sync\")\n                self._save_sync_report()\n                return True\n\n            logger.info(\"Found %d changes to process\", git_status[\"total_changes\"])\n\n            # Phase 2: Code Quality and Security Audit\n            logger.info(\"\ud83d\udd0d PHASE 2: Preventive Code Audit\")\n            audit_result = self._run_code_audit()\n            self._last_audit_result = audit_result  # Store for commit message\n\n            # Phase 3: Automated Fixes (if audit found issues)\n            if not audit_result.get(\"passed\", True) and self.config.get(\n                \"auto_fix_enabled\",\n                True,\n            ):\n                logger.info(\"\ud83d\udd27 PHASE 3: Automated Lint Fixes\")\n                fix_result = self._apply_lint_fixes()\n                logger.info(\n                    \"Applied %d automated fixes\",\n                    fix_result.get(\"fixes_applied\", 0),\n                )\n\n            # Phase 4: Git Operations\n            logger.info(\"\ud83d\udce4 PHASE 4: Git Commit and Push\")\n            git_result = self._commit_and_push(git_status)\n\n            # Phase 5: Cleanup\n            if self.config.get(\"cleanup_enabled\", True):\n                logger.info(\"\ud83e\uddf9 PHASE 5: Repository Cleanup\")\n                self._cleanup_repository()\n\n            # Save report and finalize\n            self._save_sync_report()\n\n            logger.info(\"=\" * 60)\n            logger.info(\"\u2705 Smart Git Synchronization completed successfully!\")\n\n            if git_result.get(\"committed\"):\n                commit_hash = git_result.get(\"commit\", {}).get(\"hash\", \"unknown\")\n                logger.info(\"\ud83d\udce6 Commit: %s\", commit_hash[:8])\n                logger.info(\"\ud83c\udf33 Branch: %s\", git_status[\"current_branch\"])\n\n            # Update heartbeat: sync successful\n            self._update_heartbeat(\"success\")\n\n            return True\n\n        except (SyncError, GitOperationError, AuditError) as e:\n            logger.error(\"Synchronization failed: %s\", e)\n            self._update_heartbeat(\"failed\")\n            self._save_sync_report()\n            return False\n\n        except Exception as e:\n            logger.critical(\"UNEXPECTED BUG: %s\", e, exc_info=True)\n            self._update_heartbeat(\"crashed\")\n            self._save_sync_report()\n            raise\n</code></pre>"},{"location":"reference/git_sync/#scripts.git_sync.sync_logic.SyncOrchestrator.__init__","title":"<code>__init__(workspace_root, config, *, dry_run=False)</code>","text":"<p>Initialize the synchronization manager.</p> Source code in <code>scripts/git_sync/sync_logic.py</code> <pre><code>def __init__(\n    self,\n    workspace_root: Path,\n    config: dict[str, Any],\n    *,\n    dry_run: bool = False,\n) -&gt; None:\n    \"\"\"Initialize the synchronization manager.\"\"\"\n    self.workspace_root = workspace_root.resolve()\n    self.config = config\n    self.dry_run = dry_run\n    self.steps: list[SyncStep] = []\n    self.sync_id = datetime.now(timezone.utc).strftime(\"%Y%m%d_%H%M%S\")\n    self.start_time = datetime.now(timezone.utc)\n\n    # Validate workspace is a Git repository\n    self._validate_git_repository()\n\n    logger.info(\"Initialized SyncOrchestrator (ID: %s)\", self.sync_id)\n    logger.info(\"Workspace: %s\", self.workspace_root)\n    logger.info(\"Dry run mode: %s\", self.dry_run)\n</code></pre>"},{"location":"reference/git_sync/#scripts.git_sync.sync_logic.SyncOrchestrator.execute_sync","title":"<code>execute_sync()</code>","text":"<p>Execute complete smart synchronization workflow.</p> <p>Returns:</p> Type Description <code>bool</code> <p>True if synchronization completed successfully, False otherwise.</p> Source code in <code>scripts/git_sync/sync_logic.py</code> <pre><code>def execute_sync(self) -&gt; bool:\n    \"\"\"Execute complete smart synchronization workflow.\n\n    Returns:\n        True if synchronization completed successfully, False otherwise.\n\n    \"\"\"\n    logger.info(\"\ud83d\ude80 Starting Smart Git Synchronization\")\n    logger.info(\"=\" * 60)\n\n    # Update heartbeat: sync started\n    self._update_heartbeat(\"running\")\n\n    try:\n        # Phase 1: Repository Status Check\n        logger.info(\"\ud83d\udccb PHASE 1: Repository Status Analysis\")\n        git_status = self._check_git_status()\n\n        # Protection: prevent direct push to main\n        current_branch = git_status.get(\"current_branch\")\n        if current_branch == \"main\":\n            logger.error(\"\ud83d\uded1 OPERA\u00c7\u00c3O PROIBIDA NA 'main'\")\n            logger.error(\"A branch 'main' est\u00e1 protegida por regras ('Cofre').\")\n            logger.error(\"Este script n\u00e3o pode fazer 'push' direto na 'main'.\")\n            logger.warning(\n                \"Use o 'Fluxo de Trabalho (Chave Mestra)': Crie um branch, \"\n                \"abra um PR e solicite um 'Bypass' do administrador.\",\n            )\n            raise SyncError(\"Tentativa de 'push' direto na 'main' protegida.\")\n\n        if git_status[\"is_clean\"]:\n            logger.info(\"Repository is clean, no changes to sync\")\n            self._save_sync_report()\n            return True\n\n        logger.info(\"Found %d changes to process\", git_status[\"total_changes\"])\n\n        # Phase 2: Code Quality and Security Audit\n        logger.info(\"\ud83d\udd0d PHASE 2: Preventive Code Audit\")\n        audit_result = self._run_code_audit()\n        self._last_audit_result = audit_result  # Store for commit message\n\n        # Phase 3: Automated Fixes (if audit found issues)\n        if not audit_result.get(\"passed\", True) and self.config.get(\n            \"auto_fix_enabled\",\n            True,\n        ):\n            logger.info(\"\ud83d\udd27 PHASE 3: Automated Lint Fixes\")\n            fix_result = self._apply_lint_fixes()\n            logger.info(\n                \"Applied %d automated fixes\",\n                fix_result.get(\"fixes_applied\", 0),\n            )\n\n        # Phase 4: Git Operations\n        logger.info(\"\ud83d\udce4 PHASE 4: Git Commit and Push\")\n        git_result = self._commit_and_push(git_status)\n\n        # Phase 5: Cleanup\n        if self.config.get(\"cleanup_enabled\", True):\n            logger.info(\"\ud83e\uddf9 PHASE 5: Repository Cleanup\")\n            self._cleanup_repository()\n\n        # Save report and finalize\n        self._save_sync_report()\n\n        logger.info(\"=\" * 60)\n        logger.info(\"\u2705 Smart Git Synchronization completed successfully!\")\n\n        if git_result.get(\"committed\"):\n            commit_hash = git_result.get(\"commit\", {}).get(\"hash\", \"unknown\")\n            logger.info(\"\ud83d\udce6 Commit: %s\", commit_hash[:8])\n            logger.info(\"\ud83c\udf33 Branch: %s\", git_status[\"current_branch\"])\n\n        # Update heartbeat: sync successful\n        self._update_heartbeat(\"success\")\n\n        return True\n\n    except (SyncError, GitOperationError, AuditError) as e:\n        logger.error(\"Synchronization failed: %s\", e)\n        self._update_heartbeat(\"failed\")\n        self._save_sync_report()\n        return False\n\n    except Exception as e:\n        logger.critical(\"UNEXPECTED BUG: %s\", e, exc_info=True)\n        self._update_heartbeat(\"crashed\")\n        self._save_sync_report()\n        raise\n</code></pre>"},{"location":"reference/git_sync/#modelos-de-dados","title":"Modelos de Dados","text":""},{"location":"reference/git_sync/#scripts.git_sync.models","title":"<code>scripts.git_sync.models</code>","text":"<p>Data models for the Git synchronization system.</p>"},{"location":"reference/git_sync/#scripts.git_sync.models.SyncStep","title":"<code>SyncStep</code>","text":"<p>Represents a single synchronization step with metadata.</p> Source code in <code>scripts/git_sync/models.py</code> <pre><code>class SyncStep:\n    \"\"\"Represents a single synchronization step with metadata.\"\"\"\n\n    def __init__(self, name: str, description: str) -&gt; None:\n        \"\"\"Initialize a sync step with name and description.\"\"\"\n        self.name = name\n        self.description = description\n        self.start_time: datetime | None = None\n        self.end_time: datetime | None = None\n        self.status: str = \"pending\"\n        self.error: str | None = None\n        self.details: dict[str, Any] = {}\n\n    def start(self) -&gt; None:\n        \"\"\"Mark step as started.\"\"\"\n        self.start_time = datetime.now(timezone.utc)\n        self.status = \"running\"\n        logger.info(\"\ud83d\udd04 Starting: %s - %s\", self.name, self.description)\n\n    def complete(self, details: dict[str, Any] | None = None) -&gt; None:\n        \"\"\"Mark step as completed successfully.\"\"\"\n        self.end_time = datetime.now(timezone.utc)\n        self.status = \"success\"\n        if details:\n            self.details.update(details)\n\n        duration = self._get_duration()\n        logger.info(\"\u2705 Completed: %s (%.2fs)\", self.name, duration)\n\n    def fail(self, error: str, details: dict[str, Any] | None = None) -&gt; None:\n        \"\"\"Mark step as failed.\"\"\"\n        self.end_time = datetime.now(timezone.utc)\n        self.status = \"failed\"\n        self.error = error\n        if details:\n            self.details.update(details)\n\n        duration = self._get_duration()\n        logger.error(\"\u274c Failed: %s (%.2fs) - %s\", self.name, duration, error)\n\n    def _get_duration(self) -&gt; float:\n        \"\"\"Calculate step duration in seconds.\"\"\"\n        if self.start_time and self.end_time:\n            return (self.end_time - self.start_time).total_seconds()\n        return 0.0\n\n    def to_dict(self) -&gt; dict[str, Any]:\n        \"\"\"Convert step to dictionary for serialization.\"\"\"\n        return {\n            \"name\": self.name,\n            \"description\": self.description,\n            \"status\": self.status,\n            \"start_time\": self.start_time.isoformat() if self.start_time else None,\n            \"end_time\": self.end_time.isoformat() if self.end_time else None,\n            \"duration\": self._get_duration(),\n            \"error\": self.error,\n            \"details\": self.details,\n        }\n</code></pre>"},{"location":"reference/git_sync/#scripts.git_sync.models.SyncStep.__init__","title":"<code>__init__(name, description)</code>","text":"<p>Initialize a sync step with name and description.</p> Source code in <code>scripts/git_sync/models.py</code> <pre><code>def __init__(self, name: str, description: str) -&gt; None:\n    \"\"\"Initialize a sync step with name and description.\"\"\"\n    self.name = name\n    self.description = description\n    self.start_time: datetime | None = None\n    self.end_time: datetime | None = None\n    self.status: str = \"pending\"\n    self.error: str | None = None\n    self.details: dict[str, Any] = {}\n</code></pre>"},{"location":"reference/git_sync/#scripts.git_sync.models.SyncStep.complete","title":"<code>complete(details=None)</code>","text":"<p>Mark step as completed successfully.</p> Source code in <code>scripts/git_sync/models.py</code> <pre><code>def complete(self, details: dict[str, Any] | None = None) -&gt; None:\n    \"\"\"Mark step as completed successfully.\"\"\"\n    self.end_time = datetime.now(timezone.utc)\n    self.status = \"success\"\n    if details:\n        self.details.update(details)\n\n    duration = self._get_duration()\n    logger.info(\"\u2705 Completed: %s (%.2fs)\", self.name, duration)\n</code></pre>"},{"location":"reference/git_sync/#scripts.git_sync.models.SyncStep.fail","title":"<code>fail(error, details=None)</code>","text":"<p>Mark step as failed.</p> Source code in <code>scripts/git_sync/models.py</code> <pre><code>def fail(self, error: str, details: dict[str, Any] | None = None) -&gt; None:\n    \"\"\"Mark step as failed.\"\"\"\n    self.end_time = datetime.now(timezone.utc)\n    self.status = \"failed\"\n    self.error = error\n    if details:\n        self.details.update(details)\n\n    duration = self._get_duration()\n    logger.error(\"\u274c Failed: %s (%.2fs) - %s\", self.name, duration, error)\n</code></pre>"},{"location":"reference/git_sync/#scripts.git_sync.models.SyncStep.start","title":"<code>start()</code>","text":"<p>Mark step as started.</p> Source code in <code>scripts/git_sync/models.py</code> <pre><code>def start(self) -&gt; None:\n    \"\"\"Mark step as started.\"\"\"\n    self.start_time = datetime.now(timezone.utc)\n    self.status = \"running\"\n    logger.info(\"\ud83d\udd04 Starting: %s - %s\", self.name, self.description)\n</code></pre>"},{"location":"reference/git_sync/#scripts.git_sync.models.SyncStep.to_dict","title":"<code>to_dict()</code>","text":"<p>Convert step to dictionary for serialization.</p> Source code in <code>scripts/git_sync/models.py</code> <pre><code>def to_dict(self) -&gt; dict[str, Any]:\n    \"\"\"Convert step to dictionary for serialization.\"\"\"\n    return {\n        \"name\": self.name,\n        \"description\": self.description,\n        \"status\": self.status,\n        \"start_time\": self.start_time.isoformat() if self.start_time else None,\n        \"end_time\": self.end_time.isoformat() if self.end_time else None,\n        \"duration\": self._get_duration(),\n        \"error\": self.error,\n        \"details\": self.details,\n    }\n</code></pre>"},{"location":"reference/git_sync/#excecoes","title":"Exce\u00e7\u00f5es","text":""},{"location":"reference/git_sync/#scripts.git_sync.exceptions","title":"<code>scripts.git_sync.exceptions</code>","text":"<p>Custom exceptions for the Git synchronization system.</p>"},{"location":"reference/git_sync/#scripts.git_sync.exceptions.AuditError","title":"<code>AuditError</code>","text":"<p>               Bases: <code>SyncError</code></p> <p>Exception for audit failures.</p> Source code in <code>scripts/git_sync/exceptions.py</code> <pre><code>class AuditError(SyncError):\n    \"\"\"Exception for audit failures.\"\"\"\n</code></pre>"},{"location":"reference/git_sync/#scripts.git_sync.exceptions.GitOperationError","title":"<code>GitOperationError</code>","text":"<p>               Bases: <code>SyncError</code></p> <p>Exception for Git operation failures.</p> Source code in <code>scripts/git_sync/exceptions.py</code> <pre><code>class GitOperationError(SyncError):\n    \"\"\"Exception for Git operation failures.\"\"\"\n</code></pre>"},{"location":"reference/git_sync/#scripts.git_sync.exceptions.SyncError","title":"<code>SyncError</code>","text":"<p>               Bases: <code>Exception</code></p> <p>Base exception for synchronization errors.</p> Source code in <code>scripts/git_sync/exceptions.py</code> <pre><code>class SyncError(Exception):\n    \"\"\"Base exception for synchronization errors.\"\"\"\n</code></pre>"},{"location":"reference/git_sync/#configuracao","title":"Configura\u00e7\u00e3o","text":"<p>Pr\u00f3ximos Passos</p> <p>Esta p\u00e1gina ser\u00e1 automaticamente populada com a documenta\u00e7\u00e3o completa das classes e fun\u00e7\u00f5es quando o MkDocs for executado com as depend\u00eancias instaladas.</p> <p>Documenta\u00e7\u00e3o Adicional</p> <p>Para um guia completo de uso, consulte o Smart Git Sync Guide.</p>"},{"location":"reference/git_sync/#scripts.git_sync.config","title":"<code>scripts.git_sync.config</code>","text":"<p>Configuration management for the Git synchronization system.</p>"},{"location":"reference/git_sync/#scripts.git_sync.config.load_config","title":"<code>load_config(config_path=None)</code>","text":"<p>Load configuration with sensible defaults.</p> Source code in <code>scripts/git_sync/config.py</code> <pre><code>def load_config(config_path: Path | None = None) -&gt; dict[str, Any]:\n    \"\"\"Load configuration with sensible defaults.\"\"\"\n    default_config = {\n        \"audit_enabled\": True,\n        \"audit_timeout\": 300,\n        \"audit_fail_threshold\": \"HIGH\",\n        \"strict_audit\": True,\n        \"auto_fix_enabled\": True,\n        \"lint_timeout\": 180,\n        \"cleanup_enabled\": True,\n        \"git_timeout\": 120,\n    }\n\n    if config_path and config_path.exists():\n        try:\n            with open(config_path, encoding=\"utf-8\") as f:\n                user_config = yaml.safe_load(f)\n                default_config.update(user_config)\n                logger.info(f\"Loaded configuration from {config_path}\")\n        except Exception as e:\n            logger.warning(f\"Failed to load config from {config_path}: {e}\")\n\n    return default_config\n</code></pre>"}]}