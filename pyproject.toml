# Define o sistema de build do projeto.
# Usamos 'setuptools', o padrão moderno.
[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"

# Metadados do Projeto (PEP 621)
# Estes são "placeholders" que seu script newproject v1.4 irá substituir.
[project]
name = "meu_projeto_placeholder"
version = "0.1.0"
description = "Descrição do meu novo projeto."
readme = "README.md"
requires-python = ">=3.10"
license = { file = "LICENSE" }
authors = [
    { name = "Seu Nome", email = "seu-email@dominio.com" }
]

# Dependências do projeto (API + CLI)
dependencies = [
    # O framework web moderno e rápido
    "fastapi",
    # O servidor ASGI (necessário para rodar o FastAPI)
    "uvicorn[standard]",
    # CLI framework para scripts de desenvolvimento
    "typer[all]",
]

# Dependências de desenvolvimento
[project.optional-dependencies]
dev = [
    "pip-tools~=7.4",
    "mkdocs-material>=9.5",
    "mkdocstrings[python]>=0.25",

    # CORTEX - Documentation as Code
    "python-frontmatter>=1.0.0",
    "pyyaml>=6.0",
]

# Console scripts - comandos globais do sistema
[project.scripts]
meu-projeto = "src.main:app"
dev-doctor = "scripts.cli.doctor:main"
dev-audit = "scripts.cli.audit:main"
git-sync = "scripts.cli.git_sync:main"
upgrade-python = "scripts.cli.upgrade_python:main"
mock-gen = "scripts.cli.mock_generate:main"
mock-check = "scripts.cli.mock_validate:main"
mock-ci = "scripts.cli.mock_ci:main"
cortex = "scripts.cli.cortex:main"

# Configuração do setuptools para incluir pacotes
[tool.setuptools.packages.find]
where = ["."]
include = ["scripts*"]

# --- Configuração das Ferramentas ---

# Configuração do Ruff (Linter e Formatador)
[tool.ruff]
# Define o comprimento máximo da linha (padrão 'black')
line-length = 88

# Define o versão mínima do Python para compatibilidade de regras
target-version = "py310"

# Configuração do Linter do Ruff
[tool.ruff.lint]
# Seleciona um conjunto robusto de regras para fiscalizar
# E = Pycodestyle Erros
# F = Pyflakes (erros de lógica)
# W = Pycodestyle Warnings
# I = isort (ordenação de imports)
# N = Pep8-naming (nomes de variáveis/funções)
# UP = pyupgrade (sugestões de modernização)
# B = flake8-bugbear (possíveis bugs)
# D = pydocstyle (validação de docstrings)
select = ["E", "F", "W", "I", "N", "UP", "B", "D"]

# Ignora regras específicas para evitar conflitos
# D203: one-blank-line-before-class (conflita com D211)
# D213: multi-line-summary-second-line (conflita com D212, preferimos estilo Google)
ignore = ["D203", "D213"]

# Configuração do pydocstyle (D-Rules)
[tool.ruff.lint.pydocstyle]
# Usa a convenção Google para docstrings
convention = "google"

# Configuração do Formatador do Ruff (substituto do 'black')
[tool.ruff.format]
# Usa aspas duplas " " em vez de simples ' '
quote-style = "double"
# Não adiciona vírgula no final (skip-magic-trailing-comma controla isso)
skip-magic-trailing-comma = false

# Configuração do Semantic Release
[tool.semantic_release]
# Define onde a variável de versão está
version_variable = "pyproject.toml:project.version"

# Não faça o upload para o PyPI automaticamente.
# O pipeline de CD (Prioridade 3) fará isso.
upload_to_pypi = false

# O arquivo de "RELEASES" que você pediu
changelog_file = "CHANGELOG.md"

# Quais tipos de commit causam um 'bump' de versão
build_command = "python3 -m build"
minor_on_default_scope = true
major_on_breaking_change = true

[tool.semantic_release.changelog]
# Seções do changelog
categories = ["feat", "fix", "docs", "refactor", "perf"]

# Configuração do Mypy (Type Checking) - Nível 1: State of the Art
[tool.mypy]
python_version = "3.10"

# === RIGOR DE TIPAGEM ===
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
disallow_any_generics = true
disallow_subclassing_any = true

# === WARNINGS ===
warn_return_any = true
warn_unused_configs = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true

# === CONTROLE DE NONE ===
no_implicit_optional = true
strict_optional = true

# === IMPORTS ===
ignore_missing_imports = true  # Temporário até instalarmos todos os stubs
follow_imports = "normal"

# === MISC ===
strict_equality = true

exclude = [
    "tests/",
    "venv/",
    ".venv/",
    "build/",
    "dist/"
]

# Override para bibliotecas sem stubs de tipagem
[[tool.mypy.overrides]]
module = "frontmatter"
ignore_missing_imports = true
