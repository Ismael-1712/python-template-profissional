name: "ðŸ“š Deploy DocumentaÃ§Ã£o"
# ======================================================================
# ðŸ“š DEPLOY DE DOCUMENTAÃ‡ÃƒO - GitHub Pages
# ======================================================================
# Este workflow automatiza a publicaÃ§Ã£o da documentaÃ§Ã£o MkDocs Material
# no GitHub Pages sempre que hÃ¡ push na branch main.
#
# ARQUITETURA:
# - Build: Gera site estÃ¡tico com mkdocs build
# - Deploy: Publica na branch gh-pages via mkdocs gh-deploy
#
# OTIMIZAÃ‡Ã•ES:
# - Instala apenas dependÃªncias de documentaÃ§Ã£o (nÃ£o o ambiente completo)
# - Cache do pip para builds mais rÃ¡pidos
# - HistÃ³rico completo (fetch-depth: 0) para plugins git-based
# ======================================================================

on:
  push:
    branches: [main]
    paths:
      - 'docs/**'
      - 'mkdocs.yml'
      - 'scripts/**/*.py'  # Docstrings changes
      - '.github/workflows/deploy-docs.yml'
  # Permite execuÃ§Ã£o manual
  workflow_dispatch:

permissions:
  contents: write  # NecessÃ¡rio para push na branch gh-pages

jobs:
  # --------------------------------------------------------------------
  # JOB: BUILD E DEPLOY DA DOCUMENTAÃ‡ÃƒO
  # --------------------------------------------------------------------
  deploy:
    name: "ðŸš€ Build & Deploy to GitHub Pages"
    runs-on: ubuntu-latest

    steps:
      # --- 1. CHECKOUT (HistÃ³rico Completo) ---
      - name: "ðŸ“¥ Checkout do RepositÃ³rio"
        uses: actions/checkout@v6
        with:
          fetch-depth: 0  # HistÃ³rico completo para plugins git-revision-date

      # --- 2. SETUP PYTHON ---
      - name: "ðŸ Configurar Python"
        uses: actions/setup-python@v6
        with:
          python-version: '3.11'
          cache: 'pip'  # Cache de dependÃªncias pip

      # --- 3. INSTALAÃ‡ÃƒO (Apenas DependÃªncias de Docs) ---
      - name: "ðŸ“¦ Instalar DependÃªncias de DocumentaÃ§Ã£o"
        run: |
          python -m pip install --upgrade pip
          pip install mkdocs-material>=9.5 mkdocstrings[python]>=0.25

      # --- 4. BUILD & DEPLOY ---
      - name: "ðŸš€ Deploy para GitHub Pages"
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          mkdocs gh-deploy --force --message "docs: deploy documentation from {sha}"

      # --- 5. SUMMARY ---
      - name: "âœ… Deploy Summary"
        if: success()
        run: |
          echo "## ðŸ“š DocumentaÃ§Ã£o Publicada com Sucesso!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— **URL:** https://ismael-1712.github.io/python-template-profissional/" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… A documentaÃ§Ã£o foi atualizada na branch \`gh-pages\`" >> $GITHUB_STEP_SUMMARY
          echo "â±ï¸ GitHub Pages pode levar alguns minutos para atualizar" >> $GITHUB_STEP_SUMMARY
