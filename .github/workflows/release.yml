name: 游 Release Autom치tico (Semantic-Release)

on:
  push:
    branches: [main] # Gatilho: Apenas em push para a 'main'
  workflow_dispatch: # Permite execu칞칚o manual

jobs:
  release:
    name: 游닍 Publicar Release
    runs-on: ubuntu-latest

    # Permiss칚o CR칈TICA (Escopo Espec칤fico):
    # Necess치ria para o bot fazer o push de tags, commits e CHANGELOG.md.
    # Alinhado com P1 (Menor Privil칠gio), pois est치 no job, n칚o global.
    permissions:
      contents: write
      issues: write     # Para criar coment치rios de release
      pull-requests: write # Para links de PRs no changelog

    steps:
      - name: 1. Checkout (Hist칩rico Completo)
        uses: actions/checkout@v5
        with:
          fetch-depth: 0 # OBRIGAT칍RIO para o semantic-release ler o hist칩rico

      - name: 2. Setup Python (Vers칚o Est치vel)
        uses: actions/setup-python@v6
        with:
          python-version: '3.11'

      - name: 3. Install dependencies (P01 Pinned)
        run: python3 scripts/dev_commands.py install-dev

      - name: 4. Configurar Git (Identidade do Bot)
        run: |
          git config --global user.name "semantic-release [bot]"
          git config --global user.email "semantic-release[bot]@users.noreply.github.com"

      - name: 5. Executar Publica칞칚o do Release
        env:
          # O GITHUB_TOKEN 칠 essencial para autentica칞칚o no reposit칩rio
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: semantic-release publish
