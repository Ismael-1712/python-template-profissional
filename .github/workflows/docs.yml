# ======================================================================
# 游닄 CORTEX DOCUMENTATION GUARDIAN
# ======================================================================
# Este workflow protege a integridade da documenta칞칚o do projeto,
# garantindo que todos os documentos mantenham links v치lidos e
# metadados corretos conforme o padr칚o CORTEX.
#
# ARQUITETURA:
# Roda auditoria de documenta칞칚o usando o CORTEX em:
# - Pull Requests (para prevenir quebras)
# - Push na main (para monitoramento cont칤nuo)
#
# O CORTEX valida:
# - Frontmatter YAML correto
# - Links para c칩digo existentes
# - Links entre documentos v치lidos
# - Ignora documentos hist칩ricos (archived/deprecated)
# ======================================================================

name: "游닄 Docs: CORTEX Audit"

on:
  push:
    branches: [main]
    paths:
      - 'docs/**/*.md'
      - 'scripts/core/cortex/**/*.py'
      - 'scripts/cli/cortex.py'
  pull_request:
    branches: [main]
    paths:
      - 'docs/**/*.md'
      - 'scripts/core/cortex/**/*.py'
      - 'scripts/cli/cortex.py'
  # Permite execu칞칚o manual
  workflow_dispatch:

permissions:
  contents: read

jobs:
  # --------------------------------------------------------------------
  # JOB: AUDITORIA DE DOCUMENTA칂츾O
  # --------------------------------------------------------------------
  cortex-audit:
    name: "游댌 CORTEX Documentation Audit"
    runs-on: ubuntu-latest

    steps:
      # --- 1. CONFIGURA칂츾O ---
      - name: "游닌 Checkout do Reposit칩rio"
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      - name: "游냀 Configurar Python 3.12"
        uses: actions/setup-python@83679a892e2d95755f2dac6acb0bfd1e9ac5d548 # v6.1.0
        with:
          python-version: "3.12"
          cache: 'pip'

      # --- 2. INSTALA칂츾O DE DEPEND칅NCIAS ---
      - name: "游닍 Instalar Depend칡ncias"
        run: |
          python -m pip install --upgrade pip
          pip install -e .[dev]

      # --- 3. AUDITORIA CORTEX ---
      - name: "游댌 Executar CORTEX Audit"
        run: |
          python -m scripts.cli.cortex audit docs/ --fail-on-error

      # --- 4. RELAT칍RIO (se falhar) ---
      - name: "游늵 Resumo de Erros"
        if: failure()
        run: |
          echo "::error::CORTEX encontrou erros na documenta칞칚o!"
          echo "Execute localmente: python -m scripts.cli.cortex audit docs/"
          echo "Para mais detalhes, veja os logs acima."
