---
id: cortex-cli-config-hooks-mapping
type: history
status: active
version: 1.0.0
author: GEM & SRE Team
date: '2025-12-22'
tags: [refactoring, cortex, config, hooks, mapping]
context_tags: [architecture, modularization, technical-audit]
linked_code:
  - scripts/cortex/cli.py
  - scripts/core/cortex/config.py
related_docs:
  - docs/guides/REFACTORING_PROTOCOL_ITERATIVE_FRACTIONATION.md
title: 'Mapeamento T√©cnico - Configura√ß√£o e Hooks do CORTEX CLI (Etapa 01/04)'
---

# Mapeamento T√©cnico - Configura√ß√£o e Hooks do CORTEX CLI

## Status da Valida√ß√£o Inicial

‚úÖ **Estado GREEN Confirmado** (2025-12-22 20:05:44)

```
‚úì Ruff: All checks passed
‚úì MyPy: Success (164 source files)
‚úì Dev Doctor: Ambiente SAUD√ÅVEL
‚úì Pytest: 576 passed, 2 skipped in 7.50s
```

---

## 1. Escaneamento do CLI (scripts/cortex/cli.py)

### 1.1. Comando `config` (Linhas 1016-1150)

**Localiza√ß√£o:** `@app.command(name="config")` ‚Üí fun√ß√£o `config_manager()`

**Assinatura:**

```python
def config_manager(
    show: bool = False,          # --show flag
    validate: bool = False,       # --validate flag
    path: Path = Path("scripts/audit_config.yaml"),  # --path/-p option
) -> None
```

**Responsabilidades Identificadas:**

1. **Resolu√ß√£o de Caminho de Configura√ß√£o**
   - Linha 1057: `config_path = _project_root / path if not path.is_absolute() else path`
   - L√≥gica: Resolve caminhos relativos contra a raiz do projeto

2. **Valida√ß√£o de Exist√™ncia de Arquivo**
   - Linhas 1059-1063: Verifica se `config_path.exists()` antes de prosseguir
   - Retorna `Exit(code=1)` se n√£o encontrado

3. **Leitura de YAML**
   - Linha 1067-1068:

     ```python
     with config_path.open("r", encoding="utf-8") as f:
         config_data = yaml.safe_load(f)
     ```

   - **Depend√™ncia:** `import yaml` (inline, linha 1051)

4. **Valida√ß√£o de Schema YAML**
   - Linhas 1071-1090: Valida presen√ßa de chaves obrigat√≥rias
   - Chaves requeridas: `scan_paths`, `file_patterns`, `exclude_paths`
   - Gera warning se arquivo vazio (`config_data is None`)

5. **Exibi√ß√£o Formatada de YAML**
   - Linhas 1102-1108:

     ```python
     formatted_yaml = yaml.dump(
         config_data,
         default_flow_style=False,
         sort_keys=False,
         allow_unicode=True,
     )
     typer.echo(formatted_yaml)
     ```

6. **Estat√≠sticas de Configura√ß√£o**
   - Linhas 1113-1125: Gera sum√°rio com contadores:
     - N√∫mero de `scan_paths`
     - N√∫mero de `file_patterns`
     - N√∫mero de `exclude_paths`
     - N√∫mero de `custom_patterns`

**Tratamento de Erros:**

- `yaml.YAMLError` (linha 1133): Sintaxe YAML inv√°lida
- `OSError` (linha 1139): Erros de I/O
- `Exception` (linha 1145): Catch-all gen√©rico

---

### 1.2. Comando `setup-hooks` (Linhas 572-665)

**Localiza√ß√£o:** `@app.command(name="setup-hooks")` ‚Üí fun√ß√£o `setup_hooks()`

**Assinatura:**

```python
def setup_hooks() -> None  # Sem par√¢metros
```

**Responsabilidades Identificadas:**

1. **Detec√ß√£o do Diret√≥rio .git**
   - Linhas 589-596:

     ```python
     git_dir = _project_root / ".git"
     if not git_dir.exists():
         typer.secho(
             "‚ùå Error: .git directory not found...",
             fg=typer.colors.RED, err=True,
         )
         raise typer.Exit(code=1)
     ```

2. **Cria√ß√£o do Diret√≥rio de Hooks**
   - Linha 598: `hooks_dir.mkdir(exist_ok=True)`
   - **Opera√ß√£o pathlib:** `Path.mkdir(exist_ok=True)`

3. **Gera√ß√£o de Script Shell**
   - Linhas 601-619: Define template de hook bash (multi-line string)
   - Conte√∫do:

     ```bash
     #!/bin/bash
     # Auto-generated by CORTEX - Do not edit manually
     # Check if cortex command exists
     if ! command -v cortex &> /dev/null; then
         echo "‚ö†Ô∏è  Warning: 'cortex' command not found..."
         exit 0
     fi
     echo "üîÑ Regenerating CORTEX context map..."
     cortex map --output .cortex/context.json
     ```

4. **Backup de Hooks Existentes**
   - Linhas 634-638:

     ```python
     if hook_path.exists():
         backup_path = hook_path.with_suffix(".backup")
         typer.echo(f"üì¶ Backing up existing {hook_name}...")
         hook_path.rename(backup_path)
     ```

   - **Opera√ß√£o pathlib:** `Path.rename()`, `Path.with_suffix()`

5. **Escrita de Arquivo de Hook**
   - Linhas 641-643:

     ```python
     with hook_path.open("w", encoding="utf-8") as f:
         f.write(hook_script)
     ```

   - **Opera√ß√£o pathlib:** `Path.open(mode="w", encoding="utf-8")`

6. **Modifica√ß√£o de Permiss√µes (chmod)**
   - Linha 646: `hook_path.chmod(0o755)`
   - **Opera√ß√£o pathlib:** `Path.chmod()` para tornar execut√°vel
   - Equivale ao comando Unix: `chmod 755 <hook_file>`

**Hooks Instalados:**

- `post-merge`: Executa ap√≥s `git pull` / `git merge`
- `post-checkout`: Executa ap√≥s `git checkout` (mudan√ßa de branch)
- `post-rewrite`: Executa ap√≥s `git rebase` / `git commit --amend`

**Valida√ß√£o em Ambiente Real:**

```bash
$ ls -la .git/hooks/post-*
-rwxr-xr-x 1 user user 350 Dec 22 20:05 .git/hooks/post-checkout
-rwxr-xr-x 1 user user 350 Dec 22 20:05 .git/hooks/post-merge
-rwxr-xr-x 1 user user 350 Dec 22 20:05 .git/hooks/post-rewrite
```

---

## 2. Verifica√ß√£o de Depend√™ncias Core

### 2.1. Arquivo `scripts/core/cortex/config.py` (Existente)

**Status:** ‚úÖ J√Å EXISTE (151 linhas)

**Conte√∫do Atual:**

1. **Padr√µes de Valida√ß√£o (Linhas 17-39)**
   - `ID_PATTERN`: Regex para kebab-case
   - `VERSION_PATTERN`: Regex para semver (x.y.z)
   - `DATE_PATTERN`: Regex para ISO 8601 (YYYY-MM-DD)
   - `TAG_PATTERN`: Regex para tags em kebab-case

2. **Valores Permitidos (Linhas 41-49)**
   - `ALLOWED_TYPES`: `["guide", "arch", "reference", "history", "knowledge"]`
   - `ALLOWED_STATUSES`: `["draft", "active", "deprecated", "archived"]`

3. **Campos Obrigat√≥rios (Linhas 51-77)**
   - `REQUIRED_FIELDS`: `["id", "type", "status", "version", "author", "date"]`
   - `RECOMMENDED_FIELDS`: `["context_tags", "linked_code"]`
   - `OPTIONAL_FIELDS`: `["dependencies", "related_docs"]`

4. **Constantes de Valida√ß√£o (Linhas 79-88)**
   - `MIN_AUTHOR_LENGTH`: 3
   - `MAX_CONTEXT_TAGS`: 10
   - `MAX_LINKED_CODE`: 20
   - `MAX_RELATED_DOCS`: 10

5. **Configura√ß√£o Padr√£o (Linhas 90-114)**

   ```python
   DEFAULT_CONFIG: dict[str, Any] = {
       "scan_paths": ["docs/"],
       "file_patterns": ["*.md"],
       "exclude_paths": [".git/", "__pycache__/", ".venv/", ...],
       "validate_code_links": True,
       "validate_doc_links": True,
       "strict_mode": False,
       "max_errors_per_file": 50,
   }
   ```

6. **Mensagens de Erro/Warnings (Linhas 116-151)**
   - `ERROR_MESSAGES`: Dicion√°rio de templates de erro
   - `WARNING_MESSAGES`: Dicion√°rio de templates de warning

**Conclus√£o:** Este arquivo j√° fornece CONSTANTES, mas n√£o fornece uma **classe de orquestra√ß√£o** para I/O de configura√ß√£o.

---

### 2.2. Aus√™ncia de Schema Centralizado

**Achado:** ‚ùå N√ÉO existe uma classe `CortexConfig` ou `ConfigSchema`

**Evid√™ncias:**

- Busca por `class Config` em `scripts/core/cortex/**`: 0 resultados
- N√£o h√° modelo Pydantic ou dataclass para configura√ß√£o do CORTEX

**Padr√µes Existentes em Outros M√≥dulos:**

1. **scripts/audit/config.py** (72 linhas)
   - Fun√ß√£o: `load_config(config_path: Path | None = None) -> dict[str, Any]`
   - Merge de configura√ß√£o com defaults
   - Uso de `yaml.safe_load()`

2. **scripts/git_sync/config.py** (49 linhas)
   - Fun√ß√£o: `load_config(config_path: Path | None = None) -> dict[str, Any]`
   - Padr√£o id√™ntico ao audit/config.py

**Oportunidade de Reutiliza√ß√£o:**

- Ambos os m√≥dulos (audit, git_sync) implementam `load_config()` de forma similar
- H√° potencial para **consolida√ß√£o de padr√µes** no ConfigOrchestrator

---

## 3. Auditoria de Git Hooks

### 3.1. Scripts em `scripts/git/`

**Listagem:**

1. `direct-push-main.sh` (138 linhas)
   - Protocolo automatizado para push direto na `main`
   - Baseado em: `docs/guides/DIRECT_PUSH_PROTOCOL.md`
   - **N√ÉO √© instalado como Git Hook** (script manual via task)

2. `post-pr-cleanup.sh` (137 linhas)
   - Limpeza ap√≥s merge de Pull Request
   - Baseado em: `docs/guides/POST_PR_MERGE_PROTOCOL.md`
   - **N√ÉO √© instalado como Git Hook** (script manual via task)

3. `sync-all-branches.sh`
4. `update-branches.sh`
5. `update-local.sh`
6. `update-main.sh`
   - Scripts auxiliares de sincroniza√ß√£o Git
   - **N√ÉO s√£o instalados como Git Hooks**

**Conclus√£o:** Os scripts em `scripts/git/` s√£o ferramentas CLI independentes, n√£o hooks.

---

### 3.2. Hooks Gerenciados pelo `setup-hooks`

**Hooks Instalados Atualmente:**

| Hook           | Arquivo Gerado        | Trigger                          | A√ß√£o                           |
|----------------|-----------------------|----------------------------------|--------------------------------|
| `post-merge`   | `.git/hooks/post-merge` | Ap√≥s `git pull` / `git merge`    | `cortex map --output .cortex/context.json` |
| `post-checkout`| `.git/hooks/post-checkout` | Ap√≥s `git checkout`              | `cortex map --output .cortex/context.json` |
| `post-rewrite` | `.git/hooks/post-rewrite` | Ap√≥s `git rebase` / `commit --amend` | `cortex map --output .cortex/context.json` |

**Caracter√≠sticas:**

- Todos os hooks executam a **mesma a√ß√£o**: regenerar o mapa de contexto
- Script gerado √© **id√™ntico** para os 3 hooks
- Hooks s√£o **auto-gerados** (coment√°rio: "Auto-generated by CORTEX - Do not edit manually")
- Permiss√µes: `0o755` (rwxr-xr-x)

**Valida√ß√£o em `.git/hooks/`:**

```bash
$ find .git/hooks -type f -name "post-*"
.git/hooks/post-rewrite
.git/hooks/post-merge
.git/hooks/post-checkout
```

**Conte√∫do Real (post-merge):**

```bash
#!/bin/bash
# Auto-generated by CORTEX - Do not edit manually
# This hook regenerates the project context map after Git operations

# Check if cortex command exists
if ! command -v cortex &> /dev/null; then
    echo "‚ö†Ô∏è  Warning: 'cortex' command not found. Skipping..."
    exit 0
fi

echo "üîÑ Regenerating CORTEX context map..."
cortex map --output .cortex/context.json

if [ $? -eq 0 ]; then
    echo "‚úÖ Context map updated successfully!"
else
    echo "‚ö†Ô∏è  Warning: Failed to update context map"
fi
```

---

## 4. An√°lise de Depend√™ncias Externas

### 4.1. Biblioteca YAML

**Importa√ß√£o:**

- **Localiza√ß√£o:** Inline, dentro dos comandos (n√£o no topo do arquivo)
  - Linha 162: `import yaml` (dentro de `init()`)
  - Linha 1051: `import yaml` (dentro de `config_manager()`)

**Fun√ß√µes Utilizadas:**

1. **yaml.safe_load()** (Leitura)
   - Linha 1068: `config_data = yaml.safe_load(f)`
   - Convers√£o de YAML string ‚Üí dict Python
   - **Safe:** Protegido contra execu√ß√£o arbitr√°ria de c√≥digo

2. **yaml.dump()** (Escrita)
   - Linha 164: Serializa√ß√£o de frontmatter
   - Linha 1102: Serializa√ß√£o de configura√ß√£o
   - Par√¢metros comuns:
     - `default_flow_style=False`: Usa estilo block (mais leg√≠vel)
     - `sort_keys=False`: Preserva ordem das chaves
     - `allow_unicode=True`: Suporta caracteres UTF-8

3. **yaml.YAMLError** (Exce√ß√£o)
   - Linha 1133: `except yaml.YAMLError as e:`
   - Captura erros de sintaxe YAML

**Conclus√£o:** O comando `config` √© o √∫nico que realiza opera√ß√µes YAML no CLI.

---

### 4.2. Biblioteca pathlib

**Importa√ß√£o:**

- **Localiza√ß√£o:** Topo do arquivo (linha 19)
  - `from pathlib import Path`

**Opera√ß√µes Utilizadas:**

#### No Comando `config`

1. **Resolu√ß√£o de Caminho**
   - `_project_root / path` (operador `/`)
   - `path.is_absolute()`

2. **Verifica√ß√£o de Exist√™ncia**
   - `config_path.exists()`

3. **Leitura de Arquivo**
   - `config_path.open("r", encoding="utf-8")`

#### No Comando `setup-hooks`

1. **Constru√ß√£o de Caminhos**
   - `_project_root / ".git"`
   - `git_dir / "hooks"`

2. **Cria√ß√£o de Diret√≥rio**
   - `hooks_dir.mkdir(exist_ok=True)`

3. **Manipula√ß√£o de Sufixos**
   - `hook_path.with_suffix(".backup")`

4. **Renomea√ß√£o de Arquivos**
   - `hook_path.rename(backup_path)`

5. **Escrita de Arquivo**
   - `hook_path.open("w", encoding="utf-8")`

6. **Modifica√ß√£o de Permiss√µes**
   - `hook_path.chmod(0o755)` ‚ö†Ô∏è **Unix-specific**

**Nota de Portabilidade:**

- `chmod()` funciona em Unix/Linux/macOS
- No Windows, pode n√£o ter efeito ou levantar exce√ß√£o
- N√£o h√° tratamento espec√≠fico para cross-platform

---

## 5. Mapeamento de I/O para ConfigOrchestrator

### 5.1. Opera√ß√µes a Serem Extra√≠das

Com base na an√°lise, as seguintes opera√ß√µes devem ser movidas para um **ConfigOrchestrator**:

#### **Categoria 1: Gerenciamento de Arquivos YAML**

```python
class ConfigOrchestrator:
    def load_yaml(self, path: Path) -> dict[str, Any]:
        """Carrega e valida arquivo YAML."""
        # Extra√ß√£o: Linhas 1057-1068 (config_manager)
        # Responsabilidades:
        # - Resolu√ß√£o de caminho relativo/absoluto
        # - Verifica√ß√£o de exist√™ncia
        # - yaml.safe_load()
        # - Tratamento de yaml.YAMLError

    def save_yaml(
        self, data: dict[str, Any], path: Path, **kwargs
    ) -> None:
        """Salva dados em arquivo YAML formatado."""
        # Extra√ß√£o: Linhas 1102-1108 (config_manager)
        # Responsabilidades:
        # - yaml.dump() com op√ß√µes padr√£o
        # - Cria√ß√£o de diret√≥rios pai se necess√°rio
        # - Tratamento de OSError
```

#### **Categoria 2: Valida√ß√£o de Schema**

```python
    def validate_config_schema(
        self, config_data: dict[str, Any],
        required_keys: list[str],
    ) -> tuple[bool, list[str]]:
        """Valida presen√ßa de chaves obrigat√≥rias."""
        # Extra√ß√£o: Linhas 1071-1090 (config_manager)
        # Retorna: (is_valid, missing_keys)
```

#### **Categoria 3: Merge de Configura√ß√£o com Defaults**

```python
    def merge_with_defaults(
        self, user_config: dict[str, Any],
        defaults: dict[str, Any],
    ) -> dict[str, Any]:
        """Mescla configura√ß√£o do usu√°rio com defaults."""
        # Padr√£o de: scripts/audit/config.py (load_config)
        # Padr√£o de: scripts/git_sync/config.py (load_config)
        # Oportunidade de consolida√ß√£o
```

---

### 5.2. Opera√ß√µes de Git Hooks a Serem Extra√≠das

```python
class HooksOrchestrator:
    def detect_git_directory(
        self, project_root: Path
    ) -> Path:
        """Detecta e valida diret√≥rio .git."""
        # Extra√ß√£o: Linhas 589-596 (setup_hooks)

    def generate_hook_script(
        self, hook_type: str, command: str
    ) -> str:
        """Gera script bash para hook Git."""
        # Extra√ß√£o: Linhas 601-619 (setup_hooks)
        # Par√¢metro hook_type: "post-merge", "post-checkout", etc.
        # Par√¢metro command: "cortex map --output .cortex/context.json"

    def install_hook(
        self, hook_name: str, script_content: str,
        hooks_dir: Path, backup: bool = True,
    ) -> None:
        """Instala hook Git com backup opcional."""
        # Extra√ß√£o: Linhas 634-648 (setup_hooks)
        # Responsabilidades:
        # - Backup de hook existente
        # - Escrita do arquivo
        # - chmod 0o755 (tornar execut√°vel)

    def install_cortex_hooks(
        self, project_root: Path
    ) -> list[str]:
        """Instala todos os hooks do CORTEX."""
        # Extra√ß√£o: Loop completo (linhas 621-648)
        # Retorna: Lista de hooks instalados
```

---

### 5.3. Opera√ß√µes Compartilhadas (Utilit√°rios)

```python
class FileSystemOrchestrator:
    def ensure_directory(self, path: Path) -> None:
        """Garante que diret√≥rio existe."""
        # path.mkdir(exist_ok=True, parents=True)

    def backup_file(
        self, file_path: Path, suffix: str = ".backup"
    ) -> Path:
        """Cria backup de arquivo existente."""
        # Extra√ß√£o: Linhas 634-638 (setup_hooks)

    def make_executable(self, file_path: Path) -> None:
        """Torna arquivo execut√°vel (Unix)."""
        # file_path.chmod(0o755)
        # TODO: Verificar plataforma (os.name) antes
```

---

## 6. Diagrama de Depend√™ncias Atuais

```mermaid
graph TD
    CLI[scripts/cortex/cli.py] -->|import yaml| YAML[PyYAML Library]
    CLI -->|from pathlib import Path| PATHLIB[pathlib stdlib]
    CLI -->|L√™| CONFIG_FILE[scripts/audit_config.yaml]
    CLI -->|Escreve| GIT_HOOKS[.git/hooks/post-*]

    CONFIG_FILE -.Schema N√£o Validado.-> SCHEMA[‚ùå No Schema Class]
    CLI -.Inline Validation.-> SCHEMA

    subgraph "Padr√µes Similares"
        AUDIT[scripts/audit/config.py]
        GIT_SYNC[scripts/git_sync/config.py]
    end

    AUDIT -->|yaml.safe_load| YAML
    GIT_SYNC -->|yaml.safe_load| YAML

    style SCHEMA fill:#ffcccc,stroke:#cc0000
    style CONFIG_FILE fill:#e1f5ff
    style GIT_HOOKS fill:#fff4e1
```

---

## 7. Riscos e Considera√ß√µes para Extra√ß√£o

### 7.1. Riscos de Quebra

1. **Imports Inline de YAML**
   - Risco: Mover `import yaml` para o topo pode causar ImportError se PyYAML n√£o estiver instalado
   - Mitiga√ß√£o: Manter lazy import ou documentar depend√™ncia

2. **Acoplamento com _project_root**
   - Risco: `_project_root` √© vari√°vel global do m√≥dulo CLI
   - Mitiga√ß√£o: Passar `project_root` como par√¢metro para Orchestrator

3. **Tratamento de Erros Espec√≠ficos**
   - Risco: CLI usa `typer.secho()` e `typer.Exit(code=1)` para erros
   - Mitiga√ß√£o: Orchestrator deve levantar exce√ß√µes, CLI trata apresenta√ß√£o

4. **Opera√ß√£o chmod() no Windows**
   - Risco: `chmod(0o755)` pode falhar no Windows
   - Mitiga√ß√£o: Adicionar verifica√ß√£o de plataforma (`os.name == 'posix'`)

---

### 7.2. Depend√™ncias Externas

**PyYAML:**

- Verifica√ß√£o em `pyproject.toml`: ‚úÖ Presente
- Vers√£o: Gerenciada por UV (lock file)

**pathlib:**

- Biblioteca padr√£o do Python 3.4+
- ‚úÖ Sem riscos de depend√™ncia

---

## 8. Proposta de Arquitetura P√≥s-Extra√ß√£o

### 8.1. Estrutura de Arquivos

```
scripts/core/cortex/
‚îú‚îÄ‚îÄ config.py                    # Existente - Constantes
‚îú‚îÄ‚îÄ config_orchestrator.py       # NOVO - Gerenciamento de YAML
‚îú‚îÄ‚îÄ hooks_orchestrator.py        # NOVO - Gerenciamento de Git Hooks
‚îî‚îÄ‚îÄ filesystem_utils.py          # NOVO - Utilit√°rios de I/O
```

### 8.2. Fluxo de Refatora√ß√£o

```mermaid
graph TD
    ETAPA1[Etapa 01: Mapeamento<br/>‚úÖ Este Documento] --> ETAPA2
    ETAPA2[Etapa 02: Extra√ß√£o<br/>Criar Orchestrators] --> ETAPA3
    ETAPA3[Etapa 03: Religa√ß√£o<br/>Atualizar CLI] --> ETAPA4
    ETAPA4[Etapa 04: Valida√ß√£o<br/>make validate + cortex scan]

    style ETAPA1 fill:#c8e6c9
    style ETAPA2 fill:#fff4e1
    style ETAPA3 fill:#fff4e1
    style ETAPA4 fill:#fff4e1
```

---

## 9. Estat√≠sticas de C√≥digo

### 9.1. Linhas a Serem Movidas

| Comando        | Linhas Totais | Linhas de I/O | % I/O |
|----------------|---------------|---------------|-------|
| `config`       | 135           | ~80           | 59%   |
| `setup-hooks`  | 94            | ~70           | 74%   |
| **Total**      | **229**       | **~150**      | **65%** |

### 9.2. Redu√ß√£o Esperada no cli.py

- **Antes:** 1742 linhas
- **Ap√≥s:** ~1592 linhas (estimativa)
- **Redu√ß√£o:** ~150 linhas (8.6%)

---

## 10. Pr√≥ximos Passos (Etapa 02)

### 10.1. Checklist de Implementa√ß√£o

- [ ] Criar `scripts/core/cortex/config_orchestrator.py`
  - [ ] Implementar `load_yaml()`
  - [ ] Implementar `save_yaml()`
  - [ ] Implementar `validate_config_schema()`
  - [ ] Implementar `merge_with_defaults()`

- [ ] Criar `scripts/core/cortex/hooks_orchestrator.py`
  - [ ] Implementar `detect_git_directory()`
  - [ ] Implementar `generate_hook_script()`
  - [ ] Implementar `install_hook()`
  - [ ] Implementar `install_cortex_hooks()`

- [ ] Criar testes unit√°rios
  - [ ] `tests/test_config_orchestrator.py`
  - [ ] `tests/test_hooks_orchestrator.py`

- [ ] Atualizar `scripts/cortex/cli.py`
  - [ ] Substituir l√≥gica inline por chamadas aos Orchestrators
  - [ ] Manter tratamento de erros e UI (typer)

- [ ] Valida√ß√£o completa
  - [ ] `make validate`
  - [ ] `cortex scan`
  - [ ] `pytest tests/`

---

## 11. Refer√™ncias

### 11.1. Documentos Consultados

- [REFACTORING_PROTOCOL_ITERATIVE_FRACTIONATION.md](../guides/REFACTORING_PROTOCOL_ITERATIVE_FRACTIONATION.md)
  - Se√ß√£o: "Fases Obrigat√≥rias (Iterativas)"
  - Fase 0: Mapeamento (Este documento)

### 11.2. C√≥digo Analisado

- [scripts/cortex/cli.py](../../scripts/cortex/cli.py) (1742 linhas)
  - Comando `config`: Linhas 1016-1150
  - Comando `setup-hooks`: Linhas 572-665

- [scripts/core/cortex/config.py](../../scripts/core/cortex/config.py) (151 linhas)
  - Constantes e defaults existentes

- [scripts/audit/config.py](../../scripts/audit/config.py) (72 linhas)
  - Padr√£o de `load_config()`

- [scripts/git_sync/config.py](../../scripts/git_sync/config.py) (49 linhas)
  - Padr√£o de `load_config()`

---

## Conclus√£o

Este mapeamento t√©cnico identificou **150 linhas de l√≥gica de I/O** que podem ser extra√≠das do CLI monol√≠tico para Orchestrators dedicados, seguindo o **Protocolo de Fracionamento Iterativo**.

**Estado Atual:** ‚úÖ GREEN (todos os testes passando)
**Pr√≥xima Etapa:** Extra√ß√£o dos m√≥dulos (Fase 1 do protocolo)

---

**Revisado por:** GitHub Copilot (Claude Sonnet 4.5)
**Data:** 2025-12-22
**Valida√ß√£o CI:** ‚úÖ 576 testes passando
